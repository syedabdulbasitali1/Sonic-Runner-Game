(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();var Al=Object.defineProperty,vl=(e,t,s)=>t in e?Al(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,E=(e,t,s)=>vl(e,typeof t!="symbol"?t+"":t,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var xl=Object.defineProperty,o=(e,t)=>xl(e,"name",{value:t,configurable:!0}),bl=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return s=>{for(var n=s.length,r=new Uint8Array((n-(s[n-1]=="=")-(s[n-2]=="="))*3/4|0),i=0,a=0;i<n;){var d=e[s.charCodeAt(i++)],l=e[s.charCodeAt(i++)],u=e[s.charCodeAt(i++)],f=e[s.charCodeAt(i++)];r[a++]=d<<2|l>>4,r[a++]=l<<4|u>>2,r[a++]=u<<6|f}return r}})(),ee,Q=(ee=class{constructor(e,t,s){E(this,"r",255),E(this,"g",255),E(this,"b",255),this.r=Le(e,0,255),this.g=Le(t,0,255),this.b=Le(s,0,255)}static fromArray(e){return new ee(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new ee(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)throw new Error("Invalid hex color format");return new ee(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,t,s){if(t==0)return new ee(255*s,255*s,255*s);let n=o((u,f,x)=>(x<0&&(x+=1),x>1&&(x-=1),x<1/6?u+(f-u)*6*x:x<1/2?f:x<2/3?u+(f-u)*(2/3-x)*6:u),"hue2rgb"),r=s<.5?s*(1+t):s+t-s*t,i=2*s-r,a=n(i,r,e+1/3),d=n(i,r,e),l=n(i,r,e-1/3);return new ee(Math.round(a*255),Math.round(d*255),Math.round(l*255))}clone(){return new ee(this.r,this.g,this.b)}lighten(e){return new ee(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new ee(255-this.r,255-this.g,255-this.b)}mult(e){return new ee(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,t){return new ee(be(this.r,e.r,t),be(this.g,e.g,t),be(this.b,e.b,t))}toHSL(){let e=this.r/255,t=this.g/255,s=this.b/255,n=Math.max(e,t,s),r=Math.min(e,t,s),i=(n+r)/2,a=i,d=i;if(n==r)i=a=0;else{let l=n-r;switch(a=d>.5?l/(2-n-r):l/(n+r),n){case e:i=(t-s)/l+(t<s?6:0);break;case t:i=(s-e)/l+2;break;case s:i=(e-t)/l+4;break}i/=6}return[i,a,d]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}},o(ee,"Color"),E(ee,"RED",new ee(255,0,0)),E(ee,"GREEN",new ee(0,255,0)),E(ee,"BLUE",new ee(0,0,255)),E(ee,"YELLOW",new ee(255,255,0)),E(ee,"MAGENTA",new ee(255,0,255)),E(ee,"CYAN",new ee(0,255,255)),E(ee,"WHITE",new ee(255,255,255)),E(ee,"BLACK",new ee(0,0,0)),ee);function $(...e){if(e.length===0)return new Q(255,255,255);if(e.length===1){if(e[0]instanceof Q)return e[0].clone();if(typeof e[0]=="string")return Q.fromHex(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return Q.fromArray(e[0])}else if(e.length===2){if(e[0]instanceof Q)return e[0].clone()}else if(e.length===3||e.length===4)return new Q(e[0],e[1],e[2]);throw new Error("Invalid color arguments")}o($,"rgb");var El=o((e,t,s)=>Q.fromHSL(e,t,s),"hsl2rgb");function de(e){return e*Math.PI/180}o(de,"deg2rad");function ot(e){return e*180/Math.PI}o(ot,"rad2deg");function Le(e,t,s){return t>s?Le(e,s,t):Math.min(Math.max(e,t),s)}o(Le,"clamp");function be(e,t,s){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*s;if(e instanceof C&&t instanceof C||e instanceof Q&&t instanceof Q)return e.lerp(t,s);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}o(be,"lerp");function Ue(e,t,s,n,r){return n+(e-t)/(s-t)*(r-n)}o(Ue,"map");function ii(e,t,s,n,r){return Le(Ue(e,t,s,n,r),n,r)}o(ii,"mapc");var re,C=(re=class{constructor(e=0,t=e){E(this,"x",0),E(this,"y",0),this.x=e,this.y=t}static fromAngle(e){let t=de(e);return new re(Math.cos(t),Math.sin(t))}static fromArray(e){return new re(e[0],e[1])}clone(){return new re(this.x,this.y)}add(...e){let t=M(...e);return new re(this.x+t.x,this.y+t.y)}sub(...e){let t=M(...e);return new re(this.x-t.x,this.y-t.y)}scale(...e){let t=M(...e);return new re(this.x*t.x,this.y*t.y)}dist(...e){let t=M(...e);return this.sub(t).len()}sdist(...e){let t=M(...e);return this.sub(t).slen()}static sdist(e,t){let s=e.x-t.x,n=e.y-t.y;return s*s+n*n}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new re(0):this.scale(1/e)}normal(){return new re(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}static dot(e,t){return e.x*e.x+e.y*e.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,t){return e.x*t.y-e.y*t.x}angle(...e){let t=M(...e);return ot(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=M(...e);return ot(Math.atan2(this.cross(t),this.dot(t)))}lerp(e,t){return new re(be(this.x,e.x,t),be(this.y,e.y,t))}slerp(e,t){let s=this.dot(e),n=this.cross(e),r=Math.atan2(n,s);return this.scale(Math.sin((1-t)*r)).add(e.scale(Math.sin(t*r))).scale(1/n)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new re(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new oe(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}},o(re,"Vec2"),E(re,"ZERO",new re(0,0)),E(re,"ONE",new re(1,1)),E(re,"LEFT",new re(-1,0)),E(re,"RIGHT",new re(1,0)),E(re,"UP",new re(0,-1)),E(re,"DOWN",new re(0,1)),re);function M(...e){if(e.length===1){if(e[0]instanceof C)return new C(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return new C(...e[0])}return new C(...e)}o(M,"vec2");var Kt,le=(Kt=class{constructor(e,t,s,n){E(this,"x",0),E(this,"y",0),E(this,"w",1),E(this,"h",1),this.x=e,this.y=t,this.w=s,this.h=n}scale(e){return new Kt(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new C(this.x,this.y)}clone(){return new Kt(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},o(Kt,"Quad"),Kt);function ce(e,t,s,n){return new le(e,t,s,n)}o(ce,"quad");var tt,Cs=(tt=class{constructor(e,t,s,n){E(this,"a"),E(this,"b"),E(this,"c"),E(this,"d"),this.a=e,this.b=t,this.c=s,this.d=n}mul(e){return new tt(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return M(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new tt(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new tt(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,t=this.det,s=e+Math.sqrt(e*e-t),n=e-Math.sqrt(e*e-t);return[s,n]}eigenvectors(e,t){return this.c!=0?[[e-this.d,this.c],[t-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,t-this.a]]:Math.abs(this.transform(M(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let t=Math.cos(e),s=Math.sin(e);return new tt(t,s,-s,t)}static scale(e,t){return new tt(e,0,0,t)}},o(tt,"Mat2"),tt),ft,Qt=(ft=class{constructor(e,t,s,n,r,i,a,d,l){E(this,"m11"),E(this,"m12"),E(this,"m13"),E(this,"m21"),E(this,"m22"),E(this,"m23"),E(this,"m31"),E(this,"m32"),E(this,"m33"),this.m11=e,this.m12=t,this.m13=s,this.m21=n,this.m22=r,this.m23=i,this.m31=a,this.m32=d,this.m33=l}static fromMat2(e){return new ft(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new Cs(this.m11,this.m12,this.m21,this.m22)}mul(e){return new ft(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let t=Math.cos(e),s=Math.sin(e),n=this.m11,r=this.m12;return this.m11=t*this.m11+s*this.m21,this.m12=t*this.m12+s*this.m22,this.m21=t*this.m21-s*n,this.m22=t*this.m22-s*r,this}scale(e,t){return this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}get inverse(){let e=this.det;return new ft((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new ft(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},o(ft,"Mat3"),ft),Oe,He=(Oe=class{constructor(e){E(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e&&(this.m=e)}static translate(e){return new Oe([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new Oe([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=de(-e);let t=Math.cos(e),s=Math.sin(e);return new Oe([1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1])}static rotateY(e){e=de(-e);let t=Math.cos(e),s=Math.sin(e);return new Oe([t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1])}static rotateZ(e){e=de(-e);let t=Math.cos(e),s=Math.sin(e);return new Oe([t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=de(-e);let t=Math.cos(e),s=Math.sin(e),n=this.m[0],r=this.m[1],i=this.m[4],a=this.m[5];return this.m[0]=n*t+r*s,this.m[1]=-n*s+r*t,this.m[4]=i*t+a*s,this.m[5]=-i*s+a*t,this}mult(e){let t=[];for(let s=0;s<4;s++)for(let n=0;n<4;n++)t[s*4+n]=this.m[0*4+n]*e.m[s*4+0]+this.m[1*4+n]*e.m[s*4+1]+this.m[2*4+n]*e.m[s*4+2]+this.m[3*4+n]*e.m[s*4+3];return new Oe(t)}multVec2(e){return new C(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new C(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new C(t,e/t)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new C(e/t,t)}else return new C(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return ot(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return ot(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new C(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new C(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new C(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],s=this.m[9]*this.m[15]-this.m[13]*this.m[11],n=this.m[9]*this.m[14]-this.m[13]*this.m[10],r=this.m[8]*this.m[15]-this.m[12]*this.m[11],i=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],d=this.m[6]*this.m[15]-this.m[14]*this.m[7],l=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],f=this.m[4]*this.m[15]-this.m[12]*this.m[7],x=this.m[4]*this.m[14]-this.m[12]*this.m[6],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],y=this.m[4]*this.m[13]-this.m[12]*this.m[5],g=this.m[6]*this.m[11]-this.m[10]*this.m[7],S=this.m[5]*this.m[11]-this.m[9]*this.m[7],p=this.m[5]*this.m[10]-this.m[9]*this.m[6],w=this.m[4]*this.m[11]-this.m[8]*this.m[7],P=this.m[4]*this.m[10]-this.m[8]*this.m[6],I=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*s+this.m[7]*n,e[4]=-(this.m[4]*t-this.m[6]*r+this.m[7]*i),e[8]=this.m[4]*s-this.m[5]*r+this.m[7]*a,e[12]=-(this.m[4]*n-this.m[5]*i+this.m[6]*a),e[1]=-(this.m[1]*t-this.m[2]*s+this.m[3]*n),e[5]=this.m[0]*t-this.m[2]*r+this.m[3]*i,e[9]=-(this.m[0]*s-this.m[1]*r+this.m[3]*a),e[13]=this.m[0]*n-this.m[1]*i+this.m[2]*a,e[2]=this.m[1]*d-this.m[2]*l+this.m[3]*u,e[6]=-(this.m[0]*d-this.m[2]*f+this.m[3]*x),e[10]=this.m[0]*c-this.m[1]*f+this.m[3]*y,e[14]=-(this.m[0]*u-this.m[1]*x+this.m[2]*y),e[3]=-(this.m[1]*g-this.m[2]*S+this.m[3]*p),e[7]=this.m[0]*g-this.m[2]*w+this.m[3]*P,e[11]=-(this.m[0]*S-this.m[1]*w+this.m[3]*I),e[15]=this.m[0]*p-this.m[1]*P+this.m[2]*I;let U=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let D=0;D<4;D++)for(let v=0;v<4;v++)e[D*4+v]*=1/U;return new Oe(e)}clone(){return new Oe([...this.m])}toString(){return this.m.toString()}},o(Oe,"Mat4"),Oe);function Hr(e,t,s,n=r=>-Math.cos(r)){return e+(n(s)+1)/2*(t-e)}o(Hr,"wave");var Ml=1103515245,Sl=12345,$n=2147483648,or,oi=(or=class{constructor(e){E(this,"seed"),this.seed=e}gen(){return this.seed=(Ml*this.seed+Sl)%$n,this.seed/$n}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new C(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new Q(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof C)return this.genVec2(M(0,0),e[0]);if(e[0]instanceof Q)return this.genColor($(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof C&&e[1]instanceof C)return this.genVec2(e[0],e[1]);if(e[0]instanceof Q&&e[1]instanceof Q)return this.genColor(e[0],e[1])}throw new Error("More than 2 arguments not supported")}},o(or,"RNG"),or),Rr=new oi(Date.now());function ai(e){return e!=null&&(Rr.seed=e),Rr.seed}o(ai,"randSeed");function pe(...e){return Rr.genAny(...e)}o(pe,"rand");function Vr(...e){return Math.floor(pe(...e.length>0?e:[2]))}o(Vr,"randi");function li(e){return pe()<=e}o(li,"chance");function Kr(e){for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}o(Kr,"shuffle");function ui(e,t){return e.length<=t?e.slice():Kr(e.slice()).slice(0,t)}o(ui,"chooseMultiple");function hi(e){return e[Vr(e.length)]}o(hi,"choose");function Yr(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}o(Yr,"testRectRect");function ci(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let s=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(s===0)return null;let n=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/s,r=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/s;return n<0||n>1||r<0||r>1?null:n}o(ci,"testLineLineT");function Ns(e,t){let s=ci(e,t);return s?M(e.p1.x+s*(e.p2.x-e.p1.x),e.p1.y+s*(e.p2.y-e.p1.y)):null}o(Ns,"testLineLine");function Gs(e,t){let s=t.p2.sub(t.p1),n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;if(s.x!=0){let i=(e.pos.x-t.p1.x)/s.x,a=(e.pos.x+e.width-t.p1.x)/s.x;n=Math.max(n,Math.min(i,a)),r=Math.min(r,Math.max(i,a))}if(s.y!=0){let i=(e.pos.y-t.p1.y)/s.y,a=(e.pos.y+e.height-t.p1.y)/s.y;n=Math.max(n,Math.min(i,a)),r=Math.min(r,Math.max(i,a))}return r>=n&&r>=0&&n<=1}o(Gs,"testRectLine");function os(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}o(os,"testRectPoint");function zr(e,t){let s=Math.max(e.pos.x,Math.min(t.center.x,e.pos.x+e.width)),n=Math.max(e.pos.y,Math.min(t.center.y,e.pos.y+e.height));return M(s,n).sdist(t.center)<=t.radius*t.radius}o(zr,"testRectCircle");function Xr(e,t){return Qr(t,new Ee(e.points()))}o(Xr,"testRectPolygon");function js(e,t){let s=t.sub(e.p1),n=e.p2.sub(e.p1);if(Math.abs(s.cross(n))>Number.EPSILON)return!1;let r=s.dot(n)/n.dot(n);return r>=0&&r<=1}o(js,"testLinePoint");function Dt(e,t){let s=e.p2.sub(e.p1),n=s.dot(s),r=e.p1.sub(t.center),i=2*s.dot(r),a=r.dot(r)-t.radius*t.radius,d=i*i-4*n*a;if(n<=Number.EPSILON||d<0)return!1;if(d==0){let l=-i/(2*n);if(l>=0&&l<=1)return!0}else{let l=(-i+Math.sqrt(d))/(2*n),u=(-i-Math.sqrt(d))/(2*n);if(l>=0&&l<=1||u>=0&&u<=1)return!0}return as(t,e.p1)}o(Dt,"testLineCircle");function Hs(e,t){if(Je(t,e.p1)||Je(t,e.p2))return!0;for(let s=0;s<t.pts.length;s++){let n=t.pts[s],r=t.pts[(s+1)%t.pts.length];if(Ns(e,new Ie(n,r)))return!0}return!1}o(Hs,"testLinePolygon");function as(e,t){return e.center.sdist(t)<e.radius*e.radius}o(as,"testCirclePoint");function di(e,t){return e.center.sdist(t.center)<(e.radius+t.radius)*(e.radius+t.radius)}o(di,"testCircleCircle");function ls(e,t){let s=t.pts[t.pts.length-1];for(let n of t.pts){if(Dt(new Ie(s,n),e))return!0;s=n}return as(e,t.pts[0])?!0:Je(t,e.center)}o(ls,"testCirclePolygon");function Qr(e,t){for(let s=0;s<e.pts.length;s++)if(Hs(new Ie(e.pts[s],e.pts[(s+1)%e.pts.length]),t))return!0;return!!(e.pts.some(s=>Je(t,s))||t.pts.some(s=>Je(e,s)))}o(Qr,"testPolygonPolygon");function Je(e,t){let s=!1,n=e.pts;for(let r=0,i=n.length-1;r<n.length;i=r++)n[r].y>t.y!=n[i].y>t.y&&t.x<(n[i].x-n[r].x)*(t.y-n[r].y)/(n[i].y-n[r].y)+n[r].x&&(s=!s);return s}o(Je,"testPolygonPoint");function Vs(e,t){t=t.sub(e.center);let s=de(e.angle),n=Math.cos(s),r=Math.sin(s),i=t.x*n+t.y*r,a=-t.x*r+t.y*n;return i*i/(e.radiusX*e.radiusX)+a*a/(e.radiusY*e.radiusY)<1}o(Vs,"testEllipsePoint");function Zt(e,t){let s=t.center.sub(e.center),n=de(e.angle),r=Math.cos(n),i=Math.sin(n),a=s.x*r+s.y*i,d=-s.x*i+s.y*r;return Vs(new Ze(M(),e.radiusX+t.radius,e.radiusY+t.radius,0),M(a,d))}o(Zt,"testEllipseCircle");function Wr(e,t){let s=e.toMat2().inverse;return t=new Ie(s.transform(t.p1.sub(e.center)),s.transform(t.p2.sub(e.center))),Dt(t,new Re(M(),1))}o(Wr,"testEllipseLine");function fi(e,t){if(e.radiusX===e.radiusY)return Zt(t,new Re(e.center,e.radiusX));if(t.radiusX===t.radiusY)return Zt(e,new Re(t.center,t.radiusX));let s=new Qt(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),n=new Qt(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),r=e.center.x,i=e.center.y,a=t.center.x,d=t.center.y,l=de(e.angle),u=de(t.angle),f=new Qt(Math.cos(l),-Math.sin(l),r,Math.sin(l),Math.cos(l),i,0,0,1),x=new Qt(Math.cos(u),-Math.sin(u),a,Math.sin(u),Math.cos(u),d,0,0,1),c=f.inverse,y=x.inverse,g=c.transpose.mul(s).mul(c),S=y.transpose.mul(n).mul(y),p=g.m11,w=g.m12,P=g.m13,I=g.m21,U=g.m22,D=g.m23,v=g.m31,b=g.m32,q=g.m33,k=S.m11,T=S.m12,O=S.m13,L=S.m21,j=S.m22,H=S.m23,W=S.m31,G=S.m32,z=S.m33,te=p*U*q-p*D*b-w*I*q+w*D*v+P*I*b-P*U*v,Z=(p*U*z-p*D*G-p*b*H+p*q*j-w*I*z+w*D*W+w*v*H-w*q*L+P*I*G-P*U*W-P*v*j+P*b*L+I*b*O-I*q*T-U*v*O+U*q*k+D*v*T-D*b*k)/te,J=(p*j*z-p*H*G-w*L*z+w*H*W+P*L*G-P*j*W-I*T*z+I*O*G+U*k*z-U*O*W-D*k*G+D*T*W+v*T*H-v*O*j-b*k*H+b*O*L+q*k*j-q*T*L)/te,ue=(k*j*z-k*H*G-T*L*z+T*H*W+O*L*G-O*j*W)/te;if(Z>=0){let V=-3*J+Z**2,Ve=3*Z*ue+J*Z**2-4*J**2,$e=-27*ue**2+18*ue*Z*J+Z**2*J**2-4*Z**3*ue-4*J**3;return!(V>0&&Ve<0&&$e>0)}else{let V=-3*J+Z**2,Ve=-27*ue**2+18*ue*Z*J+Z**2*J**2-4*Z**3*ue-4*J**3;return!(V>0&&Ve>0)}}o(fi,"testEllipseEllipse");function Jr(e,t){return Ks(e,new Ee(t.points()))}o(Jr,"testEllipseRect");function Ks(e,t){let s=e.toMat2().inverse;return t=new Ee(t.pts.map(n=>s.transform(n.sub(e.center)))),ls(new Re(M(),1),t)}o(Ks,"testEllipsePolygon");function pi(e,t){return e.x===t.x&&e.y===t.y}o(pi,"testPointPoint");function gi(e,t){return t instanceof C?pi(t,e.pt):t instanceof Re?as(t,e.pt):t instanceof Ie?js(t,e.pt):t instanceof oe?os(t,e.pt):t instanceof Ee?Je(t,e.pt):t instanceof Ze?Vs(t,e.pt):!1}o(gi,"testPointShape");function mi(e,t){return t instanceof C?js(e,t):t instanceof Re?Dt(e,t):t instanceof Ie?Ns(e,t)!=null:t instanceof oe?Gs(t,e):t instanceof Ee?Hs(e,t):t instanceof Ze?Wr(t,e):!1}o(mi,"testLineShape");function wi(e,t){return t instanceof C?as(e,t):t instanceof Re?di(e,t):t instanceof Ie?Dt(t,e):t instanceof oe?zr(t,e):t instanceof Ee?ls(e,t):t instanceof Ze?Zt(t,e):!1}o(wi,"testCircleShape");function yi(e,t){return t instanceof C?os(e,t):t instanceof Re?zr(e,t):t instanceof Ie?Gs(e,t):t instanceof oe?Yr(e,t):t instanceof Ee?Xr(e,t):t instanceof Ze?Jr(t,e):!1}o(yi,"testRectShape");function Ai(e,t){return t instanceof C?Je(e,t):t instanceof Re?ls(t,e):t instanceof Ie?Hs(t,e):t instanceof oe?Xr(t,e):t instanceof Ee?Qr(t,e):t instanceof Ze?Ks(t,e):!1}o(Ai,"testPolygonShape");function vi(e,t){return t instanceof C?Vs(e,t):t instanceof Re?Zt(e,t):t instanceof Ie?Wr(e,t):t instanceof oe?Jr(e,t):t instanceof Ee?Ks(e,t):t instanceof Ze?fi(t,e):!1}o(vi,"testEllipseShape");function Zr(e,t,s){let n=e,r=s.p1,i=s.p2,a=t,d=i.sub(r),l=a.cross(d);if(Math.abs(l)<Number.EPSILON)return null;let u=r.sub(n),f=u.cross(d)/l;if(f<=0||f>=1)return null;let x=u.cross(a)/l;if(x<=0||x>=1)return null;let c=d.normal().unit();return t.dot(c)>0&&(c.x*=-1,c.y*=-1),{point:n.add(a.scale(f)),normal:c,fraction:f}}o(Zr,"raycastLine");function xi(e,t,s){let n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,i;if(e.x!=0){let a=(s.pos.x-e.x)/t.x,d=(s.pos.x+s.width-e.x)/t.x;i=M(-Math.sign(t.x),0),n=Math.max(n,Math.min(a,d)),r=Math.min(r,Math.max(a,d))}if(e.y!=0){let a=(s.pos.y-e.y)/t.y,d=(s.pos.y+s.height-e.y)/t.y;Math.min(a,d)>n&&(i=M(0,-Math.sign(t.y))),n=Math.max(n,Math.min(a,d)),r=Math.min(r,Math.max(a,d))}return r>=n&&n>=0&&n<=1?{point:e.add(t.scale(n)),normal:i,fraction:n}:null}o(xi,"raycastRect");function _r(e,t,s){let n=e,r=s.center,i=t,a=i.dot(i),d=n.sub(r),l=2*i.dot(d),u=d.dot(d)-s.radius*s.radius,f=l*l-4*a*u;if(a<=Number.EPSILON||f<0)return null;if(f==0){let x=-l/(2*a);if(x>=0&&x<=1){let c=n.add(i.scale(x));return{point:c,normal:c.sub(r),fraction:x}}}else{let x=(-l+Math.sqrt(f))/(2*a),c=(-l-Math.sqrt(f))/(2*a),y=null;if(x>=0&&x<=1&&(y=x),c>=0&&c<=1&&(y=Math.min(c,y??c)),y!=null){let g=n.add(i.scale(y));return{point:g,normal:g.sub(r).unit(),fraction:y}}}return null}o(_r,"raycastCircle");function bi(e,t,s){let n=s.pts,r=null,i=n[n.length-1];for(let a=0;a<n.length;a++){let d=n[a],l=Zr(e,t,new Ie(i,d));l&&(!r||r.fraction>l.fraction)&&(r=l),i=d}return r}o(bi,"raycastPolygon");function Ei(e,t,s){let n=s.toMat2(),r=n.inverse,i=r.transform(e.sub(s.center)),a=r.transform(t),d=_r(i,a,new Re(M(),1));if(d){let l=Cs.rotation(de(-s.angle)),u=Cs.scale(s.radiusX,s.radiusY).transform(d.point),f=n.transform(d.point).add(s.center),x=f.dist(e)/t.len();return{point:f,normal:l.transform(M(s.radiusY**2*u.x,s.radiusX**2*u.y)).unit(),fraction:x}}return d}o(Ei,"raycastEllipse");function Mi(e,t,s,n=64){let r=e,i=t.len(),a=t.scale(1/i),d=0,l=M(Math.floor(e.x),Math.floor(e.y)),u=M(a.x>0?1:-1,a.y>0?1:-1),f=M(Math.abs(1/a.x),Math.abs(1/a.y)),x=M(u.x>0?l.x+1-e.x:e.x-l.x,u.y>0?l.y+1-e.y:e.y-l.y),c=M(f.x<1/0?f.x*x.x:1/0,f.y<1/0?f.y*x.y:1/0),y=-1;for(;d<=n;){let g=s(l);if(g===!0)return{point:r.add(a.scale(d)),normal:M(y===0?-u.x:0,y===1?-u.y:0),fraction:d/i,gridPos:l};if(g)return g;c.x<c.y?(l.x+=u.x,d=c.x,c.x+=f.x,y=0):(l.y+=u.y,d=c.y,c.y+=f.y,y=1)}return null}o(Mi,"raycastGrid");var Yt,ql=(Yt=class{constructor(e){E(this,"pt"),this.pt=e.clone()}transform(e){return new Yt(e.multVec2(this.pt))}bbox(){return new oe(this.pt,0,0)}area(){return 0}clone(){return new Yt(this.pt)}collides(e){return gi(this,e)}contains(e){return this.pt.eq(e)}raycast(e,t){return null}random(){return this.pt.clone()}},o(Yt,"Point"),Yt),zt,Ie=(zt=class{constructor(e,t){E(this,"p1"),E(this,"p2"),this.p1=e.clone(),this.p2=t.clone()}transform(e){return new zt(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return oe.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new zt(this.p1,this.p2)}collides(e){return mi(this,e)}contains(e){return this.collides(e)}raycast(e,t){return Zr(e,t,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(pe(1)))}},o(zt,"Line"),zt),Xt,oe=(Xt=class{constructor(e,t,s){E(this,"pos"),E(this,"width"),E(this,"height"),this.pos=e.clone(),this.width=t,this.height=s}static fromPoints(e,t){return new Xt(e.clone(),t.x-e.x,t.y-e.y)}center(){return new C(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Ee(this.points().map(t=>e.multVec2(t)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new Xt(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,s=this.pos.add(this.width,this.height),n=Math.max(t.x-e.x,0,e.x-s.x),r=Math.max(t.y-e.y,0,e.y-s.y);return n*n+r*r}collides(e){return yi(this,e)}contains(e){return this.collides(e)}raycast(e,t){return xi(e,t,this)}random(){return this.pos.add(pe(this.width),pe(this.height))}},o(Xt,"Rect"),Xt),ws,Re=(ws=class{constructor(e,t){E(this,"center"),E(this,"radius"),this.center=e.clone(),this.radius=t}transform(e){return new Ze(this.center,this.radius,this.radius).transform(e)}bbox(){return oe.fromPoints(this.center.sub(M(this.radius)),this.center.add(M(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new ws(this.center,this.radius)}collides(e){return wi(this,e)}contains(e){return this.collides(e)}raycast(e,t){return _r(e,t,this)}random(){return this.center.add(C.fromAngle(pe(360)).scale(pe(this.radius)))}},o(ws,"Circle"),ws),st,Ze=(st=class{constructor(e,t,s,n=0){E(this,"center"),E(this,"radiusX"),E(this,"radiusY"),E(this,"angle"),this.center=e.clone(),this.radiusX=t,this.radiusY=s,this.angle=n}static fromMat2(e){let t=e.inverse,s=t.transpose.mul(t),[n,r]=s.eigenvalues,[i,a]=s.eigenvectors(n,r),[d,l]=[1/Math.sqrt(n),1/Math.sqrt(r)];return d>l?new st(M(),d,l,ot(Math.atan2(-i[1],i[0]))):new st(M(),l,d,ot(Math.atan2(-a[1],a[0])))}toMat2(){let e=de(this.angle),t=Math.cos(e),s=Math.sin(e);return new Cs(t*this.radiusX,-s*this.radiusY,s*this.radiusX,t*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new st(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let t=this.toMat2(),s=e.getRotation(),n=e.getScale();t=Qt.fromMat2(t).scale(n.x,n.y).rotate(s).toMat2();let r=st.fromMat2(t);return r.center=e.multVec2(this.center),r}}bbox(){if(this.angle==0)return oe.fromPoints(this.center.sub(M(this.radiusX,this.radiusY)),this.center.add(M(this.radiusX,this.radiusY)));{let e=de(this.angle),t=Math.cos(e),s=Math.sin(e),n=this.radiusX*t,r=this.radiusX*s,i=this.radiusY*s,a=this.radiusY*t,d=Math.sqrt(n*n+i*i),l=Math.sqrt(r*r+a*a);return oe.fromPoints(this.center.sub(M(d,l)),this.center.add(M(d,l)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new st(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return vi(this,e)}contains(e){e=e.sub(this.center);let t=de(this.angle),s=Math.cos(t),n=Math.sin(t),r=e.x*s+e.y*n,i=-e.x*n+e.y*s;return r*r/(this.radiusX*this.radiusX)+i*i/(this.radiusY*this.radiusY)<1}raycast(e,t){return Ei(e,t,this)}random(){return this.center}},o(st,"Ellipse"),st);function Si(e,t,s,n){let r=t.sub(e),i=n.sub(s),a=r.cross(i);return a<1e-5&&a>-1e-5||(a=s.sub(e).cross(i)/a,a<0||a>1)?null:e.add(r.scale(a))}o(Si,"segmentLineIntersection");var pt,Ee=(pt=class{constructor(e){if(E(this,"pts"),e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new pt(this.pts.map(t=>e.multVec2(t)))}bbox(){let e=M(Number.MAX_VALUE),t=M(-Number.MAX_VALUE);for(let s of this.pts)e.x=Math.min(e.x,s.x),t.x=Math.max(t.x,s.x),e.y=Math.min(e.y,s.y),t.y=Math.max(t.y,s.y);return oe.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let s=0;s<t;s++){let n=this.pts[s],r=this.pts[(s+1)%t];e+=n.x*r.y*.5,e-=r.x*n.y*.5}return Math.abs(e)}clone(){return new pt(this.pts.map(e=>e.clone()))}collides(e){return Ai(this,e)}contains(e){return this.collides(e)}raycast(e,t){return bi(e,t,this)}random(){return M()}cut(e,t){new Ie(e,t);let s=[],n=[],r=t.sub(e),i=this.pts[this.pts.length-1],a=i.sub(e),d=r.cross(a)>0;return this.pts.forEach(l=>{a=l.sub(e);let u=r.cross(a)>0;if(d!=u){let f=Si(i,l,e,t);s.push(f),n.push(f),d=u}(u?s:n).push(l),i=l}),[s.length?new pt(s):null,n.length?new pt(n):null]}},o(pt,"Polygon"),pt);function qi(e,t,s,n){let r=n*n,i=1-n,a=i*i;return e.scale(a).add(t.scale(2*i*n)).add(s.scale(r))}o(qi,"evaluateQuadratic");function Ci(e,t,s,n){let r=1-n;return t.sub(e).scale(2*r).add(s.sub(t).scale(2*n))}o(Ci,"evaluateQuadraticFirstDerivative");function Bi(e,t,s,n){return s.sub(t.scale(2)).add(e).scale(2)}o(Bi,"evaluateQuadraticSecondDerivative");function Ys(e,t,s,n,r){let i=r*r,a=i*r,d=1-r,l=d*d,u=l*d;return e.scale(u).add(t.scale(3*l*r)).add(s.scale(3*d*i)).add(n.scale(a))}o(Ys,"evaluateBezier");function Ri(e,t,s,n,r){let i=r*r,a=1-r,d=a*a;return t.sub(e).scale(3*d).add(s.sub(t).scale(6*a*r)).add(n.sub(s).scale(3*i))}o(Ri,"evaluateBezierFirstDerivative");function Pi(e,t,s,n,r){let i=1-r;return s.sub(t.scale(2)).add(e).scale(6*i).add(n.sub(s.scale(2)).add(t).scale(6*r))}o(Pi,"evaluateBezierSecondDerivative");function Ii(e,t,s,n,r){let i=.5*(((-r+2)*r-1)*r),a=.5*((3*r-5)*r*r+2),d=.5*(((-3*r+4)*r+1)*r),l=.5*((r-1)*r*r);return e.scale(i).add(t.scale(a)).add(s.scale(d)).add(n.scale(l))}o(Ii,"evaluateCatmullRom");function Ti(e,t,s,n,r){let i=.5*((-3*r+4)*r-1),a=.5*((9*r-10)*r),d=.5*((-9*r+8)*r+1),l=.5*((3*r-2)*r);return e.scale(i).add(t.scale(a)).add(s.scale(d)).add(n.scale(l))}o(Ti,"evaluateCatmullRomFirstDerivative");function Fi(e){let t=$r(e),s=t(1);return n=>{let r=n*s,i=t(r,!0);return e(i)}}o(Fi,"normalizedCurve");function $r(e,t=10,s=10){let n=[0],r=[0],i=1/(t-1)/s,a=0,d=e(0),l=0;for(let u=1;u<t;u++){for(let f=0;f<s;f++){l+=i;let x=e(l),c=x.dist(d);a+=c,d=x}n[u]=a,r[u]=l}return r[t-1]=1,(u,f=!1)=>{if(f){let x=u;if(x<=0)return 0;if(x>=a)return 1;let c=0;for(;n[c+1]<x;)c++;let y=r[c],g=r[c+1],S=n[c],p=n[c+1],w=(x-S)/(p-S);return y+(g-y)*w}else{if(u<=0)return 0;if(u>=1)return n[t-1];let x=0;for(;r[x+1]<u;)x++;let c=r[x],y=r[x+1],g=n[x],S=n[x+1],p=(u-c)/(y-c);return g+(S-g)*p}}}o($r,"curveLengthApproximation");function Ot(e,t,s,n){let r=2*e+t-2*n+s,i=-3*e+3*n-2*t-s,a=t,d=e;return l=>{let u=l*l,f=u*l;return r*f+i*u+a*l+d}}o(Ot,"hermite");function en(e,t,s,n,r,i=Ot){let a=i(t.x,(1-r)*(s.x-e.x),(1-r)*(n.x-t.x),s.x),d=i(t.y,(1-r)*(s.y-e.y),(1-r)*(n.y-t.y),s.y);return l=>new C(a(l),d(l))}o(en,"cardinal");function _t(e,t,s,n,r=Ot){return en(e,t,s,n,.5,r)}o(_t,"catmullRom");function ki(e,t,s,n,r=Ot){return _t(n.add(e.sub(t).scale(6)),e,n,e.add(n.sub(s).scale(6)),r)}o(ki,"bezier");function Di(e,t,s,n,r,i,a,d=Ot){let l=d(t.x,.5*(1-r)*(1+a)*(1+i)*(t.x-e.x)+.5*(1-r)*(1-a)*(1-i)*(s.x-t.x),.5*(1-r)*(1+a)*(1-i)*(s.x-t.x)+.5*(1-r)*(1-a)*(1+i)*(n.x-s.x),s.x),u=d(t.y,.5*(1-r)*(1+a)*(1+i)*(t.y-e.y)+.5*(1-r)*(1-a)*(1-i)*(s.y-t.y),.5*(1-r)*(1+a)*(1-i)*(s.y-t.y)+.5*(1-r)*(1-a)*(1+i)*(n.y-s.y),s.y);return f=>new C(l(f),u(f))}o(Di,"kochanekBartels");function Oi(e,t,s,n){let r=2*e+t-2*n+s,i=-3*e+3*n-2*t+s,a=t;return d=>{let l=d*d;return 3*r*l+2*i*d+a}}o(Oi,"hermiteFirstDerivative");function qt(e){return 0<=e&&e<=1}o(qt,"inZeroOneDomain");function Es(e,t){return Math.abs(e-t)<=Number.EPSILON}o(Es,"approximately");function Ct(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}o(Ct,"cubeRoot");function Ui(e,t,s,n){let r=3*e-6*t+3*s,i=-3*e+3*t,a=e,d=-e+3*t-3*s+n;if(Es(d,0)){if(Es(r,0))return Es(i,0)?[]:[-a/i].filter(qt);let p=Math.sqrt(i*i-4*r*a),w=2*r;return[(p-i)/w,(-i-p)/w].filter(qt)}r/=d,i/=d,a/=d;let l=(3*i-r*r)/3,u=l/3,f=(2*r*r*r-9*r*i+27*a)/27,x=f/2,c=x*x+u*u*u;if(c<0){let p=-l/3,w=p*p*p,P=Math.sqrt(w),I=-f/(2*P),U=I<-1?-1:I>1?1:I,D=Math.acos(U),v=2*Ct(P),b=v*Math.cos(D/3)-r/3,q=v*Math.cos((D+2*Math.PI)/3)-r/3,k=v*Math.cos((D+4*Math.PI)/3)-r/3;return[b,q,k].filter(qt)}if(c===0){let p=x<0?Ct(-x):-Ct(x),w=2*p-r/3,P=-p-r/3;return[w,P].filter(qt)}let y=Math.sqrt(c),g=Ct(y-x),S=Ct(y+x);return[g-S-r/3].filter(qt)}o(Ui,"getCubicRoots");function Li(e,t,s,n,r){let i=Ui(e.x-r,t.x-r,s.x-r,n.x-r);return i.length>0?Ys(e,t,s,n,i[0]).y:NaN}o(Li,"cubicBezierYforX");function Ni(e){if(!e||e.length==0)throw new Error("Need at least one point for easingLinear.");let t=e.length;return s=>{if(s<=0||e.length==1||s<=e[0].x)return e[0].y;for(let n=0;n<t;n++)if(e[n].x>=s)return Ue(s,e[n-1].x,e[n].x,e[n-1].y,e[n].y);return e[e.length-1].y}}o(Ni,"easingLinear");function Gi(e,t){return s=>Li(M(0,0),e,t,M(1,1),s)}o(Gi,"easingCubicBezier");function ji(e,t="jump-end"){let s=1/e,n=t=="jump-start"||t=="jump-both",r=t=="jump-end"||t=="jump-both",i=1/(e+(r?1:0)),a=n?i:0;return d=>{let l=Math.floor(d/s);return a+l*i}}o(ji,"easingSteps");function Hi(e,t){let s=Number.MAX_VALUE,n={normal:M(0),distance:0};for(let r of[e,t])for(let i=0;i<r.pts.length;i++){let a=r.pts[i],d=r.pts[(i+1)%r.pts.length].sub(a).normal().unit(),l=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let y=0;y<e.pts.length;y++){let g=e.pts[y].dot(d);l=Math.min(l,g),u=Math.max(u,g)}let f=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let y=0;y<t.pts.length;y++){let g=t.pts[y].dot(d);f=Math.min(f,g),x=Math.max(x,g)}let c=Math.min(u,x)-Math.max(l,f);if(c<0)return null;if(c<Math.abs(s)){let y=x-l,g=f-u;s=Math.abs(y)<Math.abs(g)?y:g,n.normal=d,n.distance=s}}return n}o(Hi,"sat");function tn(e,t,s){return(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x)>=0}o(tn,"isOrientedCcw");function Vi(e){let t=0,s=e[e.length-1];for(let n=0;n<e.length;n++)t+=(e[n].x-s.x)*(e[n].y+s.y),s=e[n];return t<0}o(Vi,"isOrientedCcwPolygon");function Ms(e,t,s,n){let r=n.x-s.x,i=n.y-s.y,a=r*(e.y-s.y)-i*(e.x-s.x),d=r*(t.y-s.y)-i*(t.x-s.x);return a*d>=0}o(Ms,"onSameSide");function Ki(e,t,s,n){return Ms(e,t,s,n)&&Ms(e,s,t,n)&&Ms(e,n,t,s)}o(Ki,"pointInTriangle");function Yi(e,t,s,n){for(let r of e)if(r!==t&&r!==s&&r!==n&&Ki(r,t,s,n))return!0;return!1}o(Yi,"someInTriangle");function zi(e,t,s,n){return tn(e,t,s)&&!Yi(n,e,t,s)}o(zi,"isEar");function sn(e){if(e.length<3)return[];if(e.length==3)return[e];let t=[],s=[],n=0;for(let x=0;x<e.length;x++){let c=e[n],y=e[x];(y.x<c.x||y.x==c.x&&y.y<c.y)&&(n=n),t[x]=x+1,s[x]=x-1}t[t.length-1]=0,s[0]=s.length-1,Vi(e)||([t,s]=[s,t]);let r=[];for(let x=0;x<e.length;++x)tn(e[s[x]],e[x],e[t[x]])||r.push(e[x]);let i=[],a=e.length,d=1,l=0,u,f;for(;a>3;){u=t[d],f=s[d];let x=e[f],c=e[d],y=e[u];if(zi(x,c,y,r))i.push([x,c,y]),t[f]=u,s[u]=f,r.splice(r.indexOf(c),1),--a,l=0;else if(++l>a)return[];d=u}return u=t[d],f=s[d],i.push([e[f],e[d],e[u]]),i}o(sn,"triangulate");function Xi(e){if(e.length<3)return!1;let t=e.length-2,s=e.length-1,n=0,r=e[s].sub(e[t]),i=e[n].sub(e[s]),a=r.cross(i);for(;n+1<e.length;)if(t=s,s=n,n++,r=e[s].sub(e[t]),i=e[n].sub(e[s]),r.cross(i)*a<0)return!1;return!0}o(Xi,"isConvex");var Qi=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",zs="topleft",Cl="monospace",Bs="monospace",Pr="linear",rn=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Bl=rn.reduce((e,t)=>e+t.size,0),Wi=2048,Rl=Wi*4*Bl,Pl=Wi*6,Il=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Tl=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Ir=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Tr=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Fl=new Set(["id","require"]),kl=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),Dl=200,Ol=640,Ul=65536,Ji=Symbol.for("kaplay.cancel"),ar,Zi=(ar=class extends Map{constructor(){super(...arguments),E(this,"lastID",0)}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},o(ar,"Registry"),ar),ys,yt=(ys=class{constructor(e){E(this,"paused",!1),E(this,"cancel"),this.cancel=e}static join(e){let t=new ys(()=>e.forEach(s=>s.cancel()));return Object.defineProperty(t,"paused",{get:o(()=>e[0].paused,"get"),set:o(s=>e.forEach(n=>n.paused=s),"set")}),t.paused=!1,t}static replace(e,t){return e.cancel=()=>t.cancel(),t.paused=e.paused,Object.defineProperty(e,"paused",{get:o(()=>t.paused,"get"),set:o(s=>t.paused=s,"set")}),e}},o(ys,"KEventController"),ys),lr,ve=(lr=class{constructor(){E(this,"cancellers",new WeakMap),E(this,"handlers",new Zi)}add(e){function t(...r){if(!n.paused)return e(...r)}o(t,"handler");let s=this.handlers.pushd(t),n=new yt(s);return this.cancellers.set(t,s),n}addOnce(e){let t=this.add((...s)=>{t.cancel(),e(...s)});return t}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(t=>{let s=t(...e),n;s===Ji&&(n=this.cancellers.get(t))&&n()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},o(lr,"KEvent"),lr),ur,$t=(ur=class{constructor(){E(this,"handlers",{}),E(this,"registers",{})}on(e,t){return this.handlers[e]||(this.handlers[e]=new ve),this.handlers[e].add(t)}onOnce(e,t){let s=this.on(e,(...n)=>{s.cancel(),t(...n)});return s}next(e){return new Promise(t=>{this.onOnce(e,(...s)=>t(s[0]))})}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var t;return((t=this.handlers[e])==null?void 0:t.numListeners())??0}},o(ur,"KEventHandler"),ur),Ll=o(e=>e[0]instanceof Q,"arrayIsColor"),Nl=o(e=>e[0]instanceof C,"arrayIsVec2"),Gl=o(e=>typeof e[0]=="number","arrayIsNumber"),hr,_i=(hr=class{constructor(e=(t,s)=>t<s){E(this,"_items"),E(this,"_compareFn"),this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],t=this._items.pop();return this._items.length!==0&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},o(hr,"BinaryHeap"),hr);function $i(e){let t=window.atob(e),s=t.length,n=new Uint8Array(s);for(let r=0;r<s;r++)n[r]=t.charCodeAt(r);return n.buffer}o($i,"base64ToArrayBuffer");function eo(e){return $i(e.split(",")[1])}o(eo,"dataURLToArrayBuffer");function Xs(e,t){let s=document.createElement("a");s.href=t,s.download=e,s.click()}o(Xs,"download");function nn(e,t){Xs(e,"data:text/plain;charset=utf-8,"+t)}o(nn,"downloadText");function to(e,t){nn(e,JSON.stringify(t))}o(to,"downloadJSON");function Fr(e,t){let s=URL.createObjectURL(t);Xs(e,s),URL.revokeObjectURL(s)}o(Fr,"downloadBlob");var so=o(e=>e.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),jl=o(e=>e.split(".").slice(0,-1).join("."),"getFileName");function Qs(e,t){if(e===t)return!0;let s=typeof e,n=typeof t;if(s!==n)return!1;if(s==="object"&&n==="object"&&e!==null&&t!==null){if(Array.isArray(e)!==Array.isArray(t))return!1;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let a of r){let d=e[a],l=t[a];if(!Qs(d,l))return!1}return!0}return!1}o(Qs,"deepEq");var ei=new Set,Hl=o(e=>e instanceof Error?e.message:String(e),"getErrorMessage");function ro(e){ei.has(e)||(ei.add(e),console.warn(e))}o(ro,"warn");function At(e,t){ro(`${e} is deprecated. Use ${t} instead.`)}o(At,"deprecateMsg");function Rs(e,t){return Number(e.toFixed(t))}o(Rs,"toFixed");function ie(e,t){return(...s)=>{let n=s.length;if(n===e.length)return e(...s);if(n===t.length)return t(...s)}}o(ie,"overload2");var Vl=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function no(e){if(typeof e!="string")throw new TypeError("string cannot be undefined or null");let t=[],s=0,n=0;for(;s<e.length;){if(n+=io(s+n,e),fo(e[s+n])&&n++,uo(e[s+n])&&n++,ho(e[s+n])&&n++,po(e[s+n])){n++;continue}t.push(e.substring(s,s+n)),s+=n,n=0}return t}o(no,"runes");function io(e,t){let s=t[e];if(!oo(s)||e===t.length-1)return 1;let n=s+t[e+1],r=t.substring(e+2,e+5);return kr(n)&&kr(r)?4:ao(n)&&co(r)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:lo(r)?4:2}o(io,"nextUnits");function oo(e){return e&&dt(e[0].charCodeAt(0),55296,56319)}o(oo,"isFirstOfSurrogatePair");function kr(e){return dt(Ws(e),127462,127487)}o(kr,"isRegionalIndicator");function ao(e){return dt(Ws(e),127988,127988)}o(ao,"isSubdivisionFlag");function lo(e){return dt(Ws(e),127995,127999)}o(lo,"isFitzpatrickModifier");function uo(e){return typeof e=="string"&&dt(e.charCodeAt(0),65024,65039)}o(uo,"isVariationSelector");function ho(e){return typeof e=="string"&&dt(e.charCodeAt(0),8400,8447)}o(ho,"isDiacriticalMark");function co(e){let t=e.codePointAt(0);return typeof e=="string"&&typeof t=="number"&&dt(t,917504,917631)}o(co,"isSupplementarySpecialpurposePlane");function fo(e){return typeof e=="string"&&Vl.includes(e.charCodeAt(0))}o(fo,"isGrapheme");function po(e){return typeof e=="string"&&e.charCodeAt(0)===8205}o(po,"isZeroWidthJoiner");function Ws(e){let t=e.charCodeAt(0)-55296,s=e.charCodeAt(1)-56320;return(t<<10)+s+65536}o(Ws,"codePointFromSurrogatePair");function dt(e,t,s){return e>=t&&e<=s}o(dt,"betweenInclusive");var Fe=o((e,t)=>Array.isArray(e)?e==null?void 0:e.includes(t):e===t,"isEqOrIncludes"),je=o((e,t)=>Array.isArray(t)?t.some(s=>e.has(s)):e.has(t),"setHasOrIncludes"),As=o((e,t,s)=>{var n;e.has(t)?(n=e.get(t))==null||n.push(s):e.set(t,[s])},"mapAddOrPush"),Kl=(()=>{let e=0;return()=>e++})(),Yl={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},zl=o(()=>mt.lastInputDevice,"getLastInputDeviceType"),Xl=o(()=>{let e=mt.buttons;for(let t in e){let s=e[t].keyboard&&[e[t].keyboard].flat(),n=e[t].keyboardCode&&[e[t].keyboardCode].flat(),r=e[t].gamepad&&[e[t].gamepad].flat(),i=e[t].mouse&&[e[t].mouse].flat();s&&s.forEach(a=>{As(mt.buttonsByKey,a,t)}),n&&n.forEach(a=>{As(mt.buttonsByKeyCode,a,t)}),r&&r.forEach(a=>{As(mt.buttonsByGamepad,a,t)}),i&&i.forEach(a=>{As(mt.buttonsByMouse,a,t)})}},"parseButtonBindings"),cr,Wt=(cr=class{constructor(){E(this,"pressed",new Set([])),E(this,"pressedRepeat",new Set([])),E(this,"released",new Set([])),E(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},o(cr,"ButtonState"),cr),dr,Ql=(dr=class{constructor(){E(this,"buttonState",new Wt),E(this,"stickState",new Map)}},o(dr,"GamepadState"),dr),fr,Wl=(fr=class{constructor(){E(this,"dts",[]),E(this,"timer",0),E(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((t,s)=>t+s)/this.dts.length)),this.dts=[])}},o(fr,"FPSCounter"),fr),mt,ti=Yl,Jl=o(e=>{let t=e.buttons??{};return{canvas:e.canvas,buttons:t,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Wl,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new C(0),mouseDeltaPos:new C(0),keyState:new Wt,mouseState:new Wt,mergedGamepadState:new Ql,gamepadStates:new Map,lastInputDevice:null,buttonState:new Wt,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new $t}},"initAppState"),Zl=o(e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t=Jl(e);mt=t,Xl();function s(){return t.dt*t.timeScale}o(s,"dt");function n(){return t.fixedDt*t.timeScale}o(n,"fixedDt");function r(){return t.restDt*t.timeScale}o(r,"restDt");function i(){return t.isHidden}o(i,"isHidden");function a(){return t.time}o(a,"time");function d(){return t.fpsCounter.fps}o(d,"fps");function l(){return t.numFrames}o(l,"numFrames");function u(){return t.canvas.toDataURL()}o(u,"screenshot");function f(m){t.canvas.style.cursor=m}o(f,"setCursor");function x(){return t.canvas.style.cursor}o(x,"getCursor");function c(m){if(m)try{let R=t.canvas.requestPointerLock();R.catch&&R.catch(B=>console.error(B))}catch(R){console.error(R)}else document.exitPointerLock()}o(c,"setCursorLocked");function y(){return!!document.pointerLockElement}o(y,"isCursorLocked");function g(m){m.requestFullscreen?m.requestFullscreen():m.webkitRequestFullscreen&&m.webkitRequestFullscreen()}o(g,"enterFullscreen");function S(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}o(S,"exitFullscreen");function p(m=!0){m?g(t.canvas):S()}o(p,"setFullscreen");function w(){return document.fullscreenElement===t.canvas||document.webkitFullscreenElement===t.canvas}o(w,"isFullscreen");function P(){t.stopped=!0;let m=Object.entries(Se),R=Object.entries(ir),B=Object.entries(ms);for(let[F,K]of m)t.canvas.removeEventListener(F,K);for(let[F,K]of R)document.removeEventListener(F,K);for(let[F,K]of B)window.removeEventListener(F,K);_n.disconnect()}o(P,"quit");function I(m,R){t.loopID!==null&&cancelAnimationFrame(t.loopID);let B=0,F=0,K=o(ne=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame(K);return}let we=ne/1e3,he=Math.min(we-t.realTime,.25),ze=e.maxFPS?1/e.maxFPS:0;if(t.realTime=we,F+=he,F>ze){if(!t.skipTime){for(B+=F,t.dt=t.fixedDt,t.restDt=0;B>t.fixedDt;)B-=t.fixedDt,B<t.fixedDt&&(t.restDt=B),m();t.restDt=B,t.dt=F,t.time+=s(),t.fpsCounter.tick(t.dt)}F=0,t.skipTime=!1,t.numFrames++,R(Vt,zn)}t.loopID=requestAnimationFrame(K)},"frame");K(0)}o(I,"run");function U(){return"ontouchstart"in window||navigator.maxTouchPoints>0}o(U,"isTouchscreen");function D(){return t.mousePos.clone()}o(D,"mousePos");function v(){return t.mouseDeltaPos.clone()}o(v,"mouseDeltaPos");function b(m="left"){return t.mouseState.pressed.has(m)}o(b,"isMousePressed");function q(m="left"){return t.mouseState.down.has(m)}o(q,"isMouseDown");function k(m="left"){return t.mouseState.released.has(m)}o(k,"isMouseReleased");function T(){return t.isMouseMoved}o(T,"isMouseMoved");function O(m){return m===void 0?t.keyState.pressed.size>0:je(t.keyState.pressed,m)}o(O,"isKeyPressed");function L(m){return m===void 0?t.keyState.pressedRepeat.size>0:je(t.keyState.pressedRepeat,m)}o(L,"isKeyPressedRepeat");function j(m){return m===void 0?t.keyState.down.size>0:je(t.keyState.down,m)}o(j,"isKeyDown");function H(m){return m===void 0?t.keyState.released.size>0:je(t.keyState.released,m)}o(H,"isKeyReleased");function W(m){return m===void 0?t.mergedGamepadState.buttonState.pressed.size>0:je(t.mergedGamepadState.buttonState.pressed,m)}o(W,"isGamepadButtonPressed");function G(m){return m===void 0?t.mergedGamepadState.buttonState.down.size>0:je(t.mergedGamepadState.buttonState.down,m)}o(G,"isGamepadButtonDown");function z(m){return m===void 0?t.mergedGamepadState.buttonState.released.size>0:je(t.mergedGamepadState.buttonState.released,m)}o(z,"isGamepadButtonReleased");function te(m){return m===void 0?t.buttonState.pressed.size>0:je(t.buttonState.pressed,m)}o(te,"isButtonPressed");function Z(m){return m===void 0?t.buttonState.down.size>0:je(t.buttonState.down,m)}o(Z,"isButtonDown");function J(m){return m===void 0?t.buttonState.released.size>0:je(t.buttonState.released,m)}o(J,"isButtonReleased");function ue(m){var R;return(R=t.buttons)==null?void 0:R[m]}o(ue,"getButton");function V(m,R){t.buttons[m]={...t.buttons[m],...R}}o(V,"setButton");function Ve(m){t.buttonState.press(m),t.events.trigger("buttonPress",m)}o(Ve,"pressButton");function $e(m){t.buttonState.release(m),t.events.trigger("buttonRelease",m)}o($e,"releaseButton");function Ut(m){return t.events.on("resize",m)}o(Ut,"onResize");let tr=ie(m=>t.events.on("keyDown",m),(m,R)=>t.events.on("keyDown",B=>Fe(m,B)&&R(B))),Lt=ie(m=>t.events.on("keyPress",R=>m(R)),(m,R)=>t.events.on("keyPress",B=>Fe(m,B)&&R(B))),Nt=ie(m=>t.events.on("keyPressRepeat",m),(m,R)=>t.events.on("keyPressRepeat",B=>Fe(m,B)&&R(B))),ds=ie(m=>t.events.on("keyRelease",m),(m,R)=>t.events.on("keyRelease",B=>Fe(m,B)&&R(B))),fs=ie(m=>t.events.on("mouseDown",R=>m(R)),(m,R)=>t.events.on("mouseDown",B=>Fe(m,B)&&R(B))),bt=ie(m=>t.events.on("mousePress",R=>m(R)),(m,R)=>t.events.on("mousePress",B=>Fe(m,B)&&R(B))),Ne=ie(m=>t.events.on("mouseRelease",R=>m(R)),(m,R)=>t.events.on("mouseRelease",B=>B===m&&R(B)));function Gt(m){return t.events.on("mouseMove",()=>m(D(),v()))}o(Gt,"onMouseMove");function N(m){return t.events.on("charInput",m)}o(N,"onCharInput");function Y(m){return t.events.on("touchStart",m)}o(Y,"onTouchStart");function X(m){return t.events.on("touchMove",m)}o(X,"onTouchMove");function se(m){return t.events.on("touchEnd",m)}o(se,"onTouchEnd");function fe(m){return t.events.on("scroll",m)}o(fe,"onScroll");function _(m){return t.events.on("hide",m)}o(_,"onHide");function Ae(m){return t.events.on("show",m)}o(Ae,"onShow");let et=ie(m=>t.events.on("gamepadButtonPress",(R,B)=>m(R,B)),(m,R)=>t.events.on("gamepadButtonPress",(B,F)=>Fe(m,B)&&R(B,F))),sr=ie(m=>t.events.on("gamepadButtonDown",(R,B)=>m(R,B)),(m,R)=>t.events.on("gamepadButtonDown",(B,F)=>Fe(m,B)&&R(B,F))),rr=ie(m=>t.events.on("gamepadButtonRelease",(R,B)=>m(R,B)),(m,R)=>t.events.on("gamepadButtonRelease",(B,F)=>Fe(m,B)&&R(B,F)));function ps(m,R){return t.events.on("gamepadStick",(B,F,K)=>B===m&&R(F,K))}o(ps,"onGamepadStick");function gs(m){t.events.on("gamepadConnect",m)}o(gs,"onGamepadConnect");function jt(m){t.events.on("gamepadDisconnect",m)}o(jt,"onGamepadDisconnect");function De(m){return t.mergedGamepadState.stickState.get(m)||new C(0)}o(De,"getGamepadStick");function Ke(){return[...t.charInputted]}o(Ke,"charInputted");function Et(){return[...t.gamepads]}o(Et,"getGamepads");let Te=ie(m=>t.events.on("buttonPress",R=>m(R)),(m,R)=>t.events.on("buttonPress",B=>Fe(m,B)&&R(B))),Ht=ie(m=>t.events.on("buttonDown",R=>m(R)),(m,R)=>t.events.on("buttonDown",B=>Fe(m,B)&&R(B))),Ye=ie(m=>t.events.on("buttonRelease",R=>m(R)),(m,R)=>t.events.on("buttonRelease",B=>Fe(m,B)&&R(B)));function Vt(){t.events.trigger("input"),t.keyState.down.forEach(m=>t.events.trigger("keyDown",m)),t.mouseState.down.forEach(m=>t.events.trigger("mouseDown",m)),t.buttonState.down.forEach(m=>{t.events.trigger("buttonDown",m)}),Qn()}o(Vt,"processInput");function zn(){t.keyState.update(),t.mouseState.update(),t.buttonState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((m,R)=>{t.mergedGamepadState.stickState.set(R,new C(0))}),t.charInputted=[],t.isMouseMoved=!1,t.mouseDeltaPos=new C(0),t.gamepadStates.forEach(m=>{m.buttonState.update(),m.stickState.forEach((R,B)=>{m.stickState.set(B,new C(0))})})}o(zn,"resetInput");function nr(m){let R={index:m.index,isPressed:o(B=>{var F;return((F=t.gamepadStates.get(m.index))==null?void 0:F.buttonState.pressed.has(B))||!1},"isPressed"),isDown:o(B=>{var F;return((F=t.gamepadStates.get(m.index))==null?void 0:F.buttonState.down.has(B))||!1},"isDown"),isReleased:o(B=>{var F;return((F=t.gamepadStates.get(m.index))==null?void 0:F.buttonState.released.has(B))||!1},"isReleased"),getStick:o(B=>{var F;return((F=t.gamepadStates.get(m.index))==null?void 0:F.stickState.get(B))||M()},"getStick")};return t.gamepads.push(R),t.gamepadStates.set(m.index,{buttonState:new Wt,stickState:new Map([["left",new C(0)],["right",new C(0)]])}),R}o(nr,"registerGamepad");function Xn(m){t.gamepads=t.gamepads.filter(R=>R.index!==m.index),t.gamepadStates.delete(m.index)}o(Xn,"removeGamepad");function Qn(){var m,R;for(let B of navigator.getGamepads())B&&!t.gamepadStates.has(B.index)&&nr(B);for(let B of t.gamepads){let F=navigator.getGamepads()[B.index];if(!F)continue;let K=(e.gamepads??{})[F.id]||ti[F.id]||ti.default,ne=t.gamepadStates.get(B.index);if(ne){for(let we=0;we<F.buttons.length;we++){let he=K.buttons[we],ze=F.buttons[we],Ge=t.buttonsByGamepad.has(he);if(ze.pressed){if(ne.buttonState.down.has(he)){t.events.trigger("gamepadButtonDown",he,B);continue}t.lastInputDevice="gamepad",Ge&&((m=t.buttonsByGamepad.get(he))==null||m.forEach(Xe=>{t.buttonState.press(Xe),t.events.trigger("buttonPress",Xe)})),t.mergedGamepadState.buttonState.press(he),ne.buttonState.press(he),t.events.trigger("gamepadButtonPress",he,B)}else ne.buttonState.down.has(he)&&(Ge&&((R=t.buttonsByGamepad.get(he))==null||R.forEach(Xe=>{t.buttonState.release(Xe),t.events.trigger("buttonRelease",Xe)})),t.mergedGamepadState.buttonState.release(he),ne.buttonState.release(he),t.events.trigger("gamepadButtonRelease",he,B))}for(let we in K.sticks){let he=K.sticks[we];if(!he)continue;let ze=new C(F.axes[he.x],F.axes[he.y]);ne.stickState.set(we,ze),t.mergedGamepadState.stickState.set(we,ze),t.events.trigger("gamepadStick",we,ze,B)}}}}o(Qn,"processGamepad");let Se={},ir={},ms={},Wn=e.pixelDensity||1;Se.mousemove=m=>{let R=new C(m.offsetX,m.offsetY),B=new C(m.movementX,m.movementY);if(w()){let F=t.canvas.width/Wn,K=t.canvas.height/Wn,ne=window.innerWidth,we=window.innerHeight,he=ne/we,ze=F/K;if(he>ze){let Ge=we/K,Xe=(ne-F*Ge)/2;R.x=Ue(m.offsetX-Xe,0,F*Ge,0,F),R.y=Ue(m.offsetY,0,K*Ge,0,K)}else{let Ge=ne/F,Xe=(we-K*Ge)/2;R.x=Ue(m.offsetX,0,F*Ge,0,F),R.y=Ue(m.offsetY-Xe,0,K*Ge,0,K)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=R,t.mouseDeltaPos=B,t.events.trigger("mouseMove")})};let Jn=["left","middle","right","back","forward"];Se.mousedown=m=>{t.events.onOnce("input",()=>{var R;let B=Jn[m.button];B&&(t.lastInputDevice="mouse",t.buttonsByMouse.has(B)&&((R=t.buttonsByMouse.get(B))==null||R.forEach(F=>{t.buttonState.press(F),t.events.trigger("buttonPress",F)})),t.mouseState.press(B),t.events.trigger("mousePress",B))})},Se.mouseup=m=>{t.events.onOnce("input",()=>{var R;let B=Jn[m.button];B&&(t.buttonsByMouse.has(B)&&((R=t.buttonsByMouse.get(B))==null||R.forEach(F=>{t.buttonState.release(F),t.events.trigger("buttonRelease",F)})),t.mouseState.release(B),t.events.trigger("mouseRelease",B))})};let yl=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Zn={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};Se.keydown=m=>{yl.has(m.key)&&m.preventDefault(),t.events.onOnce("input",()=>{var R,B;let F=Zn[m.key]||m.key.toLowerCase(),K=m.code;if(F===void 0)throw new Error(`Unknown key: ${m.key}`);F.length===1?(t.events.trigger("charInput",F),t.charInputted.push(F)):F==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),m.repeat?(t.keyState.pressRepeat(F),t.events.trigger("keyPressRepeat",F)):(t.lastInputDevice="keyboard",t.buttonsByKey.has(F)&&((R=t.buttonsByKey.get(F))==null||R.forEach(ne=>{t.buttonState.press(ne),t.events.trigger("buttonPress",ne)})),t.buttonsByKeyCode.has(K)&&((B=t.buttonsByKeyCode.get(K))==null||B.forEach(ne=>{t.buttonState.press(ne),t.events.trigger("buttonPress",ne)})),t.keyState.press(F),t.events.trigger("keyPressRepeat",F),t.events.trigger("keyPress",F))})},Se.keyup=m=>{t.events.onOnce("input",()=>{var R,B;let F=Zn[m.key]||m.key.toLowerCase(),K=m.code;t.buttonsByKey.has(F)&&((R=t.buttonsByKey.get(F))==null||R.forEach(ne=>{t.buttonState.release(ne),t.events.trigger("buttonRelease",ne)})),t.buttonsByKeyCode.has(K)&&((B=t.buttonsByKeyCode.get(K))==null||B.forEach(ne=>{t.buttonState.release(ne),t.events.trigger("buttonRelease",ne)})),t.keyState.release(F),t.events.trigger("keyRelease",F)})},Se.touchstart=m=>{m.preventDefault(),t.events.onOnce("input",()=>{var R;let B=[...m.changedTouches],F=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new C(B[0].clientX-F.x,B[0].clientY-F.y),t.lastInputDevice="mouse",t.buttonsByMouse.has("left")&&((R=t.buttonsByMouse.get("left"))==null||R.forEach(K=>{t.buttonState.press(K),t.events.trigger("buttonPress",K)})),t.mouseState.press("left"),t.events.trigger("mousePress","left")),B.forEach(K=>{t.events.trigger("touchStart",new C(K.clientX-F.x,K.clientY-F.y),K)})})},Se.touchmove=m=>{m.preventDefault(),t.events.onOnce("input",()=>{let R=[...m.changedTouches],B=t.canvas.getBoundingClientRect();if(e.touchToMouse!==!1){let F=t.mousePos;t.mousePos=new C(R[0].clientX-B.x,R[0].clientY-B.y),t.mouseDeltaPos=t.mousePos.sub(F),t.events.trigger("mouseMove")}R.forEach(F=>{t.events.trigger("touchMove",new C(F.clientX-B.x,F.clientY-B.y),F)})})},Se.touchend=m=>{t.events.onOnce("input",()=>{var R;let B=[...m.changedTouches],F=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new C(B[0].clientX-F.x,B[0].clientY-F.y),t.mouseDeltaPos=new C(0,0),t.buttonsByMouse.has("left")&&((R=t.buttonsByMouse.get("left"))==null||R.forEach(K=>{t.buttonState.release(K),t.events.trigger("buttonRelease",K)})),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),B.forEach(K=>{t.events.trigger("touchEnd",new C(K.clientX-F.x,K.clientY-F.y),K)})})},Se.touchcancel=m=>{t.events.onOnce("input",()=>{let R=[...m.changedTouches],B=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=new C(R[0].clientX-B.x,R[0].clientY-B.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),R.forEach(F=>{t.events.trigger("touchEnd",new C(F.clientX-B.x,F.clientY-B.y),F)})})},Se.wheel=m=>{m.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new C(m.deltaX,m.deltaY))})},Se.contextmenu=m=>m.preventDefault(),ir.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.isHidden=!1,t.events.trigger("show")):(t.isHidden=!0,t.events.trigger("hide"))},ms.gamepadconnected=m=>{let R=nr(m.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",R)})},ms.gamepaddisconnected=m=>{let R=Et().filter(B=>B.index===m.gamepad.index)[0];Xn(m.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",R)})};for(let[m,R]of Object.entries(Se))t.canvas.addEventListener(m,R);for(let[m,R]of Object.entries(ir))document.addEventListener(m,R);for(let[m,R]of Object.entries(ms))window.addEventListener(m,R);let _n=new ResizeObserver(m=>{for(let R of m)if(R.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return _n.observe(t.canvas),{state:t,dt:s,fixedDt:n,restDt:r,time:a,run:I,canvas:t.canvas,fps:d,numFrames:l,quit:P,isHidden:i,setFullscreen:p,isFullscreen:w,setCursor:f,screenshot:u,getGamepads:Et,getCursor:x,setCursorLocked:c,isCursorLocked:y,isTouchscreen:U,mousePos:D,mouseDeltaPos:v,isKeyDown:j,isKeyPressed:O,isKeyPressedRepeat:L,isKeyReleased:H,isMouseDown:q,isMousePressed:b,isMouseReleased:k,isMouseMoved:T,isGamepadButtonPressed:W,isGamepadButtonDown:G,isGamepadButtonReleased:z,getGamepadStick:De,isButtonPressed:te,isButtonDown:Z,isButtonReleased:J,setButton:V,getButton:ue,pressButton:Ve,releaseButton:$e,charInputted:Ke,onResize:Ut,onKeyDown:tr,onKeyPress:Lt,onKeyPressRepeat:Nt,onKeyRelease:ds,onMouseDown:fs,onMousePress:bt,onMouseRelease:Ne,onMouseMove:Gt,onCharInput:N,onTouchStart:Y,onTouchMove:X,onTouchEnd:se,onScroll:fe,onHide:_,onShow:Ae,onGamepadButtonDown:sr,onGamepadButtonPress:et,onGamepadButtonRelease:rr,onGamepadStick:ps,onGamepadConnect:gs,onGamepadDisconnect:jt,onButtonPress:Te,onButtonDown:Ht,onButtonRelease:Ye,getLastInputDeviceType:zl,events:t.events}},"initApp");function ge(){return h.app.dt()}o(ge,"dt");function Ps(){return h.app.fixedDt()}o(Ps,"fixedDt");function Is(){return h.app.restDt()}o(Is,"restDt");var _l=new C(-1,-1),$l=new C(0,-1),eu=new C(1,-1),tu=new C(-1,0),su=new C(0,0),ru=new C(1,0),nu=new C(-1,1),iu=new C(0,1),ou=new C(1,1);function vt(e){switch(e){case"topleft":return _l;case"top":return $l;case"topright":return eu;case"left":return tu;case"center":return su;case"right":return ru;case"botleft":return nu;case"bot":return iu;case"botright":return ou;default:return e}}o(vt,"anchorPt");function go(e){switch(e){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}o(go,"alignPt");function mo(e){return e.createBuffer(1,1,44100)}o(mo,"createEmptyAudioBuffer");var vs=2.5949095,si=1.70158+1,ri=2*Math.PI/3,ni=2*Math.PI/4.5,Ss={linear:o(e=>e,"linear"),easeInSine:o(e=>1-Math.cos(e*Math.PI/2),"easeInSine"),easeOutSine:o(e=>Math.sin(e*Math.PI/2),"easeOutSine"),easeInOutSine:o(e=>-(Math.cos(Math.PI*e)-1)/2,"easeInOutSine"),easeInQuad:o(e=>e*e,"easeInQuad"),easeOutQuad:o(e=>1-(1-e)*(1-e),"easeOutQuad"),easeInOutQuad:o(e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,"easeInOutQuad"),easeInCubic:o(e=>e*e*e,"easeInCubic"),easeOutCubic:o(e=>1-Math.pow(1-e,3),"easeOutCubic"),easeInOutCubic:o(e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,"easeInOutCubic"),easeInQuart:o(e=>e*e*e*e,"easeInQuart"),easeOutQuart:o(e=>1-Math.pow(1-e,4),"easeOutQuart"),easeInOutQuart:o(e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,"easeInOutQuart"),easeInQuint:o(e=>e*e*e*e*e,"easeInQuint"),easeOutQuint:o(e=>1-Math.pow(1-e,5),"easeOutQuint"),easeInOutQuint:o(e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,"easeInOutQuint"),easeInExpo:o(e=>e===0?0:Math.pow(2,10*e-10),"easeInExpo"),easeOutExpo:o(e=>e===1?1:1-Math.pow(2,-10*e),"easeOutExpo"),easeInOutExpo:o(e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,"easeInOutExpo"),easeInCirc:o(e=>1-Math.sqrt(1-Math.pow(e,2)),"easeInCirc"),easeOutCirc:o(e=>Math.sqrt(1-Math.pow(e-1,2)),"easeOutCirc"),easeInOutCirc:o(e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,"easeInOutCirc"),easeInBack:o(e=>si*e*e*e-1.70158*e*e,"easeInBack"),easeOutBack:o(e=>1+si*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),"easeOutBack"),easeInOutBack:o(e=>e<.5?Math.pow(2*e,2)*((vs+1)*2*e-vs)/2:(Math.pow(2*e-2,2)*((vs+1)*(e*2-2)+vs)+2)/2,"easeInOutBack"),easeInElastic:o(e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*ri),"easeInElastic"),easeOutElastic:o(e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*ri)+1,"easeOutElastic"),easeInOutElastic:o(e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*ni))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*ni)/2+1,"easeInOutElastic"),easeInBounce:o(e=>1-Ss.easeOutBounce(1-e),"easeInBounce"),easeOutBounce:o(e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,"easeOutBounce"),easeInOutBounce:o(e=>e<.5?(1-Ss.easeOutBounce(1-2*e))/2:(1+Ss.easeOutBounce(2*e-1))/2,"easeInOutBounce")},es=Ss;function wo(e,t,s){let n=[],r=t;for(n.push(r);r!==e;){if(r=s.get(r),r==null)return null;n.push(r)}return n.reverse()}o(wo,"buildPath");function yo(e,t,s){var n;let r=new _i((d,l)=>d.cost<l.cost);r.insert({cost:0,node:t});let i=new Map;i.set(t,t);let a=new Map;for(a.set(t,0);r.length!==0;){let d=(n=r.remove())==null?void 0:n.node;if(d===s)break;let l=e.getNeighbours(d);for(let u of l){let f=(a.get(d)||0)+e.getCost(d,u)+e.getHeuristic(u,s);(!a.has(u)||f<a.get(u))&&(a.set(u,f),r.insert({cost:f,node:u}),i.set(u,d))}}return wo(t,s,i)}o(yo,"aStarSearch");var pr,au=(pr=class{constructor(e,t,s){E(this,"a"),E(this,"b"),E(this,"polygon"),this.a=e,this.b=t,this.polygon=new WeakRef(s)}isLeft(e,t){return(this.b.x-this.a.x)*(t-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},o(pr,"NavEdge"),pr),gr,lu=(gr=class{constructor(e){E(this,"_edges"),E(this,"_centroid"),E(this,"_id"),this._id=e}get id(){return this._id}set edges(e){this._edges=e;let t=0,s=0,n=0;for(let r of this._edges){r.polygon=new WeakRef(this);let i=r.a.x*r.b.y-r.a.y*r.b.x;t+=(r.a.x+r.b.x)*i,s+=(r.a.y+r.b.y)*i,n+=i}n/=2,this._centroid=M(t/(6*n),s/(6*n))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let t=!1;for(let s of this.edges)s.b.y>e.y!=s.a.y>e.y&&e.x<(s.a.x-s.b.x)*(e.y-s.b.y)/(s.a.y-s.b.y)+s.b.x&&(t=!t);return t}},o(gr,"NavPolygon"),gr),mr,uu=(mr=class{constructor(){E(this,"_polygons"),E(this,"_pointCache"),E(this,"_edgeCache"),this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let t=this._pointCache[`${e.x}_${e.y}`];return t||(t=e.clone(),this._pointCache[`${e.x}_${e.y}`]=t,t)}_addEdge(e){let t=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[t]=e,e}_findEdge(e,t){let s=`${e.x}_${e.y}-${t.x}_${t.y}`;return this._edgeCache[s]}_findCommonEdge(e,t){for(let s of e.edges){let n=this._findEdge(s.b,s.a);if(n&&n.polygon.deref().id===t.id)return n}return null}addPolygon(e){let t=new lu(this._polygons.length),s=e.map((n,r)=>new au(n,e[(r+1)%e.length],t));t.edges=s,this._polygons.push(t);for(let n of t.edges)this._addEdge(n);return t}addRect(e,t){let s=this._addPoint(e),n=this._addPoint(e.add(t.x,0)),r=this._addPoint(e.add(t)),i=this._addPoint(e.add(0,t.y));return this.addPolygon([s,n,r,i])}_getLocation(e){for(let t of this._polygons)if(t.contains(e))return t;return null}getNeighbours(e){let t=[];for(let s of this._polygons[e].edges){let n=this._findEdge(s.b,s.a);if(n){let r=n.polygon.deref();r&&t.push(r.id)}}return t}getCost(e,t){return 1}getHeuristic(e,t){let s=this._polygons[e],n=this._polygons[t],r=s.centroid.x-n.centroid.x,i=s.centroid.y-n.centroid.y;return Math.sqrt(r*r+i*i)}getPath(e,t){return e===void 0||t===void 0?[]:e===t?[e,t]:yo(this,e,t)}getWaypointPath(e,t,s){let n=(s==null?void 0:s.type)||"centroids",r=this._getLocation(e),i=this._getLocation(t);if(r===void 0||i===void 0)return[];let a=this.getPath(r.id,i.id);if(!a)return[];if(n==="edges"){let d=[];for(let l=1;l<a.length;l++){let u=this._polygons[a[l-1]],f=this._polygons[a[l]],x=this._findCommonEdge(u,f);d.push(x.middle.add(f.centroid.sub(x.middle).unit().scale(4)))}return[e,...d,t]}else return[e,...a.slice(1,-1).map(d=>this._polygons[d].centroid),t]}},o(mr,"NavMesh"),mr);function Pt(e){let t=new He;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}o(Pt,"calcTransform");function Ao(e){return new C(e.x/me()*2-1,-e.y/ye()*2+1)}o(Ao,"screen2ndc");function Bt(e,t,s,n,r,i=1){n=de(n%360),r=de(r%360),r<=n&&(r+=Math.PI*2);let a=[],d=Math.ceil((r-n)/de(8)*i),l=(r-n)/d,u=M(Math.cos(n),Math.sin(n)),f=M(Math.cos(l),Math.sin(l));for(let x=0;x<=d;x++)a.push(e.add(t*u.x,s*u.y)),u=M(u.x*f.x-u.y*f.y,u.x*f.y+u.y*f.x);return a}o(Bt,"getArcPts");function vo(...e){let t=$(...e),s=e[3]??1;h.gfx.bgColor=t,h.gfx.bgAlpha=s,h.gfx.ggl.gl.clearColor(t.r/255,t.g/255,t.b/255,s)}o(vo,"setBackground");function xo(){var e,t;return((t=(e=h.gfx.bgColor)==null?void 0:e.clone)==null?void 0:t.call(e))??null}o(xo,"getBackground");function ae(...e){if(e[0]===void 0)return;let t=M(...e);t.x===0&&t.y===0||h.gfx.transform.translate(t)}o(ae,"pushTranslate");function qe(){h.gfx.transformStack.push(h.gfx.transform.clone())}o(qe,"pushTransform");function bo(e){h.gfx.transform=e.clone()}o(bo,"pushMatrix");function Ft(...e){if(e[0]===void 0)return;let t=M(...e);t.x===1&&t.y===1||h.gfx.transform.scale(t)}o(Ft,"pushScale");function wt(e){e&&h.gfx.transform.rotate(e)}o(wt,"pushRotate");function xe(){h.gfx.transformStack.length>0&&(h.gfx.transform=h.gfx.transformStack.pop())}o(xe,"popTransform");function Ce(){h.gfx.renderer.flush()}o(Ce,"flush");function me(){return h.gfx.width}o(me,"width");function ye(){return h.gfx.height}o(ye,"height");function on(){return(h.gfx.viewport.width+h.gfx.viewport.height)/(h.gfx.width+h.gfx.height)}o(on,"getViewportScale");function Eo(e){return new C(e.x*h.gfx.viewport.width/h.gfx.width,e.y*h.gfx.viewport.height/h.gfx.height)}o(Eo,"contentToView");function Mo(e){return new C((e.x-h.gfx.viewport.x)*me()/h.gfx.viewport.width,(e.y-h.gfx.viewport.y)*ye()/h.gfx.viewport.height)}o(Mo,"windowToContent");function an(){return Mo(h.app.mousePos())}o(an,"mousePos");function ts(){return M(me()/2,ye()/2)}o(ts,"center");var wr,hu=(wr=class{constructor(e,t,s){E(this,"textures",[]),E(this,"bigTextures",[]),E(this,"canvas"),E(this,"c2d"),E(this,"x",0),E(this,"y",0),E(this,"curHeight",0),E(this,"gfx"),this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=s,this.textures=[nt.fromImage(e,this.canvas)],this.bigTextures=[];let n=this.canvas.getContext("2d");if(!n)throw new Error("Failed to get 2d context");this.c2d=n}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height){let n=nt.fromImage(this.gfx,e);return this.bigTextures.push(n),[n,new le(0,0,1,1)]}this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(nt.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],s=new C(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,s.x,s.y):this.c2d.drawImage(e,s.x,s.y),t.update(this.canvas),[t,new le(s.x/this.canvas.width,s.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}},o(wr,"TexPacker"),wr);function Pe(e){return typeof e!="string"||so(e)?e:h.assets.urlPrefix+e}o(Pe,"fixURL");var xs,ke=(xs=class{constructor(e){E(this,"loaded",!1),E(this,"data",null),E(this,"error",null),E(this,"onLoadEvents",new ve),E(this,"onErrorEvents",new ve),E(this,"onFinishEvents",new ve),e.then(t=>{this.loaded=!0,this.data=t,this.onLoadEvents.trigger(t)}).catch(t=>{if(this.error=t,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(t);else throw t}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let t=new xs(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},o(xs,"Asset"),xs),yr,Mt=(yr=class{constructor(){E(this,"assets",new Map),E(this,"lastUID",0)}add(e,t){let s=e??this.lastUID+++"",n=new ke(t);return this.assets.set(s,n),n}addLoaded(e,t){let s=e??this.lastUID+++"",n=ke.loaded(t);return this.assets.set(s,n),n}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(t=>{t.loaded&&e++}),e/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(e=>this.assets.get(e).error!==null).map(e=>[e,this.assets.get(e)])}},o(yr,"AssetBucket"),yr);function Js(e){return fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t})}o(Js,"fetchURL");function us(e){return Js(e).then(t=>t.json())}o(us,"fetchJSON");function So(e){return Js(e).then(t=>t.text())}o(So,"fetchText");function qo(e){return Js(e).then(t=>t.arrayBuffer())}o(qo,"fetchArrayBuffer");function Co(e){return e!==void 0&&(h.assets.urlPrefix=e),h.assets.urlPrefix}o(Co,"loadRoot");function Bo(e,t){return h.assets.custom.add(e,us(Pe(t)))}o(Bo,"loadJSON");function hs(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise((s,n)=>{t.onload=()=>s(t),t.onerror=()=>n(new Error(`Failed to load image from "${e}"`))})}o(hs,"loadImg");function at(){let e=[h.assets.sprites,h.assets.sounds,h.assets.shaders,h.assets.fonts,h.assets.bitmapFonts,h.assets.custom];return e.reduce((t,s)=>t+s.progress(),0)/e.length}o(at,"loadProgress");function ln(){return[h.assets.sprites,h.assets.sounds,h.assets.shaders,h.assets.fonts,h.assets.bitmapFonts,h.assets.custom].reduce((e,t)=>e.concat(t.getFailedAssets()),[])}o(ln,"getFailedAssets");function Ro(e){return h.assets.custom.get(e)??null}o(Ro,"getAsset");function un(e){return h.assets.custom.add(null,e)}o(un,"load");var cu=o(e=>({urlPrefix:"",sprites:new Mt,fonts:new Mt,bitmapFonts:new Mt,sounds:new Mt,shaders:new Mt,custom:new Mt,music:{},packer:new hu(e,2048,2048),loaded:!1}),"initAssets"),du="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",gt,lt=(gt=class{constructor(e,t,s={},n=null){E(this,"tex"),E(this,"frames",[new le(0,0,1,1)]),E(this,"anims",{}),E(this,"slice9",null),this.tex=e,t&&(this.frames=t),this.anims=s,this.slice9=n}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,t={}){return typeof e=="string"?gt.fromURL(e,t):Promise.resolve(gt.fromImage(e,t))}static fromImage(e,t={}){let[s,n]=h.assets.packer.add(e),r=t.frames?t.frames.map(i=>new le(n.x+i.x*n.w,n.y+i.y*n.h,i.w*n.w,i.h*n.h)):cn(t.sliceX||1,t.sliceY||1,n.x,n.y,n.w,n.h);return new gt(s,r,t.anims,t.slice9)}static fromURL(e,t={}){return hs(e).then(s=>gt.fromImage(s,t))}},o(gt,"SpriteData"),gt);function Jt(e){if(typeof e=="string"){let t=hn(e);if(t)return t;if(at()<1)return null;throw new Error(`Sprite not found: ${e}`)}else{if(e instanceof lt)return ke.loaded(e);if(e instanceof ke)return e;throw new Error(`Invalid sprite: ${e}`)}}o(Jt,"resolveSprite");function hn(e){return h.assets.sprites.get(e)??null}o(hn,"getSprite");function It(e,t,s={sliceX:1,sliceY:1,anims:{}}){return t=Pe(t),Array.isArray(t)?t.some(n=>typeof n=="string")?h.assets.sprites.add(e,Promise.all(t.map(n=>typeof n=="string"?hs(n):Promise.resolve(n))).then(n=>Dr(n,s))):h.assets.sprites.addLoaded(e,Dr(t,s)):typeof t=="string"?h.assets.sprites.add(e,lt.from(t,s)):h.assets.sprites.addLoaded(e,lt.fromImage(t,s))}o(It,"loadSprite");function cn(e=1,t=1,s=0,n=0,r=1,i=1){let a=[],d=r/e,l=i/t;for(let u=0;u<t;u++)for(let f=0;f<e;f++)a.push(new le(s+f*d,n+u*l,d,l));return a}o(cn,"slice");function Dr(e,t={}){let s=document.createElement("canvas"),n=e[0].width,r=e[0].height;s.width=n*e.length,s.height=r;let i=s.getContext("2d");if(!i)throw new Error("Failed to create canvas context");e.forEach((d,l)=>{d instanceof ImageData?i.putImageData(d,l*n,0):i.drawImage(d,l*n,0)});let a=i.getImageData(0,0,e.length*n,r);return lt.fromImage(a,{...t,sliceX:e.length,sliceY:1})}o(Dr,"createSpriteSheet");function Po(e="bean"){return It(e,du)}o(Po,"loadBean");function Io(e,t,s){t=Pe(t),s=Pe(s),typeof t=="string"&&!s&&(s=jl(t)+".json");let n=typeof s=="string"?us(s):Promise.resolve(s);return h.assets.sprites.add(e,n.then(r=>{let i=r.meta.size,a=r.frames.map(l=>new le(l.frame.x/i.w,l.frame.y/i.h,l.frame.w/i.w,l.frame.h/i.h)),d={};for(let l of r.meta.frameTags)l.from===l.to?d[l.name]=l.from:d[l.name]={from:l.from,to:l.to,speed:10,loop:!0,pingpong:l.direction==="pingpong"};return lt.from(t,{frames:a,anims:d})}))}o(Io,"loadAseprite");var Ar,qs=(Ar=class{constructor(e,t={}){if(E(this,"fontface"),E(this,"filter",Pr),E(this,"outline",null),E(this,"size",64),this.fontface=e,this.filter=t.filter??Pr,this.size=t.size??64,this.size>256)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:$(0,0,0)},typeof t.outline=="number"?this.outline.width=t.outline:typeof t.outline=="object"&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}},o(Ar,"FontData"),Ar);function dn(e){if(!e)return dn(h.globalOpt.font??Cl);if(typeof e=="string"){let t=pn(e),s=fn(e);if(t)return t.data??t;if(s)return s.data??s;if(document.fonts.check(`64px ${e}`))return e;if(at()<1)return null;throw new Error(`Font not found: ${e}`)}else if(e instanceof ke)return e.data?e.data:e;return e}o(dn,"resolveFont");function fn(e){return h.assets.fonts.get(e)??null}o(fn,"getFont");function To(e,t,s={}){let n=Pe(t),r=new FontFace(e,typeof t=="string"?`url(${n})`:n);return document.fonts.add(r),h.assets.fonts.add(e,r.load().catch(i=>{throw new Error(`Failed to load font from "${n}": ${i}`)}).then(i=>new qs(i,s)))}o(To,"loadFont");function Fo(e,t,s,n){let r=e.width/t,i={},a=n.split("").entries();for(let[d,l]of a)i[l]=new le(d%r*t,Math.floor(d/r)*s,t,s);return{tex:e,map:i,size:s}}o(Fo,"makeFont");function pn(e){return h.assets.bitmapFonts.get(e)??null}o(pn,"getBitmapFont");function ko(e,t,s,n,r={}){let i=Pe(t);return h.assets.bitmapFonts.add(e,hs(i).then(a=>Fo(nt.fromImage(h.gfx.ggl,a,r),s,n,r.chars??Qi)))}o(ko,"loadBitmapFont");function Do(e,t){return t=Pe(t),h.assets.sprites.add(e,new Promise(async s=>{let n=typeof t=="string"?await us(t):t,r=await Promise.all(n.frames.map(hs)),i=document.createElement("canvas");i.width=n.width,i.height=n.height*n.frames.length;let a=i.getContext("2d");if(!a)throw new Error("Failed to create canvas context");r.forEach((l,u)=>{a.drawImage(l,0,u*n.height)});let d=await It(null,i,{sliceY:n.frames.length,anims:n.anims});s(d)}))}o(Do,"loadPedit");var vr,fu=(vr=class{constructor(e,t,s,n){E(this,"ctx"),E(this,"glProgram"),this.ctx=e,e.onDestroy(()=>this.free());let r=e.gl,i=r.createShader(r.VERTEX_SHADER),a=r.createShader(r.FRAGMENT_SHADER);if(!i||!a)throw new Error("Failed to create shader");r.shaderSource(i,t),r.shaderSource(a,s),r.compileShader(i),r.compileShader(a);let d=r.createProgram();if(this.glProgram=d,r.attachShader(d,i),r.attachShader(d,a),n.forEach((l,u)=>r.bindAttribLocation(d,u,l)),r.linkProgram(d),!r.getProgramParameter(d,r.LINK_STATUS)){let l=r.getShaderInfoLog(i);if(l)throw new Error("VERTEX SHADER "+l);let u=r.getShaderInfoLog(a);if(u)throw new Error("FRAGMENT SHADER "+u)}r.deleteShader(i),r.deleteShader(a)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let s in e){let n=e[s],r=t.getUniformLocation(this.glProgram,s);if(typeof n=="number")t.uniform1f(r,n);else if(n instanceof He)t.uniformMatrix4fv(r,!1,new Float32Array(n.m));else if(n instanceof Q)t.uniform3f(r,n.r,n.g,n.b);else if(n instanceof C)t.uniform2f(r,n.x,n.y);else if(Array.isArray(n))n[0],Gl(n)?t.uniform1fv(r,n):Nl(n)?t.uniform2fv(r,n.map(i=>[i.x,i.y]).flat()):Ll(n)&&t.uniform3fv(r,n.map(i=>[i.r,i.g,i.b]).flat());else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},o(vr,"Shader"),vr);function Zs(e,t=Ir,s=Tr){let n=Il.replace("{{user}}",t??Ir),r=Tl.replace("{{user}}",s??Tr);try{return new fu(e,n,r,rn.map(i=>i.name))}catch(i){let a=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,d=Hl(i).match(a);if(!(d!=null&&d.groups))throw i;let l=Number(d.groups.line)-14,u=d.groups.msg.trim(),f=d.groups.type.toLowerCase();throw new Error(`${f} shader line ${l}: ${u}`)}}o(Zs,"makeShader");function Oo(e){if(!e)return h.gfx.defShader;if(typeof e=="string"){let t=gn(e);if(t)return t.data??t;if(at()<1)return null;throw new Error(`Shader not found: ${e}`)}else if(e instanceof ke)return e.data?e.data:e;return e}o(Oo,"resolveShader");function gn(e){return h.assets.shaders.get(e)??null}o(gn,"getShader");function Uo(e,t,s){return h.assets.shaders.addLoaded(e,Zs(h.gfx.ggl,t,s))}o(Uo,"loadShader");function Lo(e,t,s){t=Pe(t),s=Pe(s);let n=o(i=>i?So(i):Promise.resolve(null),"resolveUrl"),r=Promise.all([n(t),n(s)]).then(([i,a])=>Zs(h.gfx.ggl,i,a));return h.assets.shaders.add(e,r)}o(Lo,"loadShaderURL");var St,ss=(St=class{constructor(e){E(this,"buf"),this.buf=e}static fromArrayBuffer(e){return new Promise((t,s)=>h.audio.ctx.decodeAudioData(e,t,s)).then(t=>new St(t))}static fromURL(e){return so(e)?St.fromArrayBuffer(eo(e)):qo(e).then(t=>St.fromArrayBuffer(t))}},o(St,"SoundData"),St);function No(e){if(typeof e=="string"){let t=mn(e);if(t)return t;if(at()<1)return null;throw new Error(`Sound not found: ${e}`)}else{if(e instanceof ss)return ke.loaded(e);if(e instanceof ke)return e;throw new Error(`Invalid sound: ${e}`)}}o(No,"resolveSound");function mn(e){return h.assets.sounds.get(e)??null}o(mn,"getSound");function Go(e,t){return t=Pe(t),h.assets.sounds.add(e,typeof t=="string"?ss.fromURL(t):ss.fromArrayBuffer(t))}o(Go,"loadSound");function jo(e,t){let s=Pe(t),n=new Audio(s);return n.preload="auto",h.assets.music[e]=s}o(jo,"loadMusic");function wn(e,t){return e=Pe(e),un(typeof t=="string"?new Promise((s,n)=>{us(t).then(r=>{wn(e,r).then(s).catch(n)})}):lt.from(e).then(s=>{let n={};for(let r in t){let i=t[r],a=s.frames[0],d=2048*a.w,l=2048*a.h,u=i.frames?i.frames.map(x=>new le(a.x+(i.x+x.x)/d*a.w,a.y+(i.y+x.y)/l*a.h,x.w/d*a.w,x.h/l*a.h)):cn(i.sliceX||1,i.sliceY||1,a.x+i.x/d*a.w,a.y+i.y/l*a.h,i.width/d*a.w,i.height/l*a.h),f=new lt(s.tex,u,i.anims);h.assets.sprites.addLoaded(r,f),n[r]=f}return n}))}o(wn,"loadSpriteAtlas");function _e(e,t,s=!1,n,r,i={}){let a=n??h.gfx.defTex,d=r??h.gfx.defShader,l=Oo(d);if(!l||l instanceof ke)return;let u=h.gfx.fixed||s?h.gfx.transform:h.game.cam.transform.mult(h.gfx.transform),f=[];for(let x of e){let c=Ao(u.multVec2(x.pos));f.push(c.x,c.y,x.uv.x,x.uv.y,x.color.r/255,x.color.g/255,x.color.b/255,x.opacity)}h.gfx.renderer.push(h.gfx.ggl.gl.TRIANGLES,f,t,l,a,i)}o(_e,"drawRaw");function We(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(qe(),ae(e.pos),Ft(e.scale),wt(e.angle),ae(e.offset),e.fill!==!1){let s=e.color??Q.WHITE,n=e.pts.map((i,a)=>({pos:new C(i.x,i.y),uv:e.uv?e.uv[a]:new C(0,0),color:e.colors&&e.colors[a]?e.colors[a].mult(s):s,opacity:e.opacity??1})),r;e.triangulate?r=sn(e.pts).map(i=>i.map(a=>e.pts.indexOf(a))).flat():r=[...Array(t-2).keys()].map(i=>[0,i+1,i+2]).flat(),_e(n,e.indices??r,e.fixed,e.uv?e.tex:h.gfx.defTex,e.shader,e.uniform??void 0)}e.outline&&_s({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity??e.outline.opacity}),xe()}}o(We,"drawPolygon");function yn(e){if(e.radiusX===void 0||e.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(e.radiusX===0||e.radiusY===0)return;let t=e.start??0,s=e.end??360,n=vt(e.anchor??"center").scale(new C(-e.radiusX,-e.radiusY)),r=Bt(n,e.radiusX,e.radiusY,t,s,e.resolution);r.unshift(n);let i=Object.assign({},e,{pts:r,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(r.length-1).fill(e.gradient[1])]}:{}});if(s-t>=360&&e.outline){e.fill!==!1&&We(Object.assign({},i,{outline:null})),We(Object.assign({},i,{pts:r.slice(1),fill:!1}));return}We(i)}o(yn,"drawEllipse");function xt(e){if(typeof e.radius!="number")throw new Error('drawCircle() requires property "radius".');e.radius!==0&&yn(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}o(xt,"drawCircle");function Rt(e){let{p1:t,p2:s}=e;if(!t||!s)throw new Error('drawLine() requires properties "p1" and "p2".');let n=e.width||1,r=s.sub(t).unit().normal().scale(n*.5),i=[t.sub(r),t.add(r),s.add(r),s.sub(r)].map(a=>({pos:new C(a.x,a.y),uv:new C(0),color:e.color??Q.WHITE,opacity:e.opacity??1}));_e(i,[0,1,3,1,2,3],e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}o(Rt,"drawLine");function Ho(e){let t=e.pts,s=[],n=(e.width||1)*.5,r=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),i=e.pos||M(0,0),a;r?a=t[0].sub(t[t.length-2]):a=t[1].sub(t[0]);let d=a.len(),l=a.normal().scale(-n/d),u,f=t[0];if(!r)switch(e.cap){case"square":{let g=a.scale(-n/d);s.push(f.add(g).add(l)),s.push(f.add(g).sub(l));break}case"round":{let g=Math.max(n,10),S=Math.PI/g,p=l.scale(-1),w=Math.cos(S),P=Math.sin(S);for(let I=0;I<g;I++)s.push(f),s.push(f.sub(p)),p=M(p.x*w-p.y*P,p.x*P+p.y*w)}}for(let g=1;g<t.length;g++){if(f===t[g]||f.eq(t[g]))continue;u=f,f=t[g];let S=f.sub(u),p=S.len(),w=S.normal().scale(-n/p),P=a.cross(S);if(Math.abs(P)/(d*p)<.05){s.push(u.add(l)),s.push(u.sub(l)),a.dot(S)<0&&(s.push(u.sub(l)),s.push(u.add(l))),a=S,d=p,l=w;continue}let I=w.sub(l).cross(S)/P,U=l.add(a.scale(I));P>0?(s.push(u.add(U)),s.push(u.sub(l)),s.push(u.add(U)),s.push(u.sub(w))):(s.push(u.add(l)),s.push(u.sub(U)),s.push(u.add(w)),s.push(u.sub(U))),a=S,d=p,l=w}if(!r)switch(s.push(f.add(l)),s.push(f.sub(l)),e.cap){case"square":{let g=a.scale(n/d);s.push(f.add(g).add(l)),s.push(f.add(g).sub(l));break}case"round":{let g=Math.max(n,10),S=Math.PI/g,p=l.scale(1),w=Math.cos(S),P=Math.sin(S);for(let I=0;I<g;I++)p=M(p.x*w-p.y*P,p.x*P+p.y*w),s.push(f),s.push(f.sub(p))}}if(s.length<4)return;let x=s.map(g=>({pos:i.add(g),uv:M(),color:e.color||Q.WHITE,opacity:e.opacity??1})),c=[],y=0;for(let g=0;g<s.length-2;g+=2)c[y++]=g+1,c[y++]=g,c[y++]=g+2,c[y++]=g+2,c[y++]=g+3,c[y++]=g+1;r&&(c[y++]=s.length-1,c[y++]=s.length-2,c[y++]=0,c[y++]=0,c[y++]=1,c[y++]=s.length-1),_e(x,c,e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}o(Ho,"_drawLinesBevel");function Vo(e){let t=e.pts,s=[],n=(e.width||1)*.5,r=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),i=e.pos||M(0,0),a;r?a=t[0].sub(t[t.length-2]):a=t[1].sub(t[0]);let d=a.len(),l=a.normal().scale(-n/d),u,f=t[0];if(!r)switch(e.cap){case"square":{let g=a.scale(-n/d);s.push(f.add(g).add(l)),s.push(f.add(g).sub(l));break}case"round":{let g=Math.max(n,10),S=Math.PI/g,p=l.scale(-1),w=Math.cos(S),P=Math.sin(S);for(let I=0;I<g;I++)s.push(f),s.push(f.sub(p)),p=M(p.x*w-p.y*P,p.x*P+p.y*w)}}for(let g=1;g<t.length;g++){if(f===t[g]||f.eq(t[g]))continue;u=f,f=t[g];let S=f.sub(u),p=S.len(),w=S.normal().scale(-n/p),P=a.cross(S);if(Math.abs(P)/(d*p)<.05){s.push(u.add(l)),s.push(u.sub(l)),a.dot(S)<0&&(s.push(u.sub(l)),s.push(u.add(l))),a=S,d=p,l=w;continue}let I=w.sub(l).cross(S)/P,U=l.add(a.scale(I));if(P>0){let D=u.add(U),v=Math.max(n,10),b=de(l.angleBetween(w)/v),q=l,k=Math.cos(b),T=Math.sin(b);for(let O=0;O<v;O++)s.push(D),s.push(u.sub(q)),q=M(q.x*k-q.y*T,q.x*T+q.y*k)}else{let D=u.sub(U),v=Math.max(n,10),b=de(l.angleBetween(w)/v),q=l,k=Math.cos(b),T=Math.sin(b);for(let O=0;O<v;O++)s.push(u.add(q)),s.push(D),q=M(q.x*k-q.y*T,q.x*T+q.y*k)}a=S,d=p,l=w}if(!r)switch(s.push(f.add(l)),s.push(f.sub(l)),e.cap){case"square":{let g=a.scale(n/d);s.push(f.add(g).add(l)),s.push(f.add(g).sub(l));break}case"round":{let g=Math.max(n,10),S=Math.PI/g,p=l.scale(1),w=Math.cos(S),P=Math.sin(S);for(let I=0;I<g;I++)p=M(p.x*w-p.y*P,p.x*P+p.y*w),s.push(f),s.push(f.sub(p))}}if(s.length<4)return;let x=s.map(g=>({pos:i.add(g),uv:M(),color:e.color||Q.WHITE,opacity:e.opacity??1})),c=[],y=0;for(let g=0;g<s.length-2;g+=2)c[y++]=g+1,c[y++]=g,c[y++]=g+2,c[y++]=g+2,c[y++]=g+3,c[y++]=g+1;r&&(c[y++]=s.length-1,c[y++]=s.length-2,c[y++]=0,c[y++]=0,c[y++]=1,c[y++]=s.length-1),_e(x,c,e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}o(Vo,"_drawLinesRound");function Ko(e){let t=e.pts,s=[],n=(e.width||1)*.5,r=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),i=e.pos||M(0,0),a;r?a=t[0].sub(t[t.length-2]):a=t[1].sub(t[0]);let d=a.len(),l=a.normal().scale(-n/d),u,f=t[0];if(!r)switch(e.cap){case"square":{let g=a.scale(-n/d);s.push(f.add(g).add(l)),s.push(f.add(g).sub(l));break}case"round":{let g=Math.max(n,10),S=Math.PI/g,p=l.scale(-1),w=Math.cos(S),P=Math.sin(S);for(let I=0;I<g;I++)s.push(f),s.push(f.sub(p)),p=M(p.x*w-p.y*P,p.x*P+p.y*w)}}for(let g=1;g<t.length;g++){if(f===t[g]||f.eq(t[g]))continue;u=f,f=t[g];let S=f.sub(u),p=S.len(),w=S.normal().scale(-n/p),P=a.cross(S);if(Math.abs(P)/(d*p)<.05){s.push(u.add(l)),s.push(u.sub(l)),a.dot(S)<0&&(s.push(u.sub(l)),s.push(u.add(l))),a=S,d=p,l=w;continue}let I=w.sub(l).cross(S)/P,U=l.add(a.scale(I));s.push(u.add(U)),s.push(u.sub(U)),a=S,d=p,l=w}if(!r)switch(s.push(f.add(l)),s.push(f.sub(l)),e.cap){case"square":{let g=a.scale(n/d);s.push(f.add(g).add(l)),s.push(f.add(g).sub(l));break}case"round":{let g=Math.max(n,10),S=Math.PI/g,p=l.scale(1),w=Math.cos(S),P=Math.sin(S);for(let I=0;I<g;I++)p=M(p.x*w-p.y*P,p.x*P+p.y*w),s.push(f),s.push(f.sub(p))}}if(s.length<4)return;let x=s.map(g=>({pos:i.add(g),uv:M(),color:e.color||Q.WHITE,opacity:e.opacity??1})),c=[],y=0;for(let g=0;g<s.length-2;g+=2)c[y++]=g+1,c[y++]=g,c[y++]=g+2,c[y++]=g+2,c[y++]=g+3,c[y++]=g+1;r&&(c[y++]=s.length-1,c[y++]=s.length-2,c[y++]=0,c[y++]=0,c[y++]=1,c[y++]=s.length-1),_e(x,c,e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}o(Ko,"_drawLinesMiter");function _s(e){let t=e.pts,s=e.width??1;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2)){if(t.length>2)switch(e.join){case"bevel":return Ho(e);case"round":return Vo(e);case"miter":return Ko(e)}if(e.radius&&t.length>=3){Rt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let n=1;n<t.length-2;n++){let r=t[n],i=t[n+1];Rt(Object.assign({},e,{p1:r,p2:i}))}Rt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let n=0;n<t.length-1;n++)Rt(Object.assign({},e,{p1:t[n],p2:t[n+1]})),e.join!=="none"&&xt(Object.assign({},e,{pos:t[n],radius:s/2}))}}o(_s,"drawLines");function An(e,t){let s=t.segments??16,n=[];for(let r=0;r<=s;r++)n.push(e(r/s));_s({pts:n,width:t.width||1,pos:t.pos,color:t.color,opacity:t.opacity})}o(An,"drawCurve");function Yo(e){An(t=>Ys(e.pt1,e.pt2,e.pt3,e.pt4,t),e)}o(Yo,"drawBezier");var bs,nt=(bs=class{constructor(e,t,s,n={}){E(this,"ctx"),E(this,"src",null),E(this,"glTex"),E(this,"width"),E(this,"height"),this.ctx=e;let r=e.gl,i=e.gl.createTexture();if(!i)throw new Error("Failed to create texture");this.glTex=i,e.onDestroy(()=>this.free()),this.width=t,this.height=s;let a={linear:r.LINEAR,nearest:r.NEAREST}[n.filter??e.opts.texFilter??"nearest"],d={repeat:r.REPEAT,clampToEdge:r.CLAMP_TO_EDGE}[n.wrap??"clampToEdge"];this.bind(),t&&s&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,s,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,d),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,d),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(e,t,s={}){let n=new bs(e,t.width,t.height,s);return n.update(t),n.src=t,n}update(e,t=0,s=0){let n=this.ctx.gl;this.bind(),n.texSubImage2D(n.TEXTURE_2D,0,t,s,n.RGBA,n.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},o(bs,"Texture"),bs),xr,Ts=(xr=class{constructor(e,t,s,n={}){E(this,"ctx"),E(this,"tex"),E(this,"glFramebuffer"),E(this,"glRenderbuffer"),this.ctx=e;let r=e.gl;e.onDestroy(()=>this.free()),this.tex=new nt(e,t,s,n);let i=r.createFramebuffer(),a=r.createRenderbuffer();if(!i||!a)throw new Error("Failed to create framebuffer");this.glFramebuffer=i,this.glRenderbuffer=a,this.bind(),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.tex.glTex,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let s=this.width*4,n=new Uint8Array(s);for(let r=0;r<(this.height/2|0);r++){let i=r*s,a=(this.height-r-1)*s;n.set(t.subarray(i,i+s)),t.copyWithin(i,a,a+s),t.set(n,a)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=this.width,e.height=this.height,!t)throw new Error("Failed to get 2d context");return t.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},o(xr,"FrameBuffer"),xr),br,pu=(br=class{constructor(e,t,s,n){E(this,"ctx"),E(this,"glVBuf"),E(this,"glIBuf"),E(this,"vqueue",[]),E(this,"iqueue",[]),E(this,"stride"),E(this,"maxVertices"),E(this,"maxIndices"),E(this,"vertexFormat"),E(this,"numDraws",0),E(this,"curPrimitive",null),E(this,"curTex",null),E(this,"curShader",null),E(this,"curUniform",{});let r=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce((a,d)=>a+d.size,0),this.maxVertices=s,this.maxIndices=n;let i=r.createBuffer();if(!i)throw new Error("Failed to create vertex buffer");this.glVBuf=i,e.pushArrayBuffer(this.glVBuf),r.bufferData(r.ARRAY_BUFFER,s*4,r.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=r.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),r.bufferData(r.ELEMENT_ARRAY_BUFFER,n*4,r.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,s,n,r=null,i={}){(e!==this.curPrimitive||r!==this.curTex||n!==this.curShader||!Qs(this.curUniform,i)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+s.length>this.maxIndices)&&this.flush();let a=this.vqueue.length/this.stride;for(let d of t)this.vqueue.push(d);for(let d of s)this.iqueue.push(d+a);this.curPrimitive=e,this.curShader=n,this.curTex=r,this.curUniform=i}flush(){var e,t;if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let s=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),s.bufferSubData(s.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),(e=this.curTex)==null||e.bind(),s.drawElements(this.curPrimitive,this.iqueue.length,s.UNSIGNED_SHORT,0),(t=this.curTex)==null||t.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},o(br,"BatchRenderer"),br);function rt(e){let t=[],s=o(i=>{t.push(i),e(i)},"push"),n=o(()=>{t.pop(),e(r()??null)},"pop"),r=o(()=>t[t.length-1],"cur");return[s,n,r]}o(rt,"genStack");function zo(e,t={}){let s=[];function n(D){s.push(D)}o(n,"onDestroy");function r(){s.forEach(v=>v());let D=e.getExtension("WEBGL_lose_context");D&&D.loseContext()}o(r,"destroy");let i=null;function a(D){if(Qs(D,i))return;i=D;let v=D.reduce((b,q)=>b+q.size,0);D.reduce((b,q,k)=>(e.vertexAttribPointer(k,q.size,e.FLOAT,!1,v*4,b),e.enableVertexAttribArray(k),b+q.size*4),0)}o(a,"setVertexFormat");let[d,l]=rt(D=>e.bindTexture(e.TEXTURE_2D,D)),[u,f]=rt(D=>e.bindBuffer(e.ARRAY_BUFFER,D)),[x,c]=rt(D=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,D)),[y,g]=rt(D=>e.bindFramebuffer(e.FRAMEBUFFER,D)),[S,p]=rt(D=>e.bindRenderbuffer(e.RENDERBUFFER,D)),[w,P]=rt(D=>{if(!D)return;let{x:v,y:b,w:q,h:k}=D;e.viewport(v,b,q,k)}),[I,U]=rt(D=>e.useProgram(D));return w({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:n,destroy:r,pushTexture2D:d,popTexture2D:l,pushArrayBuffer:u,popArrayBuffer:f,pushElementArrayBuffer:x,popElementArrayBuffer:c,pushFramebuffer:y,popFramebuffer:g,pushRenderbuffer:S,popRenderbuffer:p,pushViewport:w,popViewport:P,pushProgram:I,popProgram:U,setVertexFormat:a}}o(zo,"initGfx");var Er={};function Or(e,t){if(t.override){Object.assign(e,t);return}t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(M(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&e.ch.length===1&&(e.color=e.color.mult(t.color)),t.opacity!=null&&(e.opacity*=t.opacity)}o(Or,"applyCharTransform");function Fs(e){let t={},s="",n=[],r=String(e),i=o(a=>{n.length>0&&(t[s.length]=n.slice()),s+=a},"emit");for(;r!=="";){if(r[0]==="\\"){if(r.length===1)throw new Error("Styled text error: \\ at end of string");i(r[1]),r=r.slice(2);continue}if(r[0]==="["){let a=/^\[(\/)?(\w+?)\]/.exec(r);if(!a){i(r[0]),r=r.slice(1);continue}let[d,l,u]=a;if(l!==void 0){let f=n.pop();if(f!==u)throw f!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${f}], got [/${u}]`):new Error(`Styled text error: stray end tag [/${u}]`)}else n.push(u);r=r.slice(d.length);continue}i(r[0]),r=r.slice(1)}if(n.length>0)throw new Error(`Styled text error: unclosed tags ${n}`);return{charStyleMap:t,text:s}}o(Fs,"compileStyledText");function ut(e){var t,s,n;if(e.text===void 0)throw new Error('formatText() requires property "text".');let r=dn(e.font);if(!e.text||e.text===""||r instanceof ke||!r)return{width:0,height:0,chars:[],opt:e,renderedText:""};let{charStyleMap:i,text:a}=Fs(e.text+""),d=no(a);if(r instanceof qs||typeof r=="string"){let v=r instanceof qs?r.fontface.family:r,b=r instanceof qs?{outline:r.outline,filter:r.filter}:{outline:null,filter:Pr},q=Er[v]??{font:{tex:new nt(h.gfx.ggl,2048,2048,{filter:b.filter}),map:{},size:64},cursor:new C(0),outline:b.outline};Er[v]||(Er[v]=q),r=q.font;for(let k of d)if(!q.font.map[k]){let T=h.fontCacheC2d;if(!T)throw new Error("fontCacheC2d is not defined.");if(!h.fontCacheCanvas)throw new Error("fontCacheCanvas is not defined.");T.clearRect(0,0,h.fontCacheCanvas.width,h.fontCacheCanvas.height),T.font=`${r.size}px ${v}`,T.textBaseline="top",T.textAlign="left",T.fillStyle="#ffffff";let O=T.measureText(k),L=Math.ceil(O.width);if(!L)continue;let j=Math.ceil(Math.abs(O.actualBoundingBoxAscent))+Math.ceil(Math.abs(O.actualBoundingBoxDescent));q.outline&&q.outline.width&&q.outline.color&&(T.lineJoin="round",T.lineWidth=q.outline.width*2,T.strokeStyle=q.outline.color.toHex(),T.strokeText(k,q.outline.width,q.outline.width),L+=q.outline.width*2,j+=q.outline.width*3),T.fillText(k,((t=q.outline)==null?void 0:t.width)??0,((s=q.outline)==null?void 0:s.width)??0);let H=T.getImageData(0,0,L,j);if(q.cursor.x+L>2048&&(q.cursor.x=0,q.cursor.y+=j,q.cursor.y>2048))throw new Error("Font atlas exceeds character limit");r.tex.update(H,q.cursor.x,q.cursor.y),r.map[k]=new le(q.cursor.x,q.cursor.y,L,j),q.cursor.x+=L+1}}let l=e.size||r.size,u=M(e.scale??1).scale(l/r.size),f=e.lineSpacing??0,x=e.letterSpacing??0,c=0,y=0,g=0,S=[],p=[],w=0,P=null,I=0,U;for(;w<d.length;){let v=d[w];if(v===`
`)g+=l+f,S.push({width:c-x,chars:p}),P=null,I=0,c=0,p=[],U=void 0;else{let b=r.map[v];if(b){let q=b.w*u.x;e.width&&c+q>e.width&&(g+=l+f,P!=null&&(w-=p.length-P,v=d[w],b=r.map[v],q=b.w*u.x,p=p.slice(0,P-1),c=I),P=null,I=0,S.push({width:c-x,chars:p}),c=U??0,p=[]),p.push({tex:r.tex,width:b.w,height:b.h,quad:new le(b.x/r.tex.width,b.y/r.tex.height,b.w/r.tex.width,b.h/r.tex.height),ch:v,pos:new C(c,g),opacity:e.opacity??1,color:e.color??Q.WHITE,scale:M(u),angle:0}),v===" "&&(P=p.length,I=c),e.indentAll&&U===void 0&&/\S/.test(v)&&(U=c),c+=q,y=Math.max(y,c),c+=x}}w++}S.push({width:c-x,chars:p}),g+=l,e.width&&(y=e.width);let D=[];for(let v=0;v<S.length;v++){let b=(y-S[v].width)*go(e.align??"left");for(let q of S[v].chars){let k=r.map[q.ch],T=D.length+v;if(q.pos=q.pos.add(b,0).add(k.w*u.x*.5,k.h*u.y*.5),e.transform){let O=typeof e.transform=="function"?e.transform(T,q.ch):e.transform;O&&Or(q,O)}if(i[T]){let O=i[T];for(let L of O){let j=(n=e.styles)==null?void 0:n[L],H=typeof j=="function"?j(T,q.ch):j;H&&Or(q,H)}}D.push(q)}}return{width:y,height:g,chars:D,opt:e,renderedText:a}}o(ut,"formatText");function kt(e){if(e.width===void 0||e.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,s=e.height,n=vt(e.anchor||zs).scale(new C(t,s).scale(-.5)),r=e.quad||new le(0,0,1,1),i=e.color||$(255,255,255),a=e.opacity??1,d=e.tex?.1/e.tex.width:0,l=e.tex?.1/e.tex.height:0,u=r.x+d,f=r.y+l,x=r.w-d*2,c=r.h-l*2;qe(),ae(e.pos),wt(e.angle),Ft(e.scale),ae(n),_e([{pos:new C(-t/2,s/2),uv:new C(e.flipX?u+x:u,e.flipY?f:f+c),color:i,opacity:a},{pos:new C(-t/2,-s/2),uv:new C(e.flipX?u+x:u,e.flipY?f+c:f),color:i,opacity:a},{pos:new C(t/2,-s/2),uv:new C(e.flipX?u:u+x,e.flipY?f+c:f),color:i,opacity:a},{pos:new C(t/2,s/2),uv:new C(e.flipX?u:u+x,e.flipY?f:f+c),color:i,opacity:a}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform??void 0),xe()}o(kt,"drawUVQuad");function ht(e){qe(),ae(e.opt.pos),wt(e.opt.angle),ae(vt(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(t=>{kt({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),xe()}o(ht,"drawFormattedText");function Be(e){if(e.width===void 0||e.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,s=e.height,n=vt(e.anchor||zs).add(1,1).scale(new C(t,s).scale(-.5)),r=[new C(0,0),new C(t,0),new C(t,s),new C(0,s)];if(e.radius){let i=Math.min(t,s)/2,a=Array.isArray(e.radius)?e.radius.map(d=>Math.min(i,d)):new Array(4).fill(Math.min(i,e.radius));r=[new C(a[0],0),...a[1]?Bt(new C(t-a[1],a[1]),a[1],a[1],270,360):[M(t,0)],...a[2]?Bt(new C(t-a[2],s-a[2]),a[2],a[2],0,90):[M(t,s)],...a[3]?Bt(new C(a[3],s-a[3]),a[3],a[3],90,180):[M(0,s)],...a[0]?Bt(new C(a[0],a[0]),a[0],a[0],180,270):[]]}We(Object.assign({},e,{offset:n,pts:r,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}o(Be,"drawRect");function Qe(e){Ce();let t=h.gfx.width,s=h.gfx.height;h.gfx.width=h.gfx.viewport.width,h.gfx.height=h.gfx.viewport.height,e(),Ce(),h.gfx.width=t,h.gfx.height=s}o(Qe,"drawUnscaled");function Ur(e,t){Qe(()=>{let s=M(8);qe(),ae(e);let n=ut({text:t,font:Bs,size:16,pos:s,color:$(255,255,255),fixed:!0}),r=n.width+s.x*2,i=n.height+s.x*2;e.x+r>=me()&&ae(M(-r,0)),e.y+i>=ye()&&ae(M(0,-i)),Be({width:r,height:i,color:$(0,0,0),radius:4,opacity:.8,fixed:!0}),ht(n),xe()})}o(Ur,"drawInspectText");function vn(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return We(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}o(vn,"drawTriangle");function Xo(){if(h.debug.inspect){let e=null;for(let t of h.game.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(h.game.root.drawInspect(),e){let t=[],s=e.inspect();for(let n in s)s[n]?t.push(`${s[n]}`):t.push(`${n}`);Ur(Eo(an()),t.join(`
`))}Ur(M(8),`FPS: ${h.debug.fps()}`)}h.debug.paused&&Qe(()=>{qe(),ae(me(),0),ae(-8,8);let e=32;Be({width:e,height:e,anchor:"topright",color:$(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)Be({width:4,height:e*.6,anchor:"center",pos:M(-e/3*t,e*.5),color:$(255,255,255),radius:2,fixed:!0});xe()}),h.debug.timeScale!==1&&Qe(()=>{qe(),ae(me(),ye()),ae(-8,-8);let e=8,t=ut({text:h.debug.timeScale.toFixed(1),font:Bs,size:16,color:$(255,255,255),pos:M(-e),anchor:"botright",fixed:!0});Be({width:t.width+e*2+e*4,height:t.height+e*2,anchor:"botright",color:$(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=0;s<2;s++){let n=h.debug.timeScale<1;vn({p1:M(-t.width-e*(n?2:3.5),-e),p2:M(-t.width-e*(n?2:3.5),-e-t.height),p3:M(-t.width-e*(n?3.5:2),-e-t.height/2),pos:M(-s*e*1+(n?-e*.5:0),0),color:$(255,255,255),fixed:!0})}ht(t),xe()}),h.debug.curRecording&&Qe(()=>{qe(),ae(0,ye()),ae(24,-24),xt({radius:12,color:$(255,0,0),opacity:Hr(0,1,h.app.time()*4),fixed:!0}),xe()}),h.debug.showLog&&h.game.logs.length>0&&Qe(()=>{qe(),ae(0,ye()),ae(8,-8);let e=8,t=[];for(let n of h.game.logs){let r="",i=n.msg instanceof Error?"error":"info";r+=`[time]${n.time.toFixed(2)}[/time]`,r+=" ",r+=`[${i}]${ks(n.msg)}[/${i}]`,t.push(r)}h.game.logs=h.game.logs.filter(n=>h.app.time()-n.time<(h.globalOpt.logTime||4));let s=ut({text:t.join(`
`),font:Bs,pos:M(e,-e),anchor:"botleft",size:16,width:me()*.6,lineSpacing:e/2,fixed:!0,styles:{time:{color:$(127,127,127)},info:{color:$(255,255,255)},error:{color:$(255,0,127)}}});Be({width:s.width+e*2,height:s.height+e*2,anchor:"botleft",color:$(0,0,0),radius:4,opacity:.8,fixed:!0}),ht(s),xe()})}o(Xo,"drawDebug");function ks(e,t=!1,s=new Set){if(s.has(e))return"<recursive>";var n="",r;return t&&typeof e=="string"&&(e=JSON.stringify(e)),Array.isArray(e)&&(n=["[",e.map(i=>ks(i,!0,s.union(new Set([e])))).join(", "),"]"].join(""),e=n),e===null?"null":(typeof e=="object"&&e.toString===Object.prototype.toString&&(e.constructor!==Object&&(n+=e.constructor.name+" "),n+=["{",(r=Object.getOwnPropertyNames(e).map(i=>`${/^\w+$/.test(i)?i:JSON.stringify(i)}: ${ks(e[i],!0,s.union(new Set([e])))}`).join(", "))?` ${r} `:"","}"].join(""),e=n),String(e).replaceAll(new RegExp("(?<!\\\\)\\[","g"),"\\["))}o(ks,"prettyDebug");function Qo(){let e=h.game.cam,t=C.fromAngle(pe(0,360)).scale(e.shake);e.shake=be(e.shake,0,5*ge()),e.transform=new He().translate(ts()).scale(e.scale).rotate(e.angle).translate((e.pos??ts()).scale(-1).add(t)),h.game.root.draw(),Ce()}o(Qo,"drawFrame");function Wo(){let e=at();h.game.events.numListeners("loading")>0?h.game.events.trigger("loading",e):Qe(()=>{let t=me()/2,s=24,n=M(me()/2,ye()/2).sub(M(t/2,s/2));Be({pos:M(0),width:me(),height:ye(),color:$(0,0,0)}),Be({pos:n,width:t,height:s,fill:!1,outline:{width:4}}),Be({pos:n,width:t*e,height:s})})}o(Wo,"drawLoadScreen");function xn(e,t,s){let n=h.gfx.ggl.gl;Ce(),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST),n.stencilFunc(n.NEVER,1,255),n.stencilOp(n.REPLACE,n.REPLACE,n.REPLACE),t(),Ce(),n.stencilFunc(s,1,255),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),e(),Ce(),n.disable(n.STENCIL_TEST)}o(xn,"drawStenciled");function Jo(e,t){let s=h.gfx.ggl.gl;xn(e,t,s.EQUAL)}o(Jo,"drawMasked");function rs(e){var t,s;if(!e.tex)throw new Error('drawTexture() requires property "tex".');let n=e.quad??new le(0,0,1,1),r=e.tex.width*n.w,i=e.tex.height*n.h,a=new C(1);if(e.tiled){let d=vt(e.anchor||zs);(((t=e.pos)==null?void 0:t.x)||0)-(d.x+1)*.5*(e.width||r),(((s=e.pos)==null?void 0:s.y)||0)-(d.y+1)*.5*(e.height||i);let l=(e.width||r)/r,u=(e.height||i)/i,f=Math.floor(l),x=Math.floor(u),c=l-f,y=u-x,g=(f+c?1:0)*(x+y?1:0),S=new Array(g*6),p=new Array(g*4),w=0,P=o((I,U,D,v,b)=>{S[w*6+0]=w*4+0,S[w*6+1]=w*4+1,S[w*6+2]=w*4+3,S[w*6+3]=w*4+1,S[w*6+4]=w*4+2,S[w*6+5]=w*4+3,p[w*4+0]={pos:new C(I-d.x,U-d.y),uv:new C(b.x,b.y),color:e.color||Q.WHITE,opacity:e.opacity||1},p[w*4+1]={pos:new C(I+D-d.x,U-d.y),uv:new C(b.x+b.w,b.y),color:e.color||Q.WHITE,opacity:e.opacity||1},p[w*4+2]={pos:new C(I+D-d.x,U+v-d.y),uv:new C(b.x+b.w,b.y+b.h),color:e.color||Q.WHITE,opacity:e.opacity||1},p[w*4+3]={pos:new C(I-d.x,U+v-d.y),uv:new C(b.x,b.y+b.h),color:e.color||Q.WHITE,opacity:e.opacity||1},w++},"addQuad");for(let I=0;I<x;I++){for(let U=0;U<f;U++)P(U*r,I*i,r,i,n);c&&P(f*r,I*i,r*c,i,new le(n.x,n.y,n.w*c,n.h))}if(y){for(let I=0;I<f;I++)P(I*r,x*i,r,i*y,new le(n.x,n.y,n.w,n.h*y));c&&P(f*r,x*i,r*c,i*y,new le(n.x,n.y,n.w*c,n.h*y))}_e(p,S,e.fixed,e.tex,e.shader,e.uniform??void 0)}else e.width&&e.height?(a.x=e.width/r,a.y=e.height/i):e.width?(a.x=e.width/r,a.y=a.x):e.height&&(a.y=e.height/i,a.x=a.y),kt(Object.assign({},e,{scale:a.scale(e.scale||new C(1)),tex:e.tex,quad:n,width:r,height:i}))}o(rs,"drawTexture");function Zo(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=Jt(e.sprite);if(!t||!t.data)return;let s=t.data.frames[e.frame??0];if(!s)throw new Error(`Frame not found: ${e.frame??0}`);rs(Object.assign({},e,{tex:t.data.tex,quad:s.scale(e.quad??new le(0,0,1,1))}))}o(Zo,"drawSprite");function _o(e,t){let s=h.gfx.ggl.gl;xn(e,t,s.NOTEQUAL)}o(_o,"drawSubtracted");function Lr(e){ht(ut(e))}o(Lr,"drawText");var gu=o((e,t)=>{let s=Zs(t,Ir,Tr),n=e.pixelDensity??1,r=e.scale??1,{gl:i}=t,a=nt.fromImage(t,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),d=e.width&&e.height?new Ts(t,e.width*n*r,e.height*n*r):new Ts(t,i.drawingBufferWidth,i.drawingBufferHeight),l=null,u=1;e.background&&(typeof e.background=="string"?l=$(e.background):(l=$(...e.background),u=e.background[3]??1),i.clearColor(l.r/255,l.g/255,l.b/255,u??1)),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);let f=new pu(t,rn,Rl,Pl),x=nt.fromImage(t,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:t,defShader:s,defTex:a,frameBuffer:d,postShader:null,postShaderUniform:null,renderer:f,transform:new He,transformStack:[],bgTex:x,bgColor:l,bgAlpha:u,width:e.width??i.drawingBufferWidth/n/r,height:e.height??i.drawingBufferHeight/n/r,viewport:{x:0,y:0,width:i.drawingBufferWidth,height:i.drawingBufferHeight},fixed:!1}},"initAppGfx");function bn(){let e=h.pixelDensity,t=h.gfx.ggl.gl.drawingBufferWidth/e,s=h.gfx.ggl.gl.drawingBufferHeight/e;if(h.globalOpt.letterbox){if(!h.globalOpt.width||!h.globalOpt.height)throw new Error("Letterboxing requires width and height defined.");let n=t/s,r=h.globalOpt.width/h.globalOpt.height;if(n>r){let i=s*r,a=(t-i)/2;h.gfx.viewport={x:a,y:0,width:i,height:s}}else{let i=t/r,a=(s-i)/2;h.gfx.viewport={x:0,y:a,width:t,height:i}}return}if(h.globalOpt.stretch&&(!h.globalOpt.width||!h.globalOpt.height))throw new Error("Stretching requires width and height defined.");h.gfx.viewport={x:0,y:0,width:t,height:s}}o(bn,"updateViewport");function it(e){return e.fixed?!0:e.parent?it(e.parent):!1}o(it,"isFixed");function ct(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}o(ct,"getRenderProps");function $o(e,t={}){return{id:"circle",radius:e,draw(){xt(Object.assign(ct(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new oe(new C(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}o($o,"circle");function En(...e){return{id:"color",color:$(...e),inspect(){return`color: ${this.color.toString()}`}}}o(En,"color");function ea(e){return{add(){this.canvas=e}}}o(ea,"drawon");function ta(e=1){let t,s=0,n=!1;return{require:["opacity"],add(){t=this.opacity,this.opacity=0},update(){n||(s+=ge(),this.opacity=Ue(s,0,e,0,t),s>=e&&(this.opacity=t,n=!0))}}}o(ta,"fadeIn");function sa(e="intersect"){return{id:"mask",mask:e}}o(sa,"mask");function Mn(e){return{id:"opacity",opacity:e??1,fadeIn(t=1,s=h.k.easings.linear){return h.game.root.tween(0,this.opacity,t,n=>this.opacity=n,s)},fadeOut(t=1,s=h.k.easings.linear){return h.game.root.tween(this.opacity,0,t,n=>this.opacity=n,s)},inspect(){return`opacity: ${Rs(this.opacity,1)}`}}}o(Mn,"opacity");function ra(e=1,t=$(0,0,0),s=1,n="miter",r=10,i="butt"){return{id:"outline",outline:{width:e,color:t,opacity:s,join:n,miterLimit:r,cap:i},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}o(ra,"outline");var Mr,mu=(Mr=class{constructor(){E(this,"pos",M(0)),E(this,"vel",M(0)),E(this,"acc",M(0)),E(this,"angle",0),E(this,"angularVelocity",0),E(this,"damping",0),E(this,"t"),E(this,"lt",null),E(this,"gc"),this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}},o(Mr,"Particle"),Mr);function na(e,t){let s=t.lifetime,n=[],r=e.colors||[Q.WHITE],i=e.opacities||[1],a=e.quads||[new le(0,0,1,1)],d=e.scales||[1],l=e.lifeTime,u=t.direction,f=t.spread,x=e.speed||[0,0],c=e.angle||[0,0],y=e.angularVelocity||[0,0],g=e.acceleration||[M(0),M(0)],S=e.damping||[0,0],p=[],w=new Array(e.max),P=0,I=0;for(let v=0;v<e.max;v++){p[v*6+0]=v*4+0,p[v*6+1]=v*4+1,p[v*6+2]=v*4+3,p[v*6+3]=v*4+1,p[v*6+4]=v*4+2,p[v*6+5]=v*4+3;for(let b=0;b<4;b++)w[v*4+b]={pos:new C(0,0),uv:new C(0,0),color:$(255,255,255),opacity:1};n[v]=new mu}let U=new ve;function D(v=0){for(;v<e.max;){if(n[v].gc)return v;v++}return null}return o(D,"nextFree"),{id:"particles",emit(v){let b=0;for(let q=0;q<v;q++){if(b=D(b),b==null)return;let k=pe(u-f,u+f),T=C.fromAngle(k).scale(pe(x[0],x[1])),O=pe(c[0],c[1]),L=pe(y[0],y[1]),j=M(pe(g[0].x,g[1].x),pe(g[0].y,g[1].y)),H=pe(S[0],S[1]),W=l?pe(l[0],l[1]):null,G=t.shape?t.shape.random():M(),z=n[b];z.lt=W,z.pos=G,z.vel=T,z.acc=j,z.angle=O,z.angularVelocity=L,z.damping=H,z.angularVelocity=L,z.gc=!1}P+=v},update(){if(s!==void 0&&s<=0)return;let v=ge();for(let b of n)if(!b.gc){if(b.t+=v,b.lt&&b.t>=b.lt){b.gc=!0,P--;continue}b.vel=b.vel.add(b.acc.scale(v)).scale(1-b.damping*v),b.pos=b.pos.add(b.vel.scale(v)),b.angle+=b.angularVelocity*v}for(s!==void 0&&(s-=v,s<=0&&U.trigger()),I+=v;P<e.max&&t.rate&&I>t.rate;)this.emit(1),P++,I-=t.rate},draw(){if(!(s!==void 0&&s<=0)){for(let v=0;v<n.length;v++){let b=n[v];if(b.gc)continue;let q=b.progress,k=Math.floor(b.progress*r.length),T=k<r.length-1?be(r[k],r[k+1],Ue(q,k/r.length,(k+1)/r.length,0,1)):r[k],O=Math.floor(b.progress*i.length),L=O<i.length-1?be(i[O],i[O+1],Ue(q,O/i.length,(O+1)/i.length,0,1)):i[O],j=Math.floor(b.progress*a.length),H=a[j],W=Math.floor(b.progress*d.length),G=d[W],z=Math.cos(b.angle*Math.PI/180),te=Math.sin(b.angle*Math.PI/180),Z=(e.texture?e.texture.width:10)*H.w/2,J=(e.texture?e.texture.height:10)*H.h/2,ue=v*4,V=w[ue];V.pos.x=b.pos.x+-Z*G*z- -J*G*te,V.pos.y=b.pos.y+-Z*G*te+-J*G*z,V.uv.x=H.x,V.uv.y=H.y,V.color.r=T.r,V.color.g=T.g,V.color.b=T.b,V.opacity=L,V=w[ue+1],V.pos.x=b.pos.x+Z*G*z- -J*G*te,V.pos.y=b.pos.y+Z*G*te+-J*G*z,V.uv.x=H.x+H.w,V.uv.y=H.y,V.color.r=T.r,V.color.g=T.g,V.color.b=T.b,V.opacity=L,V=w[ue+2],V.pos.x=b.pos.x+Z*G*z-J*G*te,V.pos.y=b.pos.y+Z*G*te+J*G*z,V.uv.x=H.x+H.w,V.uv.y=H.y+H.h,V.color.r=T.r,V.color.g=T.g,V.color.b=T.b,V.opacity=L,V=w[ue+3],V.pos.x=b.pos.x+-Z*G*z-J*G*te,V.pos.y=b.pos.y+-Z*G*te+J*G*z,V.uv.x=H.x,V.uv.y=H.y+H.h,V.color.r=T.r,V.color.g=T.g,V.color.b=T.b,V.opacity=L}_e(w,p,this.fixed,e.texture,this.shader,this.uniform)}},onEnd(v){return U.add(v)},inspect(){return`count: ${P}/${e.max}`}}}o(na,"particles");function ia(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,uv:t.uv,tex:t.tex,radius:t.radius,draw(){We(Object.assign(ct(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:t.fill,triangulate:t.triangulate}))},renderArea(){return new Ee(this.pts)},inspect(){return`polygon: ${this.pts.map(s=>`[${s.x},${s.y}]`).join(",")}`}}}o(ia,"polygon");function Sn(e,t,s){let n;return h.game.root.get("area").forEach(r=>{if(s&&s.some(a=>r.is(a)))return;let i=r.worldArea().raycast(e,t);i&&(n?i.fraction<n.fraction&&(n=i,n.object=r):(n=i,n.object=r))}),n}o(Sn,"raycast");function qn(e,t,s={}){return{id:"rect",width:e,height:t,radius:s.radius||0,draw(){Be(Object.assign(ct(this),{width:this.width,height:this.height,radius:this.radius,fill:s.fill}))},renderArea(){return new oe(M(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}o(qn,"rect");function oa(e,t){return{id:"shader",shader:e,...typeof t=="function"?{uniform:t(),update(){this.uniform=t()}}:{uniform:t},inspect(){return`shader: ${e}`}}}o(oa,"shader");function aa(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let s=h.game.root.add([ns(t.pos??M(0))]),n=e.length,r=0,i=null,a=null,d=null,l=null,u=o(v=>v.x+v.y*r,"tile2Hash"),f=o(v=>M(Math.floor(v%r),Math.floor(v/r)),"hash2Tile"),x=o(()=>{i=[];for(let v of s.children)c(v)},"createSpatialMap"),c=o(v=>{let b=u(v.tilePos);i[b]?i[b].push(v):i[b]=[v]},"insertIntoSpatialMap"),y=o(v=>{let b=u(v.tilePos);if(i[b]){let q=i[b].indexOf(v);q>=0&&i[b].splice(q,1)}},"removeFromSpatialMap"),g=o(()=>{let v=!1;for(let b of s.children){let q=s.pos2Tile(b.pos);(b.tilePos.x!=q.x||b.tilePos.y!=q.y)&&(v=!0,y(b),b.tilePos.x=q.x,b.tilePos.y=q.y,c(b))}v&&s.trigger("spatialMapChanged")},"updateSpatialMap"),S=o(()=>{let v=s.getSpatialMap(),b=s.numRows()*s.numColumns();a?a.length=b:a=new Array(b),a.fill(1,0,b);for(let q=0;q<v.length;q++){let k=v[q];if(k){let T=0;for(let O of k)if(O.isObstacle){T=1/0;break}else T+=O.cost;a[q]=T||1}}},"createCostMap"),p=o(()=>{let v=s.getSpatialMap(),b=s.numRows()*s.numColumns();d?d.length=b:d=new Array(b),d.fill(15,0,b);for(let q=0;q<v.length;q++){let k=v[q];if(k){let T=k.length,O=15;for(let L=0;L<T;L++)O|=k[L].edgeMask;d[q]=O}}},"createEdgeMap"),w=o(()=>{let v=s.numRows()*s.numColumns(),b=o((k,T)=>{let O=[];for(O.push(k);O.length>0;){let L=O.pop();U(L).forEach(j=>{l[j]<0&&(l[j]=T,O.push(j))})}},"traverse");l?l.length=v:l=new Array(v),l.fill(-1,0,v);let q=0;for(let k=0;k<a.length;k++){if(l[k]>=0){q++;continue}b(k,q),q++}},"createConnectivityMap"),P=o((v,b)=>a[b],"getCost"),I=o((v,b)=>{let q=f(v),k=f(b);return q.dist(k)},"getHeuristic"),U=o((v,b)=>{let q=[],k=Math.floor(v%r),T=k>0&&d[v]&1&&a[v-1]!==1/0,O=v>=r&&d[v]&2&&a[v-r]!==1/0,L=k<r-1&&d[v]&4&&a[v+1]!==1/0,j=v<r*n-r-1&&d[v]&8&&a[v+r]!==1/0;return b?(T&&(O&&q.push(v-r-1),q.push(v-1),j&&q.push(v+r-1)),O&&q.push(v-r),L&&(O&&q.push(v-r+1),q.push(v+1),j&&q.push(v+r+1)),j&&q.push(v+r)):(T&&q.push(v-1),O&&q.push(v-r),L&&q.push(v+1),j&&q.push(v+r)),q},"getNeighbours"),D={id:"level",tileWidth(){return t.tileWidth},tileHeight(){return t.tileHeight},spawn(v,...b){let q=M(...b),k=(()=>{if(typeof v=="string"){if(t.tiles[v]){if(typeof t.tiles[v]!="function")throw new Error("Level symbol def must be a function returning a component list");return t.tiles[v](q)}else if(t.wildcardTile)return t.wildcardTile(v,q)}else{if(Array.isArray(v))return v;throw new Error("Expected a symbol or a component list")}})();if(!k)return null;let T=!1,O=!1;for(let j of k)j.id==="tile"&&(O=!0),j.id==="pos"&&(T=!0);T||k.push(ns(this.tile2Pos(q))),O||k.push(jn());let L=s.add(k);return T&&(L.tilePosOffset=L.pos.clone()),L.tilePos=q,L.transform=Pt(L),i&&(c(L),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),L},numColumns(){return r},numRows(){return n},levelWidth(){return r*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...v){return M(...v).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...v){let b=M(...v);return M(Math.floor(b.x/this.tileWidth()),Math.floor(b.y/this.tileHeight()))},getSpatialMap(){return i||x(),i},removeFromSpatialMap:y,insertIntoSpatialMap:c,onSpatialMapChanged(v){return this.on("spatialMapChanged",v)},onNavigationMapInvalid(v){return this.on("navigationMapInvalid",v)},getAt(v){i||x();let b=u(v);return i[b]||[]},raycast(v,b){let q=this.toWorld(v),k=this.toWorld(v.add(b)).sub(q),T=1/this.tileWidth(),O=v.scale(T),L=Mi(O,b,j=>{let H=this.getAt(j);if(H.some(G=>G.isObstacle))return!0;let W=null;for(let G of H)if(G.has("area")){let z=G.worldArea().raycast(q,k);z&&(W?z.fraction<W.fraction&&(W=z,W.object=G):(W=z,W.object=G))}return W&&(W.point=this.fromWorld(W.point).scale(T)),W||!1},64);return L&&(L.point=L.point.scale(this.tileWidth())),L},update(){i&&g()},invalidateNavigationMap(){a=null,d=null,l=null},onNavigationMapChanged(v){return this.on("navigationMapChanged",v)},getTilePath(v,b,q={}){var k;if(a||S(),d||p(),l||w(),v.x<0||v.x>=r||v.y<0||v.y>=n||b.x<0||b.x>=r||b.y<0||b.y>=n)return null;let T=u(v),O=u(b);if(a[O]===1/0)return null;if(T===O)return[];if(l[T]!=-1&&l[T]!==l[O])return null;let L=new _i((te,Z)=>te.cost<Z.cost);L.insert({cost:0,node:T});let j=new Map;j.set(T,T);let H=new Map;for(H.set(T,0);L.length!==0;){let te=(k=L.remove())==null?void 0:k.node;if(te===O)break;let Z=U(te,q.allowDiagonals);for(let J of Z){let ue=(H.get(te)||0)+P(te,J)+I(J,O);(!H.has(J)||ue<H.get(J))&&(H.set(J,ue),L.insert({cost:ue,node:J}),j.set(J,te))}}let W=[],G=O,z=f(G);for(W.push(z);G!==T;){let te=j.get(G);if(te===void 0)throw new Error("Bug in pathfinding algorithm");G=te;let Z=f(G);W.push(Z)}return W.reverse()},getPath(v,b,q={}){let k=this.tileWidth(),T=this.tileHeight(),O=this.getTilePath(this.pos2Tile(v),this.pos2Tile(b),q);return O?[v,...O.slice(1,-1).map(L=>L.scale(k,T).add(k/2,T/2)),b]:null}};return s.use(D),s.onNavigationMapInvalid(()=>{s.invalidateNavigationMap(),s.trigger("navigationMapChanged")}),e.forEach((v,b)=>{let q=v.split("");r=Math.max(q.length,r),q.forEach((k,T)=>{s.spawn(k,M(T,b))})}),s}o(aa,"addLevel");function Me(e,t,s){return h.game.objEvents.registers[e]||(h.game.objEvents.registers[e]=new Zi),h.game.objEvents.on(e,(n,...r)=>{n.is(t)&&s(n,...r)})}o(Me,"on");var wu=o((e,t,...s)=>{for(let n of h.game.root.children)n.is(t)&&n.trigger(e)},"trigger"),yu=ie(e=>{let t=h.game.root.add([{fixedUpdate:e}]);return{get paused(){return t.paused},set paused(s){t.paused=s},cancel:o(()=>t.destroy(),"cancel")}},(e,t)=>Me("fixedUpdate",e,t)),Au=ie(e=>{let t=h.game.root.add([{update:e}]);return{get paused(){return t.paused},set paused(s){t.paused=s},cancel:o(()=>t.destroy(),"cancel")}},(e,t)=>Me("update",e,t)),vu=ie(e=>{let t=h.game.root.add([{draw:e}]);return{get paused(){return t.hidden},set paused(s){t.hidden=s},cancel:o(()=>t.destroy(),"cancel")}},(e,t)=>Me("draw",e,t)),la=ie(e=>h.game.events.on("add",e),(e,t)=>Me("add",e,t)),xu=ie(e=>h.game.events.on("destroy",e),(e,t)=>Me("destroy",e,t)),bu=ie(e=>h.game.events.on("use",e),(e,t)=>Me("use",e,t)),Eu=ie(e=>h.game.events.on("unuse",e),(e,t)=>Me("unuse",e,t)),ua=ie(e=>h.game.events.on("tag",e),(e,t)=>Me("tag",e,t)),Mu=ie(e=>h.game.events.on("untag",e),(e,t)=>Me("untag",e,t));function ha(e,t,s){return Me("collide",e,(n,r,i)=>r.is(t)&&s(n,r,i))}o(ha,"onCollide");function ca(e,t,s){return Me("collideUpdate",e,(n,r,i)=>r.is(t)&&s(n,r,i))}o(ca,"onCollideUpdate");function da(e,t,s){return Me("collideEnd",e,(n,r,i)=>r.is(t)&&s(n,r,i))}o(da,"onCollideEnd");function cs(e,t){h.game.root.get(e,{recursive:!0}).forEach(t),la(e,t),ua((s,n)=>{n===e&&t(s)})}o(cs,"forAllCurrentAndFuture");var Su=ie(e=>h.app.onMousePress(e),(e,t)=>{let s=[];return cs(e,n=>{if(!n.area)throw new Error("onClick() requires the object to have area() component");s.push(n.onClick(()=>t(n)))}),yt.join(s)});function fa(e,t){let s=[];return cs(e,n=>{if(!n.area)throw new Error("onHover() requires the object to have area() component");s.push(n.onHover(()=>t(n)))}),yt.join(s)}o(fa,"onHover");function pa(e,t){let s=[];return cs(e,n=>{if(!n.area)throw new Error("onHoverUpdate() requires the object to have area() component");s.push(n.onHoverUpdate(()=>t(n)))}),yt.join(s)}o(pa,"onHoverUpdate");function ga(e,t){let s=[];return cs(e,n=>{if(!n.area)throw new Error("onHoverEnd() requires the object to have area() component");s.push(n.onHoverEnd(()=>t(n)))}),yt.join(s)}o(ga,"onHoverEnd");function ma(e){h.game.events.on("loading",e)}o(ma,"onLoading");function wa(e){h.app.onResize(e)}o(wa,"onResize");function ya(e){h.game.events.on("error",e)}o(ya,"onError");function $s(e){h.assets.loaded?e():h.game.events.on("load",e)}o($s,"onLoad");function Aa(e){if(h.assets.loaded)ln().forEach(t=>e(...t));else return h.game.events.on("loadError",e)}o(Aa,"onLoadError");function Cn(...e){h.game.cam.pos=M(...e)}o(Cn,"setCamPos");function Bn(){return h.game.cam.pos?h.game.cam.pos.clone():ts()}o(Bn,"getCamPos");function Rn(...e){h.game.cam.scale=M(...e)}o(Rn,"setCamScale");function Pn(){return h.game.cam.scale.clone()}o(Pn,"getCamScale");function In(e){h.game.cam.angle=e}o(In,"setCamRot");function Tn(){return h.game.cam.angle}o(Tn,"getCamRot");function va(){return h.game.cam.transform.clone()}o(va,"getCamTransform");function Fn(e=$(255,255,255),t=1){let s=h.game.root.add([qn(me(),ye()),En(e),Mn(1),Yn()]),n=s.fadeOut(t);return n.onEnd(()=>Gn(s)),n}o(Fn,"flash");function xa(){return h.game.cam.transform.clone()}o(xa,"camTransform");function ba(e=12){h.game.cam.shake+=e}o(ba,"shake");function Ds(e){return h.game.cam.transform.multVec2(e)}o(Ds,"toScreen");function kn(e){return h.game.cam.transform.invert().multVec2(e)}o(kn,"toWorld");function Ea(...e){return At("camPos","setCamPos / getCamPos"),e.length>0&&Cn(...e),Bn()}o(Ea,"camPos");function Ma(...e){return At("camScale","setCamScale / getCamScale"),e.length>0&&Rn(...e),Pn()}o(Ma,"camScale");function Sa(e){return At("camRot","setCamRot / getCamRot"),e!==void 0&&In(e),Tn()}o(Sa,"camRot");function qa(e=$(255,255,255),t=1){return At("camFlash","flash"),Fn(e,t)}o(qa,"camFlash");function er(e=[]){let t=new Map,s=[],n={},r=new $t,i=[],a=new Set("*"),d=h.globalOpt.tagsAsComponents,l=null,u=!1,f={id:Kl(),hidden:!1,transform:new He,children:[],parent:null,set paused(c){if(c!==u){u=c;for(let y of i)y.paused=c}},get paused(){return u},get tags(){return Array.from(a)},add(c){let y=Array.isArray(c)?er(c):c;if(y.parent)throw new Error("Cannot add a game obj that already has a parent.");return y.parent=this,y.transform=Pt(y),this.children.push(y),y.trigger("add",y),h.game.events.trigger("add",y),y},readd(c){let y=this.children.indexOf(c);return y!==-1&&(this.children.splice(y,1),this.children.push(c)),c},remove(c){let y=this.children.indexOf(c);if(y!==-1){c.parent=null,this.children.splice(y,1);let g=o(S=>{S.trigger("destroy"),h.game.events.trigger("destroy",S),S.children.forEach(p=>g(p))},"trigger");g(c)}},removeAll(c){if(c)this.get(c).forEach(y=>this.remove(y));else for(let y of[...this.children])this.remove(y)},fixedUpdate(){this.paused||(this.children.forEach(c=>c.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(c=>c.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(Ce(),this.canvas.bind());let c=h.gfx.fixed;this.fixed&&(h.gfx.fixed=!0),qe(),ae(this.pos),Ft(this.scale),wt(this.angle);let y=this.children.sort((g,S)=>{let p=g.layerIndex??h.game.defaultLayerIndex,w=S.layerIndex??h.game.defaultLayerIndex;return p-w||(g.z??0)-(S.z??0)});if(this.mask){let g={intersect:h.k.drawMasked,subtract:h.k.drawSubtracted}[this.mask];if(!g)throw new Error(`Invalid mask func: "${this.mask}"`);g(()=>{y.forEach(S=>S.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),y.forEach(g=>g.draw());xe(),h.gfx.fixed=c,this.canvas&&(Ce(),this.canvas.unbind())},drawInspect(){this.hidden||(qe(),ae(this.pos),Ft(this.scale),wt(this.angle),this.children.forEach(c=>c.drawInspect()),this.trigger("drawInspect"),xe())},use(c){var y;if(typeof c=="string")return a.add(c);let g=[];c.id?(this.unuse(c.id),n[c.id]=[],g=n[c.id],t.set(c.id,c)):s.push(c),d&&a.add(c.id);for(let p in c){if(Fl.has(p))continue;let w=Object.getOwnPropertyDescriptor(c,p);if(w)if(typeof w.value=="function"&&(c[p]=c[p].bind(this)),w.set&&Object.defineProperty(c,p,{set:w.set.bind(this)}),w.get&&Object.defineProperty(c,p,{get:w.get.bind(this)}),kl.has(p)){let P=p==="add"?()=>{var I;l=o(U=>g.push(U),"onCurCompCleanup"),(I=c[p])==null||I.call(c),l=null}:c[p];g.push(this.on(p,P).cancel)}else if(this[p]===void 0)Object.defineProperty(this,p,{get:o(()=>c[p],"get"),set:o(P=>c[p]=P,"set"),configurable:!0,enumerable:!0}),g.push(()=>delete this[p]);else{let P=(y=t.values().find(I=>I[p]!==void 0))==null?void 0:y.id;throw new Error(`Duplicate component property: "${p}" while adding component "${c.id}"`+(P?` (originally added by "${P}")`:""))}}let S=o(()=>{if(c.require){for(let p of c.require)if(!this.c(p))throw new Error(`Component "${c.id}" requires component "${p}"`)}},"checkDeps");c.destroy&&g.push(c.destroy.bind(this)),this.exists()?(S(),c.add&&(l=o(p=>g.push(p),"onCurCompCleanup"),c.add.call(this),l=null),c.id&&(this.trigger("use",c.id),h.game.events.trigger("use",this,c.id))):c.require&&g.push(this.on("add",S).cancel)},unuse(c){if(t.has(c)){for(let y of t.values())if(y.require&&y.require.includes(c))throw new Error(`Can't unuse. Component "${y.id}" requires component "${c}"`);t.delete(c),this.trigger("unuse",c),h.game.events.trigger("unuse",this,c)}else d&&a.has(c)&&a.delete(c);n[c]&&(n[c].forEach(y=>y()),delete n[c])},c(c){return t.get(c)??null},get(c,y={}){let g=o((p,w)=>y.only==="comps"?p.has(w):y.only==="tags"?p.is(w):p.is(w)||p.has(w),"checkTagsOrComps"),S=y.recursive?this.children.flatMap(o(function p(w){return[w,...w.children.flatMap(p)]},"recurse")):this.children;if(S=S.filter(p=>c?g(p,c):!0),y.liveUpdate){let p=o(P=>y.recursive?this.isAncestorOf(P):P.parent===this,"isChild"),w=[];w.push(h.k.onAdd(P=>{p(P)&&g(P,c)&&S.push(P)})),w.push(h.k.onDestroy(P=>{if(p(P)&&g(P,c)){let I=S.findIndex(U=>U.id===P.id);I!==-1&&S.splice(I,1)}})),this.onDestroy(()=>{for(let P of w)P.cancel()})}return S},query(c){let y=c.hierarchy||"children",g=c.include,S=c.exclude,p=[];switch(y){case"children":p=this.children;break;case"siblings":p=this.parent?this.parent.children.filter(P=>P!==this):[];break;case"ancestors":let w=this.parent;for(;w;)p.push(w),w=w.parent;break;case"descendants":p=this.children.flatMap(o(function P(I){return[I,...I.children.flatMap(P)]},"recurse"));break}if(g&&((c.includeOp||"and")==="and"||!Array.isArray(c.include)?p=p.filter(w=>w.is(g)):p=p.filter(w=>c.include.some(P=>w.is(P)))),S&&((c.includeOp||"and")==="and"||!Array.isArray(c.include)?p=p.filter(w=>!w.is(S)):p=p.filter(w=>!c.exclude.some(P=>w.is(P)))),c.visible===!0&&(p=p.filter(w=>w.visible)),c.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let w=c.distanceOp||"near",P=c.distance*c.distance;w==="near"?p=p.filter(I=>I.pos&&this.pos.sdist(I.pos)<=P):p=p.filter(I=>I.pos&&this.pos.sdist(I.pos)>P)}return c.name&&(p=p.filter(w=>w.name===c.name)),p},isAncestorOf(c){return c.parent?c.parent===this||this.isAncestorOf(c.parent):!1},exists(){return h.game.root.isAncestorOf(this)},is(c,y="and"){return Array.isArray(c)?y==="and"?c.every(g=>a.has(g)):c.some(g=>a.has(g)):a.has(c)},tag(c){if(Array.isArray(c))for(let y of c)a.add(y),this.trigger("tag",y),h.game.events.trigger("tag",this,y);else a.add(c),this.trigger("tag",c),h.game.events.trigger("tag",this,c)},untag(c){if(Array.isArray(c))for(let y of c)a.delete(y),this.trigger("untag",y),h.game.events.trigger("untag",this,y);else a.delete(c),this.trigger("untag",c),h.game.events.trigger("untag",this,c)},has(c,y="and"){return Array.isArray(c)?y==="and"?c.every(g=>t.has(g)):c.some(g=>t.has(g)):t.has(c)},on(c,y){let g=r.on(c,y.bind(this));return l&&l(()=>g.cancel()),g},trigger(c,...y){r.trigger(c,...y),h.game.objEvents.trigger(c,this,...y)},destroy(){this.parent&&this.parent.remove(this)},inspect(){var c;let y={};for(let[g,S]of t)y[g]=((c=S.inspect)==null?void 0:c.call(S))??null;for(let[g,S]of s.entries()){if(S.inspect){y[g]=S.inspect();continue}for(let[p,w]of Object.entries(S))typeof w!="function"&&(y[p]=`${p}: ${w}`)}return y},onAdd(c){return this.on("add",c)},onFixedUpdate(c){return this.on("fixedUpdate",c)},onUpdate(c){return this.on("update",c)},onDraw(c){return this.on("draw",c)},onDestroy(c){return this.on("destroy",c)},onUse(c){return this.on("use",c)},onUnuse(c){return this.on("unuse",c)},clearEvents(){r.clear()}},x=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let c of x)f[c]=(...y)=>{var g,S;let p=(S=(g=h.app)[c])==null?void 0:S.call(g,...y);return i.push(p),f.onDestroy(()=>p.cancel()),f.on("sceneEnter",()=>{var w,P;i.splice(i.indexOf(p),1);let I=(P=(w=h.app)[c])==null?void 0:P.call(w,...y);yt.replace(p,I),i.push(p)}),p};for(let c of e)f.use(c);return f}o(er,"make");var qu=o(()=>({events:new $t,objEvents:new $t,root:er([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new C(1),angle:0,shake:0,transform:new He}}),"initGame");function Ca(e){h.game.gravity=e?(h.game.gravity||M(0,1)).unit().scale(e):null}o(Ca,"setGravity");function Ba(){return h.game.gravity?h.game.gravity.len():0}o(Ba,"getGravity");function Ra(e){h.game.gravity=e.unit().scale(h.game.gravity?h.game.gravity.len():1)}o(Ra,"setGravityDirection");function Tt(){return h.game.gravity?h.game.gravity.unit():M(0,1)}o(Tt,"getGravityDirection");var Cu=bl("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"),Bu=o(()=>(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let s=new ss(mo(e));return e.decodeAudioData(Cu.buffer.slice(0)).then(n=>{s.buf=n}).catch(n=>{console.error("Failed to load burp: ",n)}),{ctx:e,masterNode:t,burpSnd:s}})(),"initAudio");function Pa(e,t={}){let s=new ve,n=new Audio(e);n.crossOrigin="anonymous",n.loop=!!t.loop,h.audio.ctx.createMediaElementSource(n).connect(h.audio.masterNode);function r(){h.debug.paused||h.app.isHidden()&&!h.globalOpt.backgroundAudio||h.audio.ctx.resume()}o(r,"resumeAudioCtx");function i(){r(),n.play()}return o(i,"play"),t.paused||i(),n.onended=()=>s.trigger(),{play(){i()},seek(a){n.currentTime=a},stop(){n.pause(),this.seek(0)},set loop(a){n.loop=a},get loop(){return n.loop},set paused(a){a?n.pause():i()},get paused(){return n.paused},time(){return n.currentTime},duration(){return n.duration},set volume(a){n.volume=Le(a,0,1)},get volume(){return n.volume},set speed(a){n.playbackRate=Math.max(a,0)},get speed(){return n.playbackRate},set detune(a){},get detune(){return 0},onEnd(a){return s.add(a)},then(a){return this.onEnd(a)}}}o(Pa,"playMusic");function Ia(e,t={}){if(typeof e=="string"&&h.assets.music[e])return Pa(h.assets.music[e],t);let s=h.audio.ctx,n=t.paused??!1,r=s.createBufferSource(),i=new ve,a=s.createGain(),d=s.createStereoPanner(),l=t.seek??0,u=0,f=0,x=!1;r.loop=!!t.loop,r.detune.value=t.detune??0,r.playbackRate.value=t.speed??1,r.connect(d),r.onended=()=>{var p;g()>=(((p=r.buffer)==null?void 0:p.duration)??Number.POSITIVE_INFINITY)&&i.trigger()},d.pan.value=t.pan??0,d.connect(a),a.connect(h.audio.masterNode),a.gain.value=t.volume??1;let c=o(p=>{r.buffer=p.buf,n||(u=s.currentTime,r.start(0,l),x=!0)},"start"),y=No(e);y instanceof ke&&y.onLoad(c);let g=o(()=>{if(!r.buffer)return 0;let p=n?f-u:s.currentTime-u,w=r.buffer.duration;return r.loop?p%w:Math.min(p,w)},"getTime"),S=o(p=>{let w=s.createBufferSource();return w.buffer=p.buffer,w.loop=p.loop,w.playbackRate.value=p.playbackRate.value,w.detune.value=p.detune.value,w.onended=p.onended,w.connect(d),w},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(p){if(n!==p)if(n=p,p)x&&(r.stop(),x=!1),f=s.currentTime;else{r=S(r);let w=f-u;r.start(0,w),x=!0,u=s.currentTime-w,f=0}},get paused(){return n},play(p=0){this.seek(p),this.paused=!1},seek(p){var w;(w=r.buffer)!=null&&w.duration&&(p>r.buffer.duration||(n?(r=S(r),u=f-p):(r.stop(),r=S(r),u=s.currentTime-p,r.start(0,p),x=!0,f=0)))},set speed(p){r.playbackRate.value=p},get speed(){return r.playbackRate.value},set detune(p){r.detune.value=p},get detune(){return r.detune.value},set volume(p){a.gain.value=Math.max(p,0)},get volume(){return a.gain.value},set pan(p){d.pan.value=p},get pan(){return d.pan.value},set loop(p){r.loop=p},get loop(){return r.loop},duration(){var p;return((p=r.buffer)==null?void 0:p.duration)??0},time(){return g()%this.duration()},onEnd(p){return i.add(p)},then(p){return this.onEnd(p)}}}o(Ia,"play");function Dn(e){return h.k.play(h.audio.burpSnd,e)}o(Dn,"burp");function On(e){h.audio.masterNode.gain.value=e}o(On,"setVolume");function Un(){return h.audio.masterNode.gain.value}o(Un,"getVolume");function Ta(e){return At("volume","setVolume / getVolume"),e!==void 0&&On(e),Un()}o(Ta,"volume");function Ln(){h.app.onHide(()=>{h.globalOpt.backgroundAudio||h.audio.ctx.suspend()}),h.app.onShow(()=>{!h.globalOpt.backgroundAudio&&!h.debug.paused&&h.audio.ctx.resume()}),h.app.onResize(()=>{if(h.app.isFullscreen())return;let e=h.globalOpt.width&&h.globalOpt.height;e&&!h.globalOpt.stretch&&!h.globalOpt.letterbox||(h.canvas.width=h.canvas.offsetWidth*h.pixelDensity,h.canvas.height=h.canvas.offsetHeight*h.pixelDensity,bn(),e||(h.gfx.frameBuffer.free(),h.gfx.frameBuffer=new Ts(h.gfx.ggl,h.gfx.ggl.gl.drawingBufferWidth,h.gfx.ggl.gl.drawingBufferHeight),h.gfx.width=h.gfx.ggl.gl.drawingBufferWidth/h.pixelDensity/h.gscale,h.gfx.height=h.gfx.ggl.gl.drawingBufferHeight/h.pixelDensity/h.gscale))}),h.globalOpt.debug!==!1&&(h.app.onKeyPress(h.globalOpt.debugKey??"f1",()=>h.debug.inspect=!h.debug.inspect),h.app.onKeyPress("f2",()=>h.debug.clearLog()),h.app.onKeyPress("f8",()=>h.debug.paused=!h.debug.paused),h.app.onKeyPress("f7",()=>{h.debug.timeScale=Rs(Le(h.debug.timeScale-.2,0,2),1)}),h.app.onKeyPress("f9",()=>{h.debug.timeScale=Rs(Le(h.debug.timeScale+.2,0,2),1)}),h.app.onKeyPress("f10",()=>h.debug.stepFrame())),h.globalOpt.burp&&h.app.onKeyPress("b",()=>Dn())}o(Ln,"initEvents");function Fa(e,t={}){let s=h.game.root.add([ns(e),Kn()]),n=(t.speed||1)*5,r=t.scale||1;s.add([Os(h.boomSprite),is(0),Ls("center"),Gr(n,r),...t.comps??[]]);let i=s.add([Os(h.kaSprite),is(0),Ls("center"),Us(),...t.comps??[]]);return i.wait(.4/n,()=>i.use(Gr(n,r))),i.onDestroy(()=>s.destroy()),s}o(Fa,"addKaboom");function Nn(e,t){if(h.game.layers)throw Error("Layers can only be assigned once.");let s=e.indexOf(t);if(s==-1)throw Error("The default layer name should be present in the layers list.");h.game.layers=e,h.game.defaultLayerIndex=s}o(Nn,"setLayers");function ka(){return h.game.layers}o(ka,"getLayers");function Da(){var e;return((e=h.game.layers)==null?void 0:e[h.game.defaultLayerIndex])??null}o(Da,"getDefaultLayer");function Oa(e,t){At("layers","setLayers"),Nn(e,t)}o(Oa,"layers");function Gn(e){e.destroy()}o(Gn,"destroy");function Ua(){return h.game.root}o(Ua,"getTreeRoot");function La(e,t){h.game.scenes[e]=t}o(La,"scene");function Na(e,...t){if(!h.game.scenes[e])throw new Error(`Scene not found: ${e}`);h.game.events.onOnce("frameEnd",()=>{h.game.events.trigger("sceneLeave",e),h.app.events.clear(),h.game.events.clear(),h.game.objEvents.clear(),[...h.game.root.children].forEach(s=>{!s.stay||s.scenesToStay&&!s.scenesToStay.includes(e)?h.game.root.remove(s):s.trigger("sceneEnter",e)}),h.game.root.clearEvents(),Ln(),h.game.cam={pos:null,scale:M(1),angle:0,shake:0,transform:new He},h.game.scenes[e](...t)}),h.game.currentScene=e}o(Na,"go");function Ga(e){return h.game.events.on("sceneLeave",e)}o(Ga,"onSceneLeave");function ja(){return h.game.currentScene}o(ja,"getSceneName");function Os(e,t={}){let s=null,n=null,r=null,i=new ve;if(!e)throw new Error("Please pass the resource name or data to sprite()");let a=o((l,u,f,x)=>{let c=M(1,1);return f&&x?(c.x=f/(l.width*u.w),c.y=x/(l.height*u.h)):f?(c.x=f/(l.width*u.w),c.y=c.x):x&&(c.y=x/(l.height*u.h),c.x=c.y),c},"calcTexScale"),d=o((l,u)=>{if(!u)return;let f=u.frames[0].clone();t.quad&&(f=f.scale(t.quad));let x=a(u.tex,f,t.width,t.height);l.width=u.tex.width*f.w*x.x,l.height=u.tex.height*f.h*x.y,t.anim&&l.play(t.anim),s=u,i.trigger(s)},"setSpriteData");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new le(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,get sprite(){return e.toString()},set sprite(l){let u=Jt(l);u&&u.onLoad(f=>d(this,f))},get animFrame(){if(!s||!n||r===null)return this.frame;let l=s.anims[n.name];return typeof l=="number"?l:this.frame-Math.min(l.from,l.to)},draw(){if(!s)return;let l=s.frames[this.frame??0];if(!l)throw new Error(`Frame not found: ${this.frame??0}`);if(s.slice9){let{left:u,right:f,top:x,bottom:c}=s.slice9,y=s.tex.width*l.w,g=s.tex.height*l.h,S=this.width-u-f,p=this.height-x-c,w=u/y,P=f/y,I=1-w-P,U=x/g,D=c/g,v=1-U-D,b=[ce(0,0,w,U),ce(w,0,I,U),ce(w+I,0,P,U),ce(0,U,w,v),ce(w,U,I,v),ce(w+I,U,P,v),ce(0,U+v,w,D),ce(w,U+v,I,D),ce(w+I,U+v,P,D),ce(0,0,u,x),ce(u,0,S,x),ce(u+S,0,f,x),ce(0,x,u,p),ce(u,x,S,p),ce(u+S,x,f,p),ce(0,x+p,u,c),ce(u,x+p,S,c),ce(u+S,x+p,f,c)];for(let q=0;q<9;q++){let k=b[q],T=b[q+9];rs(Object.assign(ct(this),{pos:T.pos(),tex:s.tex,quad:l.scale(k),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:T.w,height:T.h}))}}else rs(Object.assign(ct(this),{tex:s.tex,quad:l.scale(this.quad??new le(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let l=Jt(e);l?l.onLoad(u=>d(this,u)):$s(()=>d(this,Jt(e).data))},update(){if(!s||!n||r===null)return;let l=s.anims[n.name];if(typeof l=="number"){this.frame=l;return}if(l.speed===0)throw new Error("Sprite anim speed cannot be 0");n.timer+=ge()*this.animSpeed,n.timer>=1/n.speed&&(n.timer=0,this.frame+=r,(this.frame<Math.min(l.from,l.to)||this.frame>Math.max(l.from,l.to))&&(n.loop?n.pingpong?(this.frame-=r,r*=-1,this.frame+=r):this.frame=l.from:n.pingpong?r===Math.sign(l.to-l.from)?(this.frame=l.to,r*=-1,this.frame+=r):(this.frame=l.from,n.onEnd(),this.stop()):(this.frame=l.to,n.onEnd(),this.stop())))},play(l,u={}){if(!s){i.add(()=>this.play(l,u));return}let f=s.anims[l];if(f===void 0)throw new Error(`Anim not found: ${l}`);n&&this.stop(),n=typeof f=="number"?{name:l,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:o(()=>{},"onEnd")}:{name:l,timer:0,loop:u.loop??f.loop??!1,pingpong:u.pingpong??f.pingpong??!1,speed:u.speed??f.speed??10,onEnd:u.onEnd??(()=>{})},r=typeof f=="number"?null:f.from<f.to?1:-1,this.frame=typeof f=="number"?f:f.from,this.trigger("animStart",l)},stop(){if(!n)return;let l=n.name;n=null,this.trigger("animEnd",l)},numFrames(){return(s==null?void 0:s.frames.length)??0},getCurAnim(){return n},curAnim(){return n==null?void 0:n.name},getAnim(l){return(s==null?void 0:s.anims[l])??null},hasAnim(l){return!!this.getAnim(l)},onAnimEnd(l){return this.on("animEnd",l)},onAnimStart(l){return this.on("animStart",l)},renderArea(){return new oe(M(0),this.width,this.height)},inspect(){return typeof e=="string"?`sprite: "${e}"`:null}}}o(Os,"sprite");function Ha(e,t={}){function s(r){var i,a;let d=ut(Object.assign(ct(r),{text:r.text+"",size:r.textSize,font:r.font,width:t.width&&r.width,align:r.align,letterSpacing:r.letterSpacing,lineSpacing:r.lineSpacing,transform:r.textTransform,styles:r.textStyles,indentAll:t.indentAll}));return t.width||(r.width=d.width/(((i=r.scale)==null?void 0:i.x)||1)),r.height=d.height/(((a=r.scale)==null?void 0:a.y)||1),d}o(s,"update");let n={id:"text",set text(r){e=r,s(this),this.renderedText=Fs(e).text},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,renderedText:e?Fs(e).text:"",add(){$s(()=>s(this))},draw(){ht(s(this))},renderArea(){return new oe(M(0),this.width,this.height)}};return s(n),n}o(Ha,"text");function Va(e,t){return{id:"rect",width:e,height:t,draw(){kt(Object.assign(ct(this),{width:this.width,height:this.height}))},renderArea(){return new oe(M(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}o(Va,"uvquad");function Ka(e={}){let t=null,s=null,n=null,r=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation(){return s&&n?s[n]:null},getPath(){return s?s.slice():null},getTarget(){return t},isNavigationFinished(){return s?n===null:!0},isTargetReachable(){return s!==null},isTargetReached(){return t?this.pos.eq(t):!0},setTarget(i){t=i,s=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n=s?0:null,s&&n!==null?(r||(r=this.getLevel().onNavigationMapChanged(()=>{t&&s&&n!==null&&(s=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),s?(n=0,this.trigger("navigationNext",this,s[n])):(n=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>r==null?void 0:r.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,s[n])):this.trigger("navigationEnded",this)},update(){if(t&&s&&n!==null){if(this.pos.sdist(s[n])<2)if(n===s.length-1){this.pos=t.clone(),n=null,this.trigger("navigationEnded",this),this.trigger("targetReached",this);return}else n++,this.trigger("navigationNext",this,s[n]);this.moveTo(s[n],this.agentSpeed)}},onNavigationStarted(i){return this.on("navigationStarted",i)},onNavigationNext(i){return this.on("navigationNext",i)},onNavigationEnded(i){return this.on("navigationEnded",i)},onTargetReached(i){return this.on("targetReached",i)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(s)})}}}o(Ka,"agent");function Ya(e){let t=e.graph;return{id:"pathfinder",require:["pos"],navigateTo(s){var n;return(n=this.graph)==null?void 0:n.getWaypointPath(this.pos,s,e.navigationOpt)},get graph(){if(t)return t;let s=this.parent;for(;s;){if(s.has("pathfinderMap"))return s.graph;s=s.parent}},set graph(s){t=s}}}o(Ya,"pathfinder");function za(e={}){let t=e.waypoints,s=e.speed||100,n=e.endBehavior||"stop",r=0,i=t!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return s},set patrolSpeed(a){s=a},get waypoints(){return t},set waypoints(a){t=a,r=0,i=!1},get nextLocation(){return t?t[r]:void 0},update(){let a=this.nextLocation;if(!(!t||!a||i)&&(this.moveTo(a,s),this.pos.sdist(a)<9))switch(n){case"loop":r=(r+1)%t.length;break;case"ping-pong":r=r+1,r==t.length&&(t.reverse(),r=0);break;case"stop":r=Math.min(r+1,t.length-1),r==t.length-1&&(i=!0,this.trigger("patrolFinished"));break}},onPatrolFinished(a){return this.on("patrolFinished",a)}}}o(za,"patrol");function Xa(e,t={}){let s=typeof e=="function"?e:()=>h.game.root.query(e),n=t.checkFrequency||1,r=typeof t.direction=="number"?C.fromAngle(t.direction):t.direction,i=0;return{id:"sentry",require:["pos"],direction:typeof t.direction=="number"?C.fromAngle(t.direction):t.direction,spotted:[],set directionAngle(a){this.direction=a!==void 0?C.fromAngle(a):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:t.fieldOfView||200,isWithinFieldOfView(a,d,l){let u=(typeof d=="number"?C.fromAngle(d):d)||r,f=l||t.fieldOfView;if(!u||!f||f>=360)return!0;let x=f/2;return a.pos&&u.angleBetween(a.pos.sub(this.pos))<=x},hasLineOfSight(a){let d=Sn(this.pos,a.pos.sub(this.pos),t.raycastExclude);return d!=null&&d.object===a},update(){if(i+=ge(),i>n){i-=n;let a=s();if(a.length&&r&&this.fieldOfView&&this.fieldOfView<360){let d=this.fieldOfView/2;a=a.filter(l=>l.pos&&r.angleBetween(l.pos.sub(this.pos))<=d)}a.length&&t.lineOfSight&&(a=a.filter(d=>d.pos&&this.hasLineOfSight(d))),a.length>0&&(this.spotted=a,this.trigger("objectSpotted",a))}},onObjectsSpotted(a){return this.on("objectSpotted",a)}}}o(Xa,"sentry");function jn(e={}){let t=M(0),s=e.isObstacle??!1,n=e.cost??0,r=e.edges??[],i=o(()=>{let d={left:1,top:2,right:4,bottom:8};return r.map(l=>d[l]||0).reduce((l,u)=>l|u,0)},"getEdgeMask"),a=i();return{id:"tile",tilePosOffset:e.offset??M(0),set tilePos(d){let l=this.getLevel();t=d.clone(),this.pos=M(this.tilePos.x*l.tileWidth(),this.tilePos.y*l.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(d){s!==d&&(s=d,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(d){n!==d&&(n=d,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(d){r=d,a=i(),this.getLevel().invalidateNavigationMap()},get edges(){return r},get edgeMask(){return a},getLevel(){return this.parent},tileMove(d){let l=this.getLevel();l.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(d),l.insertIntoSpatialMap(this),l.trigger("spatialMapChanged")},moveLeft(){this.tileMove(M(-1,0))},moveRight(){this.tileMove(M(1,0))},moveUp(){this.tileMove(M(0,-1))},moveDown(){this.tileMove(M(0,1))}}}o(jn,"tile");var Sr,Hn=(Sr=class{constructor(e,t,s){E(this,"name"),E(this,"duration"),E(this,"loops"),E(this,"direction"),E(this,"easing"),E(this,"interpolation"),E(this,"isFinished"),E(this,"timing"),E(this,"easings"),E(this,"relative"),this.name=e,this.duration=t.duration,this.loops=t.loops||0,this.direction=t.direction||"forward",this.easing=t.easing||es.linear,this.interpolation=t.interpolation||"linear",this.isFinished=!1,this.timing=t.timing,this.easings=t.easings,this.relative=s}update(e,t){return!0}getLowerKeyIndexAndRelativeTime(e,t,s){let n=t-1,r=e/this.duration;if(this.loops!==0&&r>=this.loops)return[n,0,!0];let i=Math.trunc(r);if(r-=i,(this.direction=="reverse"||this.direction=="ping-pong"&&i&1)&&(r=1-r),s){let a=0;for(;s[a+1]!==void 0&&s[a+1]<r;)a++;return a>=n?[n,0,!0]:[a,(r-s[a])/(s[a+1]-s[a]),!1]}else{let a=Math.floor((t-1)*r);return[a,(r-a/n)*n,!1]}}setValue(e,t,s){if(this.relative)switch(t){case"pos":e.pos=e.base.pos.add(s);break;case"angle":e.angle=e.base.angle+s;break;case"scale":e.scale=e.base.scale.scale(s);break;case"opacity":e.opacity=e.base.opacity*s;break;default:e[t]=s}else e[t]=s}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),this.direction!=="forward"&&(e.direction=this.direction),this.easing!=es.linear&&(e.easing=this.easing.name),this.interpolation!=="linear"&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(t=>this.easing.name)),e}},o(Sr,"AnimateChannel"),Sr);function Nr(e,t){return t.add(t.sub(e))}o(Nr,"reflect");var qr,Ru=(qr=class extends Hn{constructor(e,t,s,n){super(e,s,n),E(this,"keys"),this.keys=t}update(e,t){let[s,n,r]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(n==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[s]);else{let i=this.easings?this.easings[s]:this.easing;this.setValue(e,this.name,be(this.keys[s],this.keys[s+1],i(n)))}return r}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},o(qr,"AnimateChannelNumber"),qr),Cr,Pu=(Cr=class extends Hn{constructor(e,t,s,n,r){var i;if(super(e,s,n),E(this,"keys"),E(this,"curves"),E(this,"dcurves"),this.keys=t,this.interpolation==="spline"){this.curves=[],r&&(this.dcurves=[]);for(let a=0;a<this.keys.length-1;a++){let d=this.keys[a],l=a+1,u=this.keys[l],f=a>0?this.keys[a-1]:Nr(u,d),x=l<this.keys.length-1?this.keys[l+1]:Nr(d,u);this.curves.push(_t(f,d,u,x)),r&&((i=this.dcurves)==null||i.push(_t(f,d,u,x,Oi)))}}}update(e,t){let[s,n,r]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(n==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[s]);else{let i=this.easings?this.easings[s]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[s].lerp(this.keys[s+1],i(n)));break;case"slerp":this.setValue(e,this.name,this.keys[s].slerp(this.keys[s+1],i(n)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[s](i(n))),this.dcurves&&this.setValue(e,"angle",this.dcurves[s](i(n)).angle());break}}}return r}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},o(Cr,"AnimateChannelVec2"),Cr),Br,Iu=(Br=class extends Hn{constructor(e,t,s,n){super(e,s,n),E(this,"keys"),this.keys=t}update(e,t){let[s,n,r]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(n==0||this.interpolation=="none")this.setValue(e,this.name,this.keys[s]);else{let i=this.easings?this.easings[s]:this.easing;this.setValue(e,this.name,this.keys[s].lerp(this.keys[s+1],i(n)))}return r}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},o(Br,"AnimateChannelColor"),Br);function Qa(e={}){let t=[],s=0,n=!1;return{id:"animate",require:e.followMotion?["rotate"]:void 0,base:{pos:M(0,0),angle:0,scale:M(1,1),opacity:1},animation:{paused:!1,seek(r){s=Le(r,0,this.duration),t.forEach(i=>{i.isFinished=!1}),n=!1},get duration(){return t.reduce((r,i)=>Math.max(i.duration,r),0)}},add(){e.relative&&(this.has("pos")&&(this.base.pos=this.pos.clone()),this.has("rotate")&&(this.base.angle=this.angle),this.has("scale")&&(this.base.scale=this.scale),this.has("opacity")&&(this.base.opacity=this.opacity))},update(){if(this.animation.paused)return;let r=!0,i;s+=ge();for(let a of t)i=a.update(this,s),i&&!a.isFinished&&(a.isFinished=!0,this.trigger("animateChannelFinished",a.name)),r&&(r=i);r&&!n&&(n=!0,this.trigger("animateFinished"))},animate(r,i,a){n=!1,this.unanimate(r),typeof i[0]=="number"?t.push(new Ru(r,i,a,e.relative||!1)):i[0]instanceof C?t.push(new Pu(r,i,a,e.relative||!1,r==="pos"&&(e.followMotion||!1))):i[0]instanceof Q&&t.push(new Iu(r,i,a,e.relative||!1))},unanimate(r){let i=t.findIndex(a=>a.name===r);i>=0&&t.splice(i,1)},unanimateAll(){t.splice(0,t.length)},onAnimateFinished(r){return this.on("animateFinished",r)},onAnimateChannelFinished(r){return this.on("animateChannelFinished",r)},serializeAnimationChannels(){return t.reduce((r,i)=>(r[i.name]=i.serialize(),r),{})},serializeAnimationOptions(){let r={};return e.followMotion&&(r.followMotion=!0),e.relative&&(r.relative=!0),r}}}o(Qa,"animate");function Vn(e,t){let s={name:e.name};return e.has("animate")&&(s.channels=e.serializeAnimationChannels(),Object.assign(s,e.serializeAnimationOptions())),e.children.length>0&&(s.children=e.children.filter(n=>n.has("named")).map(n=>Vn(n,n.name))),s}o(Vn,"serializeAnimation");function Gr(e=2,t=1){let s=0;return{require:["scale"],update(){let n=Math.sin(s*e)*t;n<0&&this.destroy(),this.scale=M(n),s+=ge()}}}o(Gr,"boom");function Wa(e,t){if(e==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(s=1){this.setHP(e-s),this.trigger("hurt",s)},heal(s=1){let n=e;this.setHP(e+s),this.trigger("heal",e-n)},hp(){return e},maxHP(){return t??null},setMaxHP(s){t=s},setHP(s){e=t?Math.min(t,s):s,e<=0&&this.trigger("death")},onHurt(s){return this.on("hurt",s)},onHeal(s){return this.on("heal",s)},onDeath(s){return this.on("death",s)},inspect(){return`health: ${e}`}}}o(Wa,"health");function Ja(e,t={}){if(e==null)throw new Error("lifespan() requires time");let s=t.fade??0;return{id:"lifespan",require:["opacity"],async add(){await h.game.root.wait(e),this.opacity=this.opacity??1,s>0&&await h.game.root.tween(this.opacity,0,s,n=>this.opacity=n,es.linear),this.destroy()}}}o(Ja,"lifespan");function Za(e){return{id:"named",name:e}}o(Za,"named");function _a(e,t,s){if(!e)throw new Error("state() requires an initial state");let n={};function r(l){n[l]||(n[l]={enter:new ve,end:new ve,update:new ve,draw:new ve})}o(r,"initStateEvents");function i(l,u,f){return r(u),n[u][l].add(f)}o(i,"on");function a(l,u,...f){r(u),n[u][l].trigger(...f)}o(a,"trigger");let d=!1;return{id:"state",state:e,enterState(l,...u){if(d=!0,t&&!t.includes(l))throw new Error(`State not found: ${l}`);let f=this.state;if(s){if(!(s!=null&&s[f]))return;let x=typeof s[f]=="string"?[s[f]]:s[f];if(!x.includes(l))throw new Error(`Cannot transition state from "${f}" to "${l}". Available transitions: ${x.map(c=>`"${c}"`).join(", ")}`)}a("end",f,...u),this.state=l,a("enter",l,...u),a("enter",`${f} -> ${l}`,...u)},onStateTransition(l,u,f){return i("enter",`${l} -> ${u}`,f)},onStateEnter(l,u){return i("enter",l,u)},onStateUpdate(l,u){return i("update",l,u)},onStateDraw(l,u){return i("draw",l,u)},onStateEnd(l,u){return i("end",l,u)},update(){d||(a("enter",e),d=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return`state: ${this.state}`}}}o(_a,"state");function Kn(e){return{id:"stay",stay:!0,scenesToStay:e}}o(Kn,"stay");function $a(e=!0,t){let s,n;return{id:"textInput",hasFocus:e,require:["text"],typedText:"",add(){let r=o(()=>{this.text=this.typedText.replace(/([\[\\])/g,"\\$1")},"flip");s=h.k.onCharInput(i=>{this.hasFocus&&(!t||this.typedText.length<t)&&(h.k.isKeyDown("shift")?this.typedText+=i.toUpperCase():this.typedText+=i,r())}),n=h.k.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1)),r()})},destroy(){s.cancel(),n.cancel()}}}o($a,"textInput");function Us(e=1e3){return{id:"timer",maxLoopsPerFrame:e,loop(t,s,n=-1,r=!1){let i=r?0:t,a=new ve,d=this.onUpdate(()=>{i+=h.app.state.dt;for(let l=0;i>=t&&l<this.maxLoopsPerFrame;l++){if(n!=-1&&(n--,n<0)){d.cancel(),a.trigger();return}s(),i-=t}});return{get paused(){return d.paused},set paused(l){d.paused=l},cancel:d.cancel,onEnd:a.add,then(l){return a.add(l),this}}},wait(t,s){return this.loop(t,s??(()=>{}),1,!0)},tween(t,s,n,r,i=es.linear){let a=0,d=[],l=this.onUpdate(()=>{a+=h.app.state.dt;let u=Math.min(a/n,1);r(be(t,s,i(u))),u===1&&(l.cancel(),r(s),d.forEach(f=>f()))});return{get paused(){return l.paused},set paused(u){l.paused=u},onEnd(u){d.push(u)},then(u){return this.onEnd(u),this},cancel(){l.cancel()},finish(){l.cancel(),r(s),d.forEach(u=>u())}}}}}o(Us,"timer");var jr=0;function el(){return jr>0}o(el,"usesArea");function tl(e={}){let t={},s=new Set,n=[];return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){jr++,this.area.cursor&&n.push(this.onHover(()=>h.app.setCursor(this.area.cursor))),n.push(this.onCollideUpdate((r,i)=>{if(!r.id)throw new Error("area() requires the object to have an id");t[r.id]||this.trigger("collide",r,i),i&&(t[r.id]=i,s.add(r.id))}))},destroy(){jr--;for(let r of n)r.cancel()},fixedUpdate(){for(let r in t)s.has(Number(r))||(this.trigger("collideEnd",t[r].target),delete t[r]);s.clear()},drawInspect(){let r=this.localArea();qe(),ae(this.area.offset);let i={outline:{width:4/on(),color:$(0,0,255)},anchor:this.anchor,fill:!1,fixed:it(this)};r instanceof oe?Be({...i,pos:r.pos,width:r.width*this.area.scale.x,height:r.height*this.area.scale.y}):r instanceof Ee?We({...i,pts:r.pts,scale:this.area.scale}):r instanceof Re&&xt({...i,pos:r.center,radius:r.radius}),xe()},area:{shape:e.shape??null,scale:e.scale?M(e.scale):M(1),offset:e.offset??M(0),cursor:e.cursor??null},isClicked(){return h.app.isMousePressed()&&this.isHovering()},isHovering(){let r=it(this)?h.k.mousePos():h.k.toWorld(h.k.mousePos());return this.hasPoint(r)},checkCollision(r){if(!r.id)throw new Error("checkCollision() requires the object to have an id");return t[r.id]??null},getCollisions(){return Object.values(t)},isColliding(r){if(!r.id)throw new Error("isColliding() requires the object to have an id");return!!t[r.id]},isOverlapping(r){if(!r.id)throw new Error("isOverlapping() requires the object to have an id");let i=t[r.id];return i&&i.hasOverlap()},onClick(r,i="left"){let a=h.app.onMousePress(i,()=>{this.isHovering()&&r()});return n.push(a),a},onHover(r){let i=!1;return this.onUpdate(()=>{i?i=this.isHovering():this.isHovering()&&(i=!0,r())})},onHoverUpdate(r){return this.onUpdate(()=>{this.isHovering()&&r()})},onHoverEnd(r){let i=!1;return this.onUpdate(()=>{i?this.isHovering()||(i=!1,r()):i=this.isHovering()})},onCollide(r,i){if(typeof r=="function"&&i===void 0)return this.on("collide",r);if(typeof r=="string")return this.onCollide((a,d)=>{a.is(r)&&(i==null||i(a,d))});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(r,i){if(typeof r=="function"&&i===void 0)return this.on("collideUpdate",r);if(typeof r=="string")return this.on("collideUpdate",(a,d)=>a.is(r)&&(i==null?void 0:i(a,d)));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(r,i){if(typeof r=="function"&&i===void 0)return this.on("collideEnd",r);if(typeof r=="string")return this.on("collideEnd",a=>a.is(r)&&(i==null?void 0:i(a)));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(r){return Je(this.worldArea(),r)},resolveCollision(r){let i=this.checkCollision(r);i&&!i.resolved&&(this.pos=this.pos.add(i.displacement),i.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let r=this.localArea();if(!(r instanceof Ee||r instanceof oe))throw new Error("Only support polygon and rect shapes for now");let i=this.transform.clone().translate(this.area.offset).scale(M(this.area.scale??1));if(r instanceof oe){let a=vt(this.anchor||zs).add(1,1).scale(-.5).scale(r.width,r.height);i.translate(a)}return r.transform(i)},screenArea(){let r=this.worldArea();return it(this)?r:r.transform(h.game.cam.transform)},inspect(){var r,i,a,d,l,u,f;return((r=this.area.scale)==null?void 0:r.x)==((i=this.area.scale)==null?void 0:i.y)?`area: ${(d=(a=this.area.scale)==null?void 0:a.x)==null?void 0:d.toFixed(1)}x`:`area: (${(u=(l=this.area.scale)==null?void 0:l.x)==null?void 0:u.toFixed(1)}x, ${(f=this.area.scale.y)==null?void 0:f.toFixed(1)}y)`}}}o(tl,"area");function sl(e={}){let t=null,s=null,n=!1,r=M(0),i=null,a=null,d;return{id:"body",require:["pos"],vel:M(0),drag:e.drag??0,jumpForce:e.jumpForce??Ol,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(i=this.pos.clone(),a=this.pos.clone(),d=this.pos.clone(),this.mass===0)throw new Error("Can't set body mass to 0");this.has("area")&&(this.onCollideUpdate((l,u)=>{if(!u||!l.has("body")||u.resolved)return;this.trigger("beforePhysicsResolve",u);let f=u.reverse();if(l.trigger("beforePhysicsResolve",f),!(u.resolved||f.resolved)&&!(this.isStatic&&l.isStatic)){if(!this.isStatic&&!l.isStatic){let x=this.mass+l.mass;this.pos=this.pos.add(u.displacement.scale(l.mass/x)),l.pos=l.pos.add(u.displacement.scale(-this.mass/x)),this.transform=Pt(this),l.transform=Pt(l)}else{let x=!this.isStatic&&l.isStatic?u:u.reverse();x.source.pos=x.source.pos.add(x.displacement),x.source.transform=Pt(x.source)}u.resolved=!0,this.trigger("physicsResolve",u),l.trigger("physicsResolve",u.reverse())}}),this.onPhysicsResolve(l=>{if(h.game.gravity)if(l.isBottom()&&this.isFalling()){this.vel=this.vel.reject(h.game.gravity.unit());let u=t;t=l.target,u!=t&&(s=l.target.pos),n?n=!1:u||(this.trigger("ground",t),l.target.trigger("land",this))}else l.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(h.game.gravity.unit()),this.trigger("headbutt",l.target),l.target.trigger("headbutted",this))}))},update(){t&&this.isColliding(t)&&t.exists()&&t.has("body")&&(s&&!t.pos.eq(s)&&e.stickToPlatform!==!1&&this.moveBy(t.pos.sub(s)),s=t.pos);let l=Is();l&&(this.pos.x==d.x&&(this.pos.x=be(i.x,a.x,l/Ps()),d.x=this.pos.x),this.pos.y==d.y&&(this.pos.y=be(i.y,a.y,l/Ps()),d.y=this.pos.y))},fixedUpdate(){if(i&&(this.pos.x==d.x&&(this.pos.x=i.x),this.pos.y==d.y&&(this.pos.y=i.y),i=null),h.game.gravity&&!this.isStatic){n&&(t=null,s=null,this.trigger("fallOff"),n=!1),t&&(!this.isColliding(t)||!t.exists()||!t.has("body"))&&(n=!0);let l=this.vel.clone();this.vel=this.vel.add(h.game.gravity.scale(this.gravityScale*ge()));let u=e.maxVelocity??Ul;this.vel.slen()>u*u&&(this.vel=this.vel.unit().scale(u)),l.dot(h.game.gravity)<0&&this.vel.dot(h.game.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=r.x*ge(),this.vel.y+=r.y*ge(),this.vel.x*=1-this.drag*ge(),this.vel.y*=1-this.drag*ge(),this.move(this.vel),Is()){i=this.pos.clone();let l=this.vel.add(r.scale(ge()));a=this.pos.add(l.scale(ge())),d=this.pos.clone()}r.x=0,r.y=0},onPhysicsResolve(l){return this.on("physicsResolve",l)},onBeforePhysicsResolve(l){return this.on("beforePhysicsResolve",l)},curPlatform(){return t},isGrounded(){return t!==null},isFalling(){return this.vel.dot(Tt())>0},isJumping(){return this.vel.dot(Tt())<0},applyImpulse(l){this.isStatic||(this.vel=this.vel.add(l))},addForce(l){this.isStatic||(r.x+=l.x/this.mass,r.y+=l.y/this.mass)},jump(l){this.isStatic||(t=null,s=null,this.vel=Tt().scale(-l||-this.jumpForce))},onGround(l){return this.on("ground",l)},onFall(l){return this.on("fall",l)},onFallOff(l){return this.on("fallOff",l)},onHeadbutt(l){return this.on("headbutt",l)},onLand(l){return this.on("land",l)},onHeadbutted(l){return this.on("headbutted",l)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}o(sl,"body");function rl(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround(()=>{t=this.numJumps})},doubleJump(s){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(s))},onDoubleJump(s){return this.on("doubleJump",s)},inspect(){return`jumpsLeft: ${t}`}}}o(rl,"doubleJump");function nl(e){return{id:"surfaceEffector",require:["area"],speed:e.speed,speedVariation:e.speedVariation??0,forceScale:e.speedVariation??.9,add(){this.onCollideUpdate("body",(t,s)=>{var n;let r=s==null?void 0:s.normal.normal(),i=t.vel.project(r),a=(n=r==null?void 0:r.scale(this.speed))==null?void 0:n.sub(i);t.addForce(a==null?void 0:a.scale(t.mass*this.forceScale))})}}}o(nl,"surfaceEffector");function il(e){return{id:"areaEffector",require:["area"],useGlobalAngle:e.useGlobalAngle||!1,forceAngle:e.forceAngle,forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",(t,s)=>{if(!t.has("body"))return;let n=C.fromAngle(this.forceAngle).scale(this.forceMagnitude);t.addForce(n),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}o(il,"areaEffector");function ol(e){return{id:"pointEffector",require:["area","pos"],forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,distanceScale:e.distanceScale??1,forceMode:e.forceMode||"inverseLinear",linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",(t,s)=>{let n=this.pos.sub(t.pos),r=n.len(),i=r*this.distanceScale/10,a=this.forceMode==="constant"?1:this.forceMode==="inverseLinear"?1/i:1/i**2,d=n.scale(this.forceMagnitude*a/r);t.addForce(d),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}o(ol,"pointEffector");function al(e){return{id:"constantForce",require:["body"],force:e.force,update(){this.force&&this.addForce(this.force)}}}o(al,"constantForce");function ll(e){return{id:"platformEffector",require:["area","body"],surfaceArc:e.surfaceArc??180,useOneWay:e.useOneWay??!1,add(){this.onBeforePhysicsResolve(t=>{let s=t.target.vel,n=Tt().scale(-1).angleBetween(s);Math.abs(n)>this.surfaceArc/2&&t.preventResolution()})}}}o(ll,"platformEffector");function ul(e){return{id:"buoyancyEffector",require:["area"],surfaceLevel:e.surfaceLevel,density:e.density??1,linearDrag:e.linearDrag??1,angularDrag:e.angularDrag??.2,flowAngle:e.flowAngle??0,flowMagnitude:e.flowMagnitude??0,flowVariation:e.flowVariation??0,add(){this.onCollideUpdate("body",(t,s)=>{let n=t,r=n.worldArea(),[i,a]=r.cut(M(-100,this.surfaceLevel),M(100,this.surfaceLevel));i&&(this.applyBuoyancy(n,i),this.applyDrag(n,i)),this.flowMagnitude&&n.addForce(C.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(t,s){let n=this.density*s.area(),r=M(0,1).scale(-n);t.addForce(r)},applyDrag(t,s){let n=t.vel,r=this.density*this.linearDrag,i=n.scale(-r);t.addForce(i)}}}o(ul,"buoyancyEffector");function Ls(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}o(Ls,"anchor");function Yn(){return{id:"fixed",fixed:!0}}o(Yn,"fixed");function hl(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??M(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}o(hl,"follow");function cl(e){var t;let s=(t=h.game.layers)==null?void 0:t.indexOf(e);return{id:"layer",get layerIndex(){return s??null},get layer(){var n;return s?((n=h.game.layers)==null?void 0:n[s])??null:null},set layer(n){var r;if(s=(r=h.game.layers)==null?void 0:r.indexOf(n),s==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}o(cl,"layer");function dl(e,t){let s=typeof e=="number"?C.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(s.scale(t))}}}o(dl,"move");function fl(e={}){let t=e.distance??Dl,s=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let n=this.screenPos();if(!n)return!1;let r=new oe(M(0),me(),ye());return!os(r,n)&&r.sdistToPoint(n)>t*t},onExitScreen(n){return this.on("exitView",n)},onEnterScreen(n){return this.on("enterView",n)},update(){this.isOffScreen()?(s||(this.trigger("exitView"),s=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(s&&(this.trigger("enterView"),s=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}o(fl,"offscreen");function ns(...e){return{id:"pos",pos:M(...e),moveBy(...t){this.pos=this.pos.add(M(...t))},move(...t){this.moveBy(M(...t).scale(ge()))},moveTo(...t){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.moveTo(M(t[0],t[1]),t[2]);let s=t[0],n=t[1];if(n===void 0){this.pos=M(s);return}let r=s.sub(this.pos);if(r.len()<=n*ge()){this.pos=M(s);return}this.move(r.unit().scale(n))},worldPos(t=null){return t?(this.pos=this.pos.add(this.fromWorld(t)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(t){return this.parent?this.parent.transform.multVec2(this.pos.add(t)):this.pos.add(t)},fromWorld(t){return this.parent?this.parent.transform.invert().multVec2(t).sub(this.pos):t.sub(this.pos)},screenPos(t=null){if(t)return this.pos=this.pos.add(this.fromScreen(t)),null;{let s=this.worldPos();return s?it(this)?s:Ds(s):null}},toScreen(t){let s=this.toWorld(t);return it(this)?s:Ds(s)},fromScreen(t){return it(this)?this.fromWorld(t):this.fromWorld(kn(t))},toOther(t,s){return t.fromWorld(this.toWorld(s))},fromOther(t,s){return t.toOther(this,s)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){xt({color:$(255,0,0),radius:4/on()})}}}o(ns,"pos");function pl(e){return{id:"rotate",angle:e??0,rotateBy(t){this.angle+=t},rotateTo(t){this.angle=t},inspect(){return`angle: ${Math.round(this.angle)}`}}}o(pl,"rotate");function is(...e){if(e.length===0)return is(1);let t=M(...e);return{id:"scale",set scale(s){if(!(s instanceof C))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");t=M(s)},get scale(){return t},scaleTo(...s){t=M(...s)},scaleBy(...s){t=t.scale(M(...s))},inspect(){return t.x==t.y?`scale: ${t.x.toFixed(1)}x`:`scale: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`}}}o(is,"scale");function gl(e){return{id:"z",z:e,inspect(){return`z: ${this.z}`}}}o(gl,"z");var Tu="data:image/png;base64,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",Fu="data:image/png;base64,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",ku="3001.0.0",h={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},Du=o((e={tagsAsComponents:!0})=>{h.k&&(console.warn("KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!"),h.k.quit()),h.globalOpt=e;let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let s=e.canvas??t.appendChild(document.createElement("canvas"));h.canvas=s;let n=e.scale??1;h.gscale=n;let r=e.width&&e.height&&!e.stretch&&!e.letterbox;r?(s.width=e.width*n,s.height=e.height*n):(s.width=s.parentElement.offsetWidth,s.height=s.parentElement.offsetHeight);let i=["outline: none","cursor: default"];if(r){let N=s.width,Y=s.height;i.push(`width: ${N}px`),i.push(`height: ${Y}px`)}else i.push("width: 100%"),i.push("height: 100%");e.crisp&&(i.push("image-rendering: pixelated"),i.push("image-rendering: crisp-edges")),s.style.cssText=i.join(";");let a=e.pixelDensity||1;h.pixelDensity=a,s.width*=a,s.height*=a,s.tabIndex=0;let d=document.createElement("canvas");d.width=256,d.height=256,h.fontCacheCanvas=d;let l=d.getContext("2d",{willReadFrequently:!0});h.fontCacheC2d=l;let u=Zl({canvas:s,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS,buttons:e.buttons});h.app=u;let f=[],x=u.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!x)throw new Error("WebGL not supported");let c=x,y=zo(c,{texFilter:e.texFilter}),g=gu(e,y);h.gfx=g;let S=Bu();h.audio=S;let p=cu(y);h.assets=p;let w=qu();h.game=w,w.root.use(Us());function P(N,Y){let X=new Ts(y,N,Y);return{clear:o(()=>X.clear(),"clear"),free:o(()=>X.free(),"free"),toDataURL:o(()=>X.toDataURL(),"toDataURL"),toImageData:o(()=>X.toImageData(),"toImageData"),width:X.width,height:X.height,draw:o(se=>{Ce(),X.bind(),se(),Ce(),X.unbind()},"draw"),get fb(){return X}}}o(P,"makeCanvas");function I(){c.clear(c.COLOR_BUFFER_BIT),g.frameBuffer.bind(),c.clear(c.COLOR_BUFFER_BIT),g.bgColor||Qe(()=>{kt({width:me(),height:ye(),quad:new le(0,0,me()/64,ye()/64),tex:g.bgTex,fixed:!0})}),g.renderer.numDraws=0,g.fixed=!1,g.transformStack.length=0,g.transform=new He}o(I,"frameStart");function U(N,Y){g.postShader=N,g.postShaderUniform=Y??null}o(U,"usePostEffect");function D(){Ce(),g.lastDrawCalls=g.renderer.numDraws,g.frameBuffer.unbind(),c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);let N=g.width,Y=g.height;g.width=c.drawingBufferWidth/a,g.height=c.drawingBufferHeight/a,rs({flipY:!0,tex:g.frameBuffer.tex,pos:new C(g.viewport.x,g.viewport.y),width:g.viewport.width,height:g.viewport.height,shader:g.postShader,uniform:typeof g.postShaderUniform=="function"?g.postShaderUniform():g.postShaderUniform,fixed:!0}),Ce(),g.width=N,g.height=Y}o(D,"frameEnd");let v=!1,b={inspect:!1,timeScale:1,showLog:!0,fps:o(()=>u.fps(),"fps"),numFrames:o(()=>u.numFrames(),"numFrames"),stepFrame:$e,drawCalls:o(()=>g.lastDrawCalls,"drawCalls"),clearLog:o(()=>w.logs=[],"clearLog"),log:o((...N)=>{let Y=e.logMax??8,X=N.length>1?N.concat(" ").join(" "):N[0];w.logs.unshift({msg:X,time:u.time()}),w.logs.length>Y&&(w.logs=w.logs.slice(0,Y))},"log"),error:o(N=>b.log(new Error(N.toString?N.toString():N)),"error"),curRecording:null,numObjects:o(()=>G("*",{recursive:!0}).length,"numObjects"),get paused(){return v},set paused(N){v=N,N?S.ctx.suspend():S.ctx.resume()}};h.debug=b;function q(N,Y){try{return JSON.parse(window.localStorage[N])}catch{return Y?(k(N,Y),Y):null}}o(q,"getData");function k(N,Y){window.localStorage[N]=JSON.stringify(Y)}o(k,"setData");function T(N,...Y){let X=N(Ne),se;typeof X=="function"?se=X(...Y)(Ne):se=X;for(let fe in se)Ne[fe]=se[fe],e.global!==!1&&(window[fe]=se[fe]);return Ne}o(T,"plug");function O(N){let Y=u.canvas.captureStream(N),X=S.ctx.createMediaStreamDestination();S.masterNode.connect(X);let se=new MediaRecorder(Y),fe=[];return se.ondataavailable=_=>{_.data.size>0&&fe.push(_.data)},se.onerror=()=>{S.masterNode.disconnect(X),Y.getTracks().forEach(_=>_.stop())},se.start(),{resume(){se.resume()},pause(){se.pause()},stop(){return se.stop(),S.masterNode.disconnect(X),Y.getTracks().forEach(_=>_.stop()),new Promise(_=>{se.onstop=()=>{_(new Blob(fe,{type:"video/mp4"}))}})},download(_="kaboom.mp4"){this.stop().then(Ae=>Fr(_,Ae))}}}o(O,"record");function L(){return document.activeElement===u.canvas}o(L,"isFocused");let j=w.root.add.bind(w.root),H=w.root.readd.bind(w.root),W=w.root.removeAll.bind(w.root),G=w.root.get.bind(w.root),z=w.root.wait.bind(w.root),te=w.root.loop.bind(w.root),Z=w.root.query.bind(w.root),J=w.root.tween.bind(w.root),ue=It(null,Fu),V=It(null,Tu);h.kaSprite=ue,h.boomSprite=V;function Ve(){w.root.fixedUpdate()}o(Ve,"fixedUpdateFrame");function $e(){w.root.update()}o($e,"updateFrame");const Ut=class ml{constructor(Y,X,se,fe,_=!1){E(this,"source"),E(this,"target"),E(this,"normal"),E(this,"distance"),E(this,"resolved",!1),this.source=Y,this.target=X,this.normal=se,this.distance=fe,this.resolved=_}get displacement(){return this.normal.scale(this.distance)}reverse(){return new ml(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(w.gravity||M(0,1))>0}isRight(){return this.displacement.cross(w.gravity||M(0,1))<0}isTop(){return this.displacement.dot(w.gravity||M(0,1))>0}isBottom(){return this.displacement.dot(w.gravity||M(0,1))<0}preventResolution(){this.resolved=!0}};o(Ut,"Collision");let tr=Ut;function Lt(){if(!el())return;let N={},Y=e.hashGridSize||64,X=new He,se=[];function fe(_){if(se.push(X.clone()),_.pos&&X.translate(_.pos),_.scale&&X.scale(_.scale),_.angle&&X.rotate(_.angle),_.transform=X.clone(),_.c("area")&&!_.paused){let Ae=_,et=Ae.worldArea().bbox(),sr=Math.floor(et.pos.x/Y),rr=Math.floor(et.pos.y/Y),ps=Math.ceil((et.pos.x+et.width)/Y),gs=Math.ceil((et.pos.y+et.height)/Y),jt=new Set;for(let De=sr;De<=ps;De++)for(let Ke=rr;Ke<=gs;Ke++)if(!N[De])N[De]={},N[De][Ke]=[Ae];else if(!N[De][Ke])N[De][Ke]=[Ae];else{let Et=N[De][Ke];e:for(let Te of Et){if(Te.paused||!Te.exists()||jt.has(Te.id))continue;for(let Ye of Ae.collisionIgnore)if(Te.is(Ye))continue e;for(let Ye of Te.collisionIgnore)if(Ae.is(Ye))continue e;let Ht=Hi(Ae.worldArea(),Te.worldArea());if(Ht){let Ye=new tr(Ae,Te,Ht.normal,Ht.distance);Ae.trigger("collideUpdate",Te,Ye);let Vt=Ye.reverse();Vt.resolved=Ye.resolved,Te.trigger("collideUpdate",Ae,Vt)}jt.add(Te.id)}Et.push(Ae)}}_.children.forEach(fe),X=se.pop()}o(fe,"checkObj"),fe(w.root)}o(Lt,"checkFrame");function Nt(N){console.error(N),S.ctx.suspend();let Y=N.message??String(N)??"Unknown error, check console for more info";u.run(()=>{},()=>{I(),Qe(()=>{let X=me(),se=ye(),fe={size:36,width:X-32*2,letterSpacing:4,lineSpacing:4,font:Bs,fixed:!0};Be({width:X,height:se,color:$(0,0,255),fixed:!0});let _=ut({...fe,text:"Error",pos:M(32),color:$(255,128,0),fixed:!0});ht(_),Lr({...fe,text:Y,pos:M(32,32+_.height+16),fixed:!0}),xe(),w.events.trigger("error",N)}),D()})}o(Nt,"handleErr");function ds(N){f.push(N)}o(ds,"onCleanup");function fs(){w.events.onOnce("frameEnd",()=>{u.quit(),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);let N=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS);for(let Y=0;Y<N;Y++)c.activeTexture(c.TEXTURE0+Y),c.bindTexture(c.TEXTURE_2D,null),c.bindTexture(c.TEXTURE_CUBE_MAP,null);c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null),y.destroy(),f.forEach(Y=>Y())})}o(fs,"quit");let bt=!0;u.run(()=>{try{p.loaded&&(b.paused||Ve(),Lt())}catch(N){Nt(N)}},(N,Y)=>{try{N(),p.loaded||at()===1&&!bt&&(p.loaded=!0,ln().forEach(X=>w.events.trigger("loadError",...X)),w.events.trigger("load")),!p.loaded&&e.loadingScreen!==!1||bt?(I(),Wo(),D()):(b.paused||$e(),Lt(),I(),Qo(),e.debug!==!1&&Xo(),D()),bt&&(bt=!1),w.events.trigger("frameEnd"),Y()}catch(X){Nt(X)}}),bn(),Ln();let Ne={_k:h,VERSION:ku,loadRoot:Co,loadProgress:at,loadSprite:It,loadSpriteAtlas:wn,loadSound:Go,loadMusic:jo,loadBitmapFont:ko,loadFont:To,loadShader:Uo,loadShaderURL:Lo,loadAseprite:Io,loadPedit:Do,loadBean:Po,loadJSON:Bo,load:un,getSound:mn,getFont:fn,getBitmapFont:pn,getSprite:hn,getShader:gn,getAsset:Ro,Asset:ke,SpriteData:lt,SoundData:ss,width:me,height:ye,center:ts,dt:ge,fixedDt:Ps,restDt:Is,time:u.time,screenshot:u.screenshot,record:O,isFocused:L,setCursor:u.setCursor,getCursor:u.getCursor,setCursorLocked:u.setCursorLocked,isCursorLocked:u.isCursorLocked,setFullscreen:u.setFullscreen,isFullscreen:u.isFullscreen,isTouchscreen:u.isTouchscreen,onLoad:$s,onLoadError:Aa,onLoading:ma,onResize:wa,onGamepadConnect:u.onGamepadConnect,onGamepadDisconnect:u.onGamepadDisconnect,onError:ya,onCleanup:ds,flash:Fn,setCamPos:Cn,getCamPos:Bn,setCamRot:In,getCamRot:Tn,setCamScale:Rn,getCamScale:Pn,getCamTransform:va,camPos:Ea,camScale:Ma,camFlash:qa,camRot:Sa,camTransform:xa,shake:ba,toScreen:Ds,toWorld:kn,setGravity:Ca,getGravity:Ba,setGravityDirection:Ra,getGravityDirection:Tt,setBackground:vo,getBackground:xo,getGamepads:u.getGamepads,getTreeRoot:Ua,add:j,make:er,destroy:Gn,destroyAll:W,get:G,query:Z,readd:H,pos:ns,scale:is,rotate:pl,color:En,opacity:Mn,anchor:Ls,area:tl,sprite:Os,text:Ha,polygon:ia,rect:qn,circle:$o,uvquad:Va,outline:ra,particles:na,body:sl,platformEffector:ll,surfaceEffector:nl,areaEffector:il,pointEffector:ol,buoyancyEffector:ul,constantForce:al,doubleJump:rl,shader:oa,textInput:$a,timer:Us,fixed:Yn,stay:Kn,health:Wa,lifespan:Ja,named:Za,state:_a,z:gl,layer:cl,move:dl,offscreen:fl,follow:hl,fadeIn:ta,mask:sa,drawon:ea,raycast:Sn,tile:jn,animate:Qa,serializeAnimation:Vn,agent:Ka,sentry:Xa,patrol:za,pathfinder:Ya,trigger:wu,on:Me,onFixedUpdate:yu,onUpdate:Au,onDraw:vu,onAdd:la,onDestroy:xu,onTag:ua,onUntag:Mu,onUse:bu,onUnuse:Eu,onClick:Su,onCollide:ha,onCollideUpdate:ca,onCollideEnd:da,onHover:fa,onHoverUpdate:pa,onHoverEnd:ga,onKeyDown:u.onKeyDown,onKeyPress:u.onKeyPress,onKeyPressRepeat:u.onKeyPressRepeat,onKeyRelease:u.onKeyRelease,onMouseDown:u.onMouseDown,onMousePress:u.onMousePress,onMouseRelease:u.onMouseRelease,onMouseMove:u.onMouseMove,onCharInput:u.onCharInput,onTouchStart:u.onTouchStart,onTouchMove:u.onTouchMove,onTouchEnd:u.onTouchEnd,onScroll:u.onScroll,onHide:u.onHide,onShow:u.onShow,onGamepadButtonDown:u.onGamepadButtonDown,onGamepadButtonPress:u.onGamepadButtonPress,onGamepadButtonRelease:u.onGamepadButtonRelease,onGamepadStick:u.onGamepadStick,onButtonPress:u.onButtonPress,onButtonDown:u.onButtonDown,onButtonRelease:u.onButtonRelease,mousePos:an,mouseDeltaPos:u.mouseDeltaPos,isKeyDown:u.isKeyDown,isKeyPressed:u.isKeyPressed,isKeyPressedRepeat:u.isKeyPressedRepeat,isKeyReleased:u.isKeyReleased,isMouseDown:u.isMouseDown,isMousePressed:u.isMousePressed,isMouseReleased:u.isMouseReleased,isMouseMoved:u.isMouseMoved,isGamepadButtonPressed:u.isGamepadButtonPressed,isGamepadButtonDown:u.isGamepadButtonDown,isGamepadButtonReleased:u.isGamepadButtonReleased,getGamepadStick:u.getGamepadStick,isButtonPressed:u.isButtonPressed,isButtonDown:u.isButtonDown,isButtonReleased:u.isButtonReleased,setButton:u.setButton,getButton:u.getButton,pressButton:u.pressButton,releaseButton:u.releaseButton,getLastInputDeviceType:u.getLastInputDeviceType,charInputted:u.charInputted,loop:te,wait:z,play:Ia,setVolume:On,getVolume:Un,volume:Ta,burp:Dn,audioCtx:S.ctx,Line:Ie,Rect:oe,Circle:Re,Ellipse:Ze,Point:ql,Polygon:Ee,Vec2:C,Color:Q,Mat4:He,Quad:le,RNG:oi,rand:pe,randi:Vr,randSeed:ai,vec2:M,rgb:$,hsl2rgb:El,quad:ce,choose:hi,chooseMultiple:ui,shuffle:Kr,chance:li,lerp:be,tween:J,easings:es,map:Ue,mapc:ii,wave:Hr,deg2rad:de,rad2deg:ot,clamp:Le,evaluateQuadratic:qi,evaluateQuadraticFirstDerivative:Ci,evaluateQuadraticSecondDerivative:Bi,evaluateBezier:Ys,evaluateBezierFirstDerivative:Ri,evaluateBezierSecondDerivative:Pi,evaluateCatmullRom:Ii,evaluateCatmullRomFirstDerivative:Ti,curveLengthApproximation:$r,normalizedCurve:Fi,hermite:Ot,cardinal:en,catmullRom:_t,bezier:ki,kochanekBartels:Di,easingSteps:ji,easingLinear:Ni,easingCubicBezier:Gi,testLineLine:Ns,testRectRect:Yr,testRectLine:Gs,testRectPoint:os,testCirclePolygon:ls,testLinePoint:js,testLineCircle:Dt,isConvex:Xi,triangulate:sn,NavMesh:uu,drawSprite:Zo,drawText:Lr,formatText:ut,drawRect:Be,drawLine:Rt,drawLines:_s,drawTriangle:vn,drawCircle:xt,drawEllipse:yn,drawUVQuad:kt,drawPolygon:We,drawCurve:An,drawBezier:Yo,drawFormattedText:ht,drawMasked:Jo,drawSubtracted:_o,pushTransform:qe,popTransform:xe,pushTranslate:ae,pushScale:Ft,pushRotate:wt,pushMatrix:bo,usePostEffect:U,makeCanvas:P,debug:b,scene:La,getSceneName:ja,go:Na,onSceneLeave:Ga,layers:Oa,getLayers:ka,setLayers:Nn,getDefaultLayer:Da,addLevel:aa,getData:q,setData:k,download:Xs,downloadJSON:to,downloadText:nn,downloadBlob:Fr,plug:T,ASCII_CHARS:Qi,canvas:u.canvas,addKaboom:Fa,LEFT:C.LEFT,RIGHT:C.RIGHT,UP:C.UP,DOWN:C.DOWN,RED:Q.RED,GREEN:Q.GREEN,BLUE:Q.BLUE,YELLOW:Q.YELLOW,MAGENTA:Q.MAGENTA,CYAN:Q.CYAN,WHITE:Q.WHITE,BLACK:Q.BLACK,quit:fs,KEvent:ve,KEventHandler:$t,KEventController:yt,cancel:o(()=>Ji,"cancel")};h.k=Ne;let Gt=e.plugins;if(Gt&&Gt.forEach(T),e.global!==!1)for(let N in Ne)window[N]=Ne[N];return e.focus!==!1&&u.canvas.focus(),Ne},"kaplay"),Ou=Du;const A=Ou({width:1920,height:1080,letterbox:!0,background:[0,0,0],global:!1,touchToMouse:!0,buttons:{jump:{keyboard:["space"],mouse:"left"}},debugKey:"d",debug:!0});function Uu(){A.add([A.text(`
        Sonic is owned by SEGA.
        This is a fangame made by Abdul Basit Ali using assets from Sonic Mania
      `,{font:"mania",size:32})]),A.add([A.text("Press Space/Click/Touch to Start The Game",{font:"mania",size:64}),A.anchor("center"),A.pos(A.center())]),A.onButtonPress("jump",()=>A.go("main-menu"))}function wl(e){const t=A.add([A.sprite("sonic",{anim:"run"}),A.scale(4),A.area(),A.anchor("center"),A.pos(e),A.body({jumpForce:1700}),{ringCollectUI:null,setControls(){A.onButtonPress("jump",()=>{this.isGrounded()&&(this.play("jump"),this.jump(),A.play("jump",{volume:.5}))})},setEvents(){this.onGround(()=>{this.play("run")})}}]);return t.ringCollectUI=t.add([A.text("",{font:"mania",size:24}),A.color(255,255,0),A.anchor("center"),A.pos(30,-10)]),t}function Lu(e){return A.add([A.sprite("motobug",{anim:"run"}),A.area({shape:new A.Rect(A.vec2(-5,0),32,32)}),A.scale(4),A.anchor("center"),A.pos(e),A.offscreen(),"enemy"])}function Nu(e){return A.add([A.sprite("ring",{anim:"spin"}),A.area(),A.scale(4),A.anchor("center"),A.pos(e),A.offscreen(),"ring"])}function Gu(){const e=A.play("city",{volume:.2,loop:!0});A.setGravity(3100);const t=1920,s=[A.add([A.sprite("chemical-bg"),A.pos(0,0),A.scale(2),A.opacity(.8)]),A.add([A.sprite("chemical-bg"),A.pos(t,0),A.scale(2),A.opacity(.8)])],n=[A.add([A.sprite("platforms"),A.pos(0,450),A.scale(4)]),A.add([A.sprite("platforms"),A.pos(384,450),A.scale(4)])],r=wl(A.vec2(200,745));r.setControls(),r.setEvents();const i=A.add([A.text("Press Space/Click/Touch to Jump!",{font:"mania",size:64}),A.anchor("center"),A.pos(A.center())]),a=A.onButtonPress("jump",()=>{A.destroy(i),a.cancel()}),d=A.add([A.text("SCORE : 0",{font:"mania",size:72}),A.pos(20,20)]);let l=0,u=0;r.onCollide("ring",y=>{A.play("ring",{volume:.5}),A.destroy(y),l++,d.text=`SCORE : ${l}`,r.ringCollectUI.text="+1",A.wait(1,()=>{r.ringCollectUI.text=""})}),r.onCollide("enemy",y=>{if(!r.isGrounded()){A.play("destroy",{volume:.5}),A.play("hyper-ring",{volume:.5}),A.destroy(y),r.play("jump"),r.jump(),u+=1,l+=10*u,d.text=`SCORE : ${l}`,u===1&&(r.ringCollectUI.text=`+${10*u}`),u>1&&(r.ringCollectUI.text=`x${u}`),A.wait(1,()=>{r.ringCollectUI.text=""});return}A.play("hurt",{volume:.5}),A.setData("current-score",l),A.go("gameover",e)});let f=300;A.loop(1,()=>{f+=50});const x=()=>{const y=Lu(A.vec2(1950,773));y.onUpdate(()=>{if(f<3e3){y.move(-(f+300),0);return}y.move(-f,0)}),y.onExitScreen(()=>{y.pos.x<0&&A.destroy(y)});const g=A.rand(.5,2.5);A.wait(g,x)};x();const c=()=>{const y=Nu(A.vec2(1950,745));y.onUpdate(()=>{y.move(-f,0)}),y.onExitScreen(()=>{y.pos.x<0&&A.destroy(y)});const g=A.rand(.5,3);A.wait(g,c)};c(),A.add([A.rect(1920,300),A.opacity(0),A.area(),A.pos(0,832),A.body({isStatic:!0}),"platform"]),A.onUpdate(()=>{r.isGrounded()&&(u=0),s[1].pos.x<0&&(s[0].moveTo(s[1].pos.x+t*2,0),s.push(s.shift())),s[0].move(-100,0),s[1].moveTo(s[0].pos.x+t*2,0),s[0].moveTo(s[0].pos.x,-r.pos.y/10-50),s[1].moveTo(s[1].pos.x,-r.pos.y/10-50),n[1].pos.x<0&&(n[0].moveTo(n[1].pos.x+n[1].width*4,450),n.push(n.shift())),n[0].move(-f,0),n[1].moveTo(n[0].pos.x+n[1].width*4,450)})}function ju(e){e.paused=!0;let t=A.getData("best-score");const s=A.getData("current-score"),n=["F","E","D","C","B","A","S"],r=[50,80,100,200,300,400,500];let i="F",a="F";for(let d=0;d<r.length;d++)r[d]<s&&(i=n[d]),r[d]<t&&(a=n[d]);t<s&&(A.setData("best-score",s),t=s,a=i),A.add([A.text("GAME OVER",{font:"mania",size:96}),A.anchor("center"),A.pos(A.center().x,A.center().y-300)]),A.add([A.text(`BEST SCORE : ${t}`,{font:"mania",size:64}),A.anchor("center"),A.pos(A.center().x-400,A.center().y-200)]),A.add([A.text(`CURRENT SCORE : ${s}`,{font:"mania",size:64}),A.anchor("center"),A.pos(A.center().x+400,A.center().y-200)]),A.add([A.rect(400,400,{radius:4}),A.color(0,0,0),A.area(),A.anchor("center"),A.outline(6,A.Color.fromArray([255,255,255])),A.pos(A.center().x-400,A.center().y+50)]).add([A.text(a,{font:"mania",size:100}),A.anchor("center")]),A.add([A.rect(400,400,{radius:4}),A.color(0,0,0),A.area(),A.anchor("center"),A.outline(6,A.Color.fromArray([255,255,255])),A.pos(A.center().x+400,A.center().y+50)]).add([A.text(i,{font:"mania",size:100}),A.anchor("center")]),A.wait(1,()=>{A.add([A.text("Press Space/Click/Touch to Play Again",{font:"mania",size:64}),A.anchor("center"),A.pos(A.center().x,A.center().y+350)]),A.onButtonPress("jump",()=>A.go("game"))})}function Hu(){A.getData("best-score")||A.setData("best-score",0),A.onButtonPress("jump",()=>A.go("game"));const e=1920,t=[A.add([A.sprite("chemical-bg"),A.pos(0,0),A.scale(2),A.opacity(.8)]),A.add([A.sprite("chemical-bg"),A.pos(1920,0),A.scale(2),A.opacity(.8)])],s=[A.add([A.sprite("platforms"),A.pos(0,450),A.scale(4)]),A.add([A.sprite("platforms"),A.pos(384,450),A.scale(4)])];A.add([A.text("SONIC RING RUN",{font:"mania",size:96}),A.anchor("center"),A.pos(A.center().x,200)]),A.add([A.text("Press Space/Click/Touch to Play",{font:"mania",size:32}),A.anchor("center"),A.pos(A.center().x,A.center().y-200)]),wl(A.vec2(200,745));const n=4e3;A.onUpdate(()=>{t[1].pos.x<0&&(t[0].moveTo(t[1].pos.x+e*2,0),t.push(t.shift())),t[0].move(-100,0),t[1].moveTo(t[0].pos.x+e*2,0),s[1].pos.x<0&&(s[0].moveTo(s[1].pos.x+s[1].width*4,450),s.push(s.shift())),s[0].move(-n,0),s[1].moveTo(s[0].pos.x+s[1].width*4,450)})}A.loadSprite("chemical-bg","graphics/chemical-bg.png");A.loadSprite("platforms","graphics/platforms.png");A.loadSprite("sonic","graphics/sonic.png",{sliceX:8,sliceY:2,anims:{run:{from:0,to:7,loop:!0,speed:30},jump:{from:8,to:15,loop:!0,speed:100}}});A.loadSprite("ring","graphics/ring.png",{sliceX:16,sliceY:1,anims:{spin:{from:0,to:15,loop:!0,speed:30}}});A.loadSprite("motobug","graphics/motobug.png",{sliceX:5,sliceY:1,anims:{run:{from:0,to:4,loop:!0,speed:8}}});A.loadFont("mania","fonts/mania.ttf");A.loadSound("destroy","sounds/Destroy.wav");A.loadSound("hurt","sounds/Hurt.wav");A.loadSound("hyper-ring","sounds/HyperRing.wav");A.loadSound("jump","sounds/Jump.wav");A.loadSound("ring","sounds/Ring.wav");A.loadSound("city","sounds/city.mp3");A.scene("disclaimer",Uu);A.scene("main-menu",Hu);A.scene("game",Gu);A.scene("gameover",ju);A.go("disclaimer");
